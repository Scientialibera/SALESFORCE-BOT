{
  "runs": [
    {
      "scenario": "no_tool",
      "response": {
        "status_code": 200,
        "json": {
          "session_id": "s_no_tool",
          "turn_id": "b2e26565-4fde-4032-8b49-96dca0e4f3d6",
          "choices": [
            {
              "index": 0,
              "message": {
                "role": "assistant",
                "content": "I'm a specialized Salesforce Q&A assistant focused on helping with business data, accounts, opportunities, and sales analytics. For general questions like 'Answer as best you can without calling tools.', I'd recommend using a general-purpose AI assistant. However, I'd be happy to help you with any Salesforce or business-related questions!"
              },
              "finish_reason": "stop"
            }
          ],
          "usage": {
            "prompt_tokens": 8,
            "completion_tokens": 49,
            "total_tokens": 57
          },
          "sources": [],
          "metadata": {
            "mode": "agent_execution",
            "plan_id": "13adebb3-b968-4f8f-a784-87c5fe1e797a",
            "plan_type": "no_tool",
            "execution_id": "74504c94-427d-420e-9fce-f37dcaaeb330",
            "steps_executed": 1,
            "execution_status": "completed",
            "timestamp": "2025-09-20T18:37:53.156275"
          }
        },
        "text": null
      },
      "log_tail": "{\"origins\": [\"*\"], \"event\": \"Configured CORS middleware\"}\r\n{\"api_prefix\": \"/api/v1\", \"event\": \"Configured application routes\"}\r\n{\"app_name\": \"salesforce-chatbot\", \"version\": \"1.0.0\", \"debug\": false, \"event\": \"Created FastAPI application\"}\r\n{\"version\": \"1.0.0\", \"event\": \"Starting Account Q&A Bot application\"}\r\n{\"event\": \"Initializing Azure service clients\"}\r\n{\"endpoint\": \"https://salesforcebot-aoai.cognitiveservices.azure.com\", \"chat_deployment\": \"gpt-4o\", \"embedding_deployment\": \"text-embedding-3-small\", \"event\": \"Initializing Azure OpenAI client\"}\r\n{\"event\": \"Azure OpenAI client initialized successfully\"}\r\n{\"endpoint\": \"https://salesforcebot-cosmos-sql.documents.azure.com:443/\", \"database\": \"appdb\", \"event\": \"Initializing Cosmos DB client\"}\r\n{\"event\": \"Cosmos DB client initialized successfully\"}\r\n{\"endpoint\": \"https://salesforcebot-cosmos-graph.gremlin.cosmos.azure.com:443/\", \"database\": \"graphdb\", \"graph\": \"account_graph\", \"event\": \"Initializing Gremlin client\"}\r\n{\"event\": \"Gremlin client initialized successfully\"}\r\n{\"event\": \"Fabric client initialized successfully\"}\r\n{\"event\": \"Initializing data repositories\"}\r\n{\"container\": \"chat_history\", \"event\": \"Initialized chat history repository\"}\r\n{\"container\": \"chat_history\", \"event\": \"Initialized chat history repository\"}\r\n{\"event\": \"Initializing application services\"}\r\n{\"enforce_rbac\": false, \"admin_users\": 0, \"event\": \"Initialized RBAC service\"}\r\n{\"enforce_rbac\": false, \"admin_users\": 0, \"event\": \"Initialized RBAC service\"}\r\n{\"min_similarity\": 0.3, \"max_candidates\": 20, \"event\": \"Account resolver filter initialized\"}\r\n{\"use_tfidf\": true, \"confidence_threshold\": 0.8, \"tfidf_threshold\": 0.3, \"event\": \"Account resolver service initialized\"}\r\n{\"confidence_threshold\": 0.8, \"event\": \"Account resolver service initialized\"}\r\n{\"event\": \"Initializing Semantic Kernel agents\"}\r\n{\"event\": \"Planner configuration skipped - using basic kernel functionality\"}\r\n{\"event\": \"Planner service initialized\"}\r\n{\"event\": \"SQL agent plugin registered with kernel\"}\r\n{\"event\": \"SQL agent enabled\"}\r\n{\"event\": \"Graph agent enabled\"}\r\n{\"event\": \"Graph agent plugin registered with kernel\"}\r\n{\"event\": \"Agents will load functions dynamically from database\"}\r\n{\"event\": \"Application startup completed successfully\"}\r\n{\"request_id\": \"aa276cf6\", \"method\": \"GET\", \"url\": \"http://127.0.0.1:8000/health\", \"user_agent\": \"Mozilla/5.0 (Windows NT; Windows NT 10.0; en-CA) WindowsPowerShell/5.1.26100.3624\", \"event\": \"HTTP request started\"}\r\nDEBUG: [aa276cf6] REQUEST START: GET http://127.0.0.1:8000/health\r\nDEBUG: [aa276cf6] Headers: {'user-agent': 'Mozilla/5.0 (Windows NT; Windows NT 10.0; en-CA) WindowsPowerShell/5.1.26100.3624', 'host': '127.0.0.1:8000', 'connection': 'Keep-Alive'}\r\nDEBUG: [aa276cf6] Tasks before request: 4\r\nDEBUG: [aa276cf6] Event loop running: True, closed: False\r\nDEBUG: [aa276cf6] About to call next middleware/handler\r\nDEBUG: [aa276cf6] Handler completed successfully\r\nDEBUG: [aa276cf6] Response status: 307\r\nDEBUG: [aa276cf6] Tasks after request: 5\r\nDEBUG: [aa276cf6] Event loop running: True, closed: False\r\n{\"request_id\": \"aa276cf6\", \"method\": \"GET\", \"url\": \"http://127.0.0.1:8000/health\", \"status_code\": 307, \"duration_ms\": 1, \"event\": \"HTTP request completed\"}\r\nDEBUG: [aa276cf6] REQUEST COMPLETED successfully\r\nINFO:     127.0.0.1:61277 - \"GET /health HTTP/1.1\" 307 Temporary Redirect\r\n{\"request_id\": \"15326ea2\", \"method\": \"GET\", \"url\": \"http://127.0.0.1:8000/health/\", \"user_agent\": \"Mozilla/5.0 (Windows NT; Windows NT 10.0; en-CA) WindowsPowerShell/5.1.26100.3624\", \"event\": \"HTTP request started\"}\r\nDEBUG: [15326ea2] REQUEST START: GET http://127.0.0.1:8000/health/\r\nDEBUG: [15326ea2] Headers: {'user-agent': 'Mozilla/5.0 (Windows NT; Windows NT 10.0; en-CA) WindowsPowerShell/5.1.26100.3624', 'host': '127.0.0.1:8000'}\r\nDEBUG: [15326ea2] Tasks before request: 4\r\nDEBUG: [15326ea2] Event loop running: True, closed: False\r\nDEBUG: [15326ea2] About to call next middleware/handler\r\nDEBUG: [15326ea2] Handler completed successfully\r\nDEBUG: [15326ea2] Response status: 200\r\nDEBUG: [15326ea2] Tasks after request: 5\r\nDEBUG: [15326ea2] Event loop running: True, closed: False\r\n{\"request_id\": \"15326ea2\", \"method\": \"GET\", \"url\": \"http://127.0.0.1:8000/health/\", \"status_code\": 200, \"duration_ms\": 1, \"event\": \"HTTP request completed\"}\r\nDEBUG: [15326ea2] REQUEST COMPLETED successfully\r\nINFO:     127.0.0.1:61277 - \"GET /health/ HTTP/1.1\" 200 OK\r\n{\"request_id\": \"e22d56e9\", \"method\": \"GET\", \"url\": \"http://127.0.0.1:8000/health\", \"user_agent\": \"Mozilla/5.0 (Windows NT; Windows NT 10.0; en-CA) WindowsPowerShell/5.1.26100.3624\", \"event\": \"HTTP request started\"}\r\nDEBUG: [e22d56e9] REQUEST START: GET http://127.0.0.1:8000/health\r\nDEBUG: [e22d56e9] Headers: {'user-agent': 'Mozilla/5.0 (Windows NT; Windows NT 10.0; en-CA) WindowsPowerShell/5.1.26100.3624', 'host': '127.0.0.1:8000', 'connection': 'Keep-Alive'}\r\nDEBUG: [e22d56e9] Tasks before request: 4\r\nDEBUG: [e22d56e9] Event loop running: True, closed: False\r\nDEBUG: [e22d56e9] About to call next middleware/handler\r\nDEBUG: [e22d56e9] Handler completed successfully\r\nDEBUG: [e22d56e9] Response status: 307\r\nDEBUG: [e22d56e9] Tasks after request: 5\r\nDEBUG: [e22d56e9] Event loop running: True, closed: False\r\n{\"request_id\": \"e22d56e9\", \"method\": \"GET\", \"url\": \"http://127.0.0.1:8000/health\", \"status_code\": 307, \"duration_ms\": 10, \"event\": \"HTTP request completed\"}\r\nDEBUG: [e22d56e9] REQUEST COMPLETED successfully\r\nINFO:     127.0.0.1:61279 - \"GET /health HTTP/1.1\" 307 Temporary Redirect\r\n{\"request_id\": \"55aca5bf\", \"method\": \"GET\", \"url\": \"http://127.0.0.1:8000/health/\", \"user_agent\": \"Mozilla/5.0 (Windows NT; Windows NT 10.0; en-CA) WindowsPowerShell/5.1.26100.3624\", \"event\": \"HTTP request started\"}\r\nDEBUG: [55aca5bf] REQUEST START: GET http://127.0.0.1:8000/health/\r\nDEBUG: [55aca5bf] Headers: {'user-agent': 'Mozilla/5.0 (Windows NT; Windows NT 10.0; en-CA) WindowsPowerShell/5.1.26100.3624', 'host': '127.0.0.1:8000'}\r\nDEBUG: [55aca5bf] Tasks before request: 4\r\nDEBUG: [55aca5bf] Event loop running: True, closed: False\r\nDEBUG: [55aca5bf] About to call next middleware/handler\r\nDEBUG: [55aca5bf] Handler completed successfully\r\nDEBUG: [55aca5bf] Response status: 200\r\nDEBUG: [55aca5bf] Tasks after request: 5\r\nDEBUG: [55aca5bf] Event loop running: True, closed: False\r\n{\"request_id\": \"55aca5bf\", \"method\": \"GET\", \"url\": \"http://127.0.0.1:8000/health/\", \"status_code\": 200, \"duration_ms\": 0, \"event\": \"HTTP request completed\"}\r\nDEBUG: [55aca5bf] REQUEST COMPLETED successfully\r\nINFO:     127.0.0.1:61279 - \"GET /health/ HTTP/1.1\" 200 OK\r\n{\"request_id\": \"04c99b61\", \"method\": \"POST\", \"url\": \"http://localhost:8000/api/v1/chat\", \"user_agent\": \"python-requests/2.32.5\", \"event\": \"HTTP request started\"}\r\nDEBUG: [04c99b61] REQUEST START: POST http://localhost:8000/api/v1/chat\r\nDEBUG: [04c99b61] Headers: {'host': 'localhost:8000', 'user-agent': 'python-requests/2.32.5', 'accept-encoding': 'gzip, deflate', 'accept': '*/*', 'connection': 'keep-alive', 'content-length': '175', 'content-type': 'application/json'}\r\nDEBUG: [04c99b61] Tasks before request: 4\r\nDEBUG: [04c99b61] Event loop running: True, closed: False\r\nDEBUG: [04c99b61] About to call next middleware/handler\r\n{\"url\": \"http://localhost:8000/api/v1/chat\", \"event\": \"Authenticating user request\"}\r\n{\"event\": \"Using fallback RBAC context\"}\r\n{\"event\": \"Fallback RBAC context created successfully\"}\r\n{\"session_id\": \"s_no_tool\", \"turn_id\": \"b2e26565-4fde-4032-8b49-96dca0e4f3d6\", \"user_id\": \"tester_no_tool\", \"message_length\": 45, \"event\": \"Processing chat message\"}\r\n{\"event\": \"Created Cosmos DB client with managed identity\"}\r\n{\"container\": \"chat_history\", \"error\": \"(Forbidden) Request blocked by Auth salesforcebot-cosmos-sql : The given request [POST /dbs/appdb/colls/] cannot be authorized by AAD token in data plane. Learn more: https://aka.ms/cosmos-native-rbac.\\r\\nActivityId: a34ca067-8432-4ce4-897a-0e0680f4337d, Microsoft.Azure.Documents.Common/2.14.0\\nCode: Forbidden\\nMessage: Request blocked by Auth salesforcebot-cosmos-sql : The given request [POST /dbs/appdb/colls/] cannot be authorized by AAD token in data plane. Learn more: https://aka.ms/cosmos-native-rbac.\\r\\nActivityId: a34ca067-8432-4ce4-897a-0e0680f4337d, Microsoft.Azure.Documents.Common/2.14.0\", \"event\": \"Failed to create container due to AAD data-plane authorization. Cosmos may require key auth for management operations or pre-created containers. See https://aka.ms/cosmos-native-rbac for details.\"}\r\n{\"container\": \"chat_history\", \"error\": \"(Forbidden) Request blocked by Auth salesforcebot-cosmos-sql : The given request [POST /dbs/appdb/colls/] cannot be authorized by AAD token in data plane. Learn more: https://aka.ms/cosmos-native-rbac.\\r\\nActivityId: 82464029-357b-4790-a2f1-5181c68af40d, Microsoft.Azure.Documents.Common/2.14.0\\nCode: Forbidden\\nMessage: Request blocked by Auth salesforcebot-cosmos-sql : The given request [POST /dbs/appdb/colls/] cannot be authorized by AAD token in data plane. Learn more: https://aka.ms/cosmos-native-rbac.\\r\\nActivityId: 82464029-357b-4790-a2f1-5181c68af40d, Microsoft.Azure.Documents.Common/2.14.0\", \"event\": \"Failed to create container due to AAD data-plane authorization. Cosmos may require key auth for management operations or pre-created containers. See https://aka.ms/cosmos-native-rbac for details.\"}\r\n{\"container\": \"chat_history\", \"error\": \"(Forbidden) Request blocked by Auth salesforcebot-cosmos-sql : The given request [POST /dbs/appdb/colls/] cannot be authorized by AAD token in data plane. Learn more: https://aka.ms/cosmos-native-rbac.\\r\\nActivityId: 5cb04d1b-7156-403c-9150-38a2d45d476f, Microsoft.Azure.Documents.Common/2.14.0\\nCode: Forbidden\\nMessage: Request blocked by Auth salesforcebot-cosmos-sql : The given request [POST /dbs/appdb/colls/] cannot be authorized by AAD token in data plane. Learn more: https://aka.ms/cosmos-native-rbac.\\r\\nActivityId: 5cb04d1b-7156-403c-9150-38a2d45d476f, Microsoft.Azure.Documents.Common/2.14.0\", \"event\": \"Failed to create container due to AAD data-plane authorization. Cosmos may require key auth for management operations or pre-created containers. See https://aka.ms/cosmos-native-rbac for details.\"}\r\n{\"chat_id\": \"s_no_tool\", \"user_id\": \"user@example.com\", \"error\": \"RetryError[<Future at 0x22263e6f9d0 state=finished raised CosmosHttpResponseError>]\", \"event\": \"Failed to get chat history\"}\r\n{\"chat_id\": \"s_no_tool\", \"user_id\": \"user@example.com\", \"event\": \"Chat history not found\"}\r\n{\"error\": \"'name'\", \"event\": \"Failed to list function definitions\"}\r\n{\"user_id\": \"user@example.com\", \"error\": \"'name'\", \"event\": \"Failed to get filtered functions\"}\r\n{\"agent_name\": \"planner_system\", \"tenant_id\": \"tenant123\", \"scenario\": \"general\", \"prompt_id\": \"prompt_planner_system\", \"event\": \"Retrieved system prompt\"}\r\n{\"plan_id\": \"13adebb3-b968-4f8f-a784-87c5fe1e797a\", \"plan_type\": \"no_tool\", \"agent_type\": \"direct_response\", \"user_id\": \"user@example.com\", \"event\": \"Basic plan created\"}\r\n{\"plan_id\": \"13adebb3-b968-4f8f-a784-87c5fe1e797a\", \"user_id\": \"user@example.com\", \"steps_count\": 1, \"planner_type\": \"sequential\", \"event\": \"Plan created successfully\"}\r\n{\"plan_id\": \"13adebb3-b968-4f8f-a784-87c5fe1e797a\", \"execution_id\": \"74504c94-427d-420e-9fce-f37dcaaeb330\", \"user_id\": \"user@example.com\", \"event\": \"Starting plan execution\"}\r\n{\"step_id\": \"7eaea05b-f56e-49de-a569-bcd50f3376b1\", \"tool_name\": \"direct_response\", \"user_id\": \"user@example.com\", \"event\": \"Executing plan step\"}\r\n{\"step_id\": \"7eaea05b-f56e-49de-a569-bcd50f3376b1\", \"event\": \"Direct response step executed successfully\"}\r\n{\"plan_id\": \"13adebb3-b968-4f8f-a784-87c5fe1e797a\", \"execution_id\": \"74504c94-427d-420e-9fce-f37dcaaeb330\", \"status\": \"completed\", \"duration_seconds\": 0.001089, \"event\": \"Plan execution completed\"}\r\n{\"container\": \"chat_history\", \"error\": \"(Forbidden) Request blocked by Auth salesforcebot-cosmos-sql : The given request [POST /dbs/appdb/colls/] cannot be authorized by AAD token in data plane. Learn more: https://aka.ms/cosmos-native-rbac.\\r\\nActivityId: 12a45390-6f98-4d5d-a50e-258232d232e4, Microsoft.Azure.Documents.Common/2.14.0\\nCode: Forbidden\\nMessage: Request blocked by Auth salesforcebot-cosmos-sql : The given request [POST /dbs/appdb/colls/] cannot be authorized by AAD token in data plane. Learn more: https://aka.ms/cosmos-native-rbac.\\r\\nActivityId: 12a45390-6f98-4d5d-a50e-258232d232e4, Microsoft.Azure.Documents.Common/2.14.0\", \"event\": \"Failed to create container due to AAD data-plane authorization. Cosmos may require key auth for management operations or pre-created containers. See https://aka.ms/cosmos-native-rbac for details.\"}\r\n{\"container\": \"chat_history\", \"error\": \"(Forbidden) Request blocked by Auth salesforcebot-cosmos-sql : The given request [POST /dbs/appdb/colls/] cannot be authorized by AAD token in data plane. Learn more: https://aka.ms/cosmos-native-rbac.\\r\\nActivityId: 33a51ee7-e505-43f7-af5a-f68fc6eb8b7d, Microsoft.Azure.Documents.Common/2.14.0\\nCode: Forbidden\\nMessage: Request blocked by Auth salesforcebot-cosmos-sql : The given request [POST /dbs/appdb/colls/] cannot be authorized by AAD token in data plane. Learn more: https://aka.ms/cosmos-native-rbac.\\r\\nActivityId: 33a51ee7-e505-43f7-af5a-f68fc6eb8b7d, Microsoft.Azure.Documents.Common/2.14.0\", \"event\": \"Failed to create container due to AAD data-plane authorization. Cosmos may require key auth for management operations or pre-created containers. See https://aka.ms/cosmos-native-rbac for details.\"}\r\n{\"container\": \"chat_history\", \"error\": \"(Forbidden) Request blocked by Auth salesforcebot-cosmos-sql : The given request [POST /dbs/appdb/colls/] cannot be authorized by AAD token in data plane. Learn more: https://aka.ms/cosmos-native-rbac.\\r\\nActivityId: 9614ca92-c321-4b83-ba7a-7c163ee7c887, Microsoft.Azure.Documents.Common/2.14.0\\nCode: Forbidden\\nMessage: Request blocked by Auth salesforcebot-cosmos-sql : The given request [POST /dbs/appdb/colls/] cannot be authorized by AAD token in data plane. Learn more: https://aka.ms/cosmos-native-rbac.\\r\\nActivityId: 9614ca92-c321-4b83-ba7a-7c163ee7c887, Microsoft.Azure.Documents.Common/2.14.0\", \"event\": \"Failed to create container due to AAD data-plane authorization. Cosmos may require key auth for management operations or pre-created containers. See https://aka.ms/cosmos-native-rbac for details.\"}\r\n{\"chat_id\": \"s_no_tool\", \"user_id\": \"user@example.com\", \"error\": \"RetryError[<Future at 0x22263e4f9b0 state=finished raised CosmosHttpResponseError>]\", \"event\": \"Failed to get chat history\"}\r\n{\"chat_id\": \"s_no_tool\", \"event\": \"Chat history not found for turn addition\"}\r\n{\"chat_id\": \"s_no_tool\", \"user_id\": \"user@example.com\", \"error\": \"Failed to save conversation turn to repository\", \"event\": \"Failed to add conversation turn\"}\r\n{\"event\": \"Failed to save conversation turn: Failed to save conversation turn to repository\"}\r\n{\"session_id\": \"s_no_tool\", \"turn_id\": \"b2e26565-4fde-4032-8b49-96dca0e4f3d6\", \"response_length\": 340, \"sources_count\": 0, \"event\": \"Chat message processed successfully\"}\r\nDEBUG: [04c99b61] Handler completed successfully\r\nDEBUG: [04c99b61] Response status: 200\r\nDEBUG: [04c99b61] Tasks after request: 5\r\nDEBUG: [04c99b61] Event loop running: True, closed: False\r\n{\"request_id\": \"04c99b61\", \"method\": \"POST\", \"url\": \"http://localhost:8000/api/v1/chat\", \"status_code\": 200, \"duration_ms\": 21555, \"event\": \"HTTP request completed\"}\r\nDEBUG: [04c99b61] REQUEST COMPLETED successfully\r\nINFO:     127.0.0.1:61283 - \"POST /api/v1/chat HTTP/1.1\" 200 OK\r\n"
    },
    {
      "scenario": "sql_only",
      "response": {
        "status_code": 200,
        "json": {
          "session_id": "s_sql",
          "turn_id": "f280e860-9351-49ea-a4df-ee793b8f55a5",
          "choices": [
            {
              "index": 0,
              "message": {
                "role": "assistant",
                "content": "{\"success\": false, \"error\": \"string indices must be integers, not 'str'\", \"user_query\": \"Run a SQL-only plan to fetch account info.\"}"
              },
              "finish_reason": "stop"
            }
          ],
          "usage": {
            "prompt_tokens": 8,
            "completion_tokens": 19,
            "total_tokens": 27
          },
          "sources": [],
          "metadata": {
            "mode": "agent_execution",
            "plan_id": "45769fe9-99ad-4da4-b07b-dc72d36901a5",
            "plan_type": "sql_only",
            "execution_id": "3d0b983a-e584-405b-bf89-644c461674d1",
            "steps_executed": 1,
            "execution_status": "completed",
            "timestamp": "2025-09-20T18:38:37.025843"
          }
        },
        "text": null
      },
      "log_tail": "{\"origins\": [\"*\"], \"event\": \"Configured CORS middleware\"}\r\n{\"api_prefix\": \"/api/v1\", \"event\": \"Configured application routes\"}\r\n{\"app_name\": \"salesforce-chatbot\", \"version\": \"1.0.0\", \"debug\": false, \"event\": \"Created FastAPI application\"}\r\n{\"version\": \"1.0.0\", \"event\": \"Starting Account Q&A Bot application\"}\r\n{\"event\": \"Initializing Azure service clients\"}\r\n{\"endpoint\": \"https://salesforcebot-aoai.cognitiveservices.azure.com\", \"chat_deployment\": \"gpt-4o\", \"embedding_deployment\": \"text-embedding-3-small\", \"event\": \"Initializing Azure OpenAI client\"}\r\n{\"event\": \"Azure OpenAI client initialized successfully\"}\r\n{\"endpoint\": \"https://salesforcebot-cosmos-sql.documents.azure.com:443/\", \"database\": \"appdb\", \"event\": \"Initializing Cosmos DB client\"}\r\n{\"event\": \"Cosmos DB client initialized successfully\"}\r\n{\"endpoint\": \"https://salesforcebot-cosmos-graph.gremlin.cosmos.azure.com:443/\", \"database\": \"graphdb\", \"graph\": \"account_graph\", \"event\": \"Initializing Gremlin client\"}\r\n{\"event\": \"Gremlin client initialized successfully\"}\r\n{\"event\": \"Fabric client initialized successfully\"}\r\n{\"event\": \"Initializing data repositories\"}\r\n{\"container\": \"chat_history\", \"event\": \"Initialized chat history repository\"}\r\n{\"container\": \"chat_history\", \"event\": \"Initialized chat history repository\"}\r\n{\"event\": \"Initializing application services\"}\r\n{\"enforce_rbac\": false, \"admin_users\": 0, \"event\": \"Initialized RBAC service\"}\r\n{\"enforce_rbac\": false, \"admin_users\": 0, \"event\": \"Initialized RBAC service\"}\r\n{\"min_similarity\": 0.3, \"max_candidates\": 20, \"event\": \"Account resolver filter initialized\"}\r\n{\"use_tfidf\": true, \"confidence_threshold\": 0.8, \"tfidf_threshold\": 0.3, \"event\": \"Account resolver service initialized\"}\r\n{\"confidence_threshold\": 0.8, \"event\": \"Account resolver service initialized\"}\r\n{\"event\": \"Initializing Semantic Kernel agents\"}\r\n{\"event\": \"Planner configuration skipped - using basic kernel functionality\"}\r\n{\"event\": \"Planner service initialized\"}\r\n{\"event\": \"SQL agent plugin registered with kernel\"}\r\n{\"event\": \"SQL agent enabled\"}\r\n{\"event\": \"Graph agent enabled\"}\r\n{\"event\": \"Graph agent plugin registered with kernel\"}\r\n{\"event\": \"Agents will load functions dynamically from database\"}\r\n{\"event\": \"Application startup completed successfully\"}\r\n{\"request_id\": \"aa276cf6\", \"method\": \"GET\", \"url\": \"http://127.0.0.1:8000/health\", \"user_agent\": \"Mozilla/5.0 (Windows NT; Windows NT 10.0; en-CA) WindowsPowerShell/5.1.26100.3624\", \"event\": \"HTTP request started\"}\r\nDEBUG: [aa276cf6] REQUEST START: GET http://127.0.0.1:8000/health\r\nDEBUG: [aa276cf6] Headers: {'user-agent': 'Mozilla/5.0 (Windows NT; Windows NT 10.0; en-CA) WindowsPowerShell/5.1.26100.3624', 'host': '127.0.0.1:8000', 'connection': 'Keep-Alive'}\r\nDEBUG: [aa276cf6] Tasks before request: 4\r\nDEBUG: [aa276cf6] Event loop running: True, closed: False\r\nDEBUG: [aa276cf6] About to call next middleware/handler\r\nDEBUG: [aa276cf6] Handler completed successfully\r\nDEBUG: [aa276cf6] Response status: 307\r\nDEBUG: [aa276cf6] Tasks after request: 5\r\nDEBUG: [aa276cf6] Event loop running: True, closed: False\r\n{\"request_id\": \"aa276cf6\", \"method\": \"GET\", \"url\": \"http://127.0.0.1:8000/health\", \"status_code\": 307, \"duration_ms\": 1, \"event\": \"HTTP request completed\"}\r\nDEBUG: [aa276cf6] REQUEST COMPLETED successfully\r\nINFO:     127.0.0.1:61277 - \"GET /health HTTP/1.1\" 307 Temporary Redirect\r\n{\"request_id\": \"15326ea2\", \"method\": \"GET\", \"url\": \"http://127.0.0.1:8000/health/\", \"user_agent\": \"Mozilla/5.0 (Windows NT; Windows NT 10.0; en-CA) WindowsPowerShell/5.1.26100.3624\", \"event\": \"HTTP request started\"}\r\nDEBUG: [15326ea2] REQUEST START: GET http://127.0.0.1:8000/health/\r\nDEBUG: [15326ea2] Headers: {'user-agent': 'Mozilla/5.0 (Windows NT; Windows NT 10.0; en-CA) WindowsPowerShell/5.1.26100.3624', 'host': '127.0.0.1:8000'}\r\nDEBUG: [15326ea2] Tasks before request: 4\r\nDEBUG: [15326ea2] Event loop running: True, closed: False\r\nDEBUG: [15326ea2] About to call next middleware/handler\r\nDEBUG: [15326ea2] Handler completed successfully\r\nDEBUG: [15326ea2] Response status: 200\r\nDEBUG: [15326ea2] Tasks after request: 5\r\nDEBUG: [15326ea2] Event loop running: True, closed: False\r\n{\"request_id\": \"15326ea2\", \"method\": \"GET\", \"url\": \"http://127.0.0.1:8000/health/\", \"status_code\": 200, \"duration_ms\": 1, \"event\": \"HTTP request completed\"}\r\nDEBUG: [15326ea2] REQUEST COMPLETED successfully\r\nINFO:     127.0.0.1:61277 - \"GET /health/ HTTP/1.1\" 200 OK\r\n{\"request_id\": \"e22d56e9\", \"method\": \"GET\", \"url\": \"http://127.0.0.1:8000/health\", \"user_agent\": \"Mozilla/5.0 (Windows NT; Windows NT 10.0; en-CA) WindowsPowerShell/5.1.26100.3624\", \"event\": \"HTTP request started\"}\r\nDEBUG: [e22d56e9] REQUEST START: GET http://127.0.0.1:8000/health\r\nDEBUG: [e22d56e9] Headers: {'user-agent': 'Mozilla/5.0 (Windows NT; Windows NT 10.0; en-CA) WindowsPowerShell/5.1.26100.3624', 'host': '127.0.0.1:8000', 'connection': 'Keep-Alive'}\r\nDEBUG: [e22d56e9] Tasks before request: 4\r\nDEBUG: [e22d56e9] Event loop running: True, closed: False\r\nDEBUG: [e22d56e9] About to call next middleware/handler\r\nDEBUG: [e22d56e9] Handler completed successfully\r\nDEBUG: [e22d56e9] Response status: 307\r\nDEBUG: [e22d56e9] Tasks after request: 5\r\nDEBUG: [e22d56e9] Event loop running: True, closed: False\r\n{\"request_id\": \"e22d56e9\", \"method\": \"GET\", \"url\": \"http://127.0.0.1:8000/health\", \"status_code\": 307, \"duration_ms\": 10, \"event\": \"HTTP request completed\"}\r\nDEBUG: [e22d56e9] REQUEST COMPLETED successfully\r\nINFO:     127.0.0.1:61279 - \"GET /health HTTP/1.1\" 307 Temporary Redirect\r\n{\"request_id\": \"55aca5bf\", \"method\": \"GET\", \"url\": \"http://127.0.0.1:8000/health/\", \"user_agent\": \"Mozilla/5.0 (Windows NT; Windows NT 10.0; en-CA) WindowsPowerShell/5.1.26100.3624\", \"event\": \"HTTP request started\"}\r\nDEBUG: [55aca5bf] REQUEST START: GET http://127.0.0.1:8000/health/\r\nDEBUG: [55aca5bf] Headers: {'user-agent': 'Mozilla/5.0 (Windows NT; Windows NT 10.0; en-CA) WindowsPowerShell/5.1.26100.3624', 'host': '127.0.0.1:8000'}\r\nDEBUG: [55aca5bf] Tasks before request: 4\r\nDEBUG: [55aca5bf] Event loop running: True, closed: False\r\nDEBUG: [55aca5bf] About to call next middleware/handler\r\nDEBUG: [55aca5bf] Handler completed successfully\r\nDEBUG: [55aca5bf] Response status: 200\r\nDEBUG: [55aca5bf] Tasks after request: 5\r\nDEBUG: [55aca5bf] Event loop running: True, closed: False\r\n{\"request_id\": \"55aca5bf\", \"method\": \"GET\", \"url\": \"http://127.0.0.1:8000/health/\", \"status_code\": 200, \"duration_ms\": 0, \"event\": \"HTTP request completed\"}\r\nDEBUG: [55aca5bf] REQUEST COMPLETED successfully\r\nINFO:     127.0.0.1:61279 - \"GET /health/ HTTP/1.1\" 200 OK\r\n{\"request_id\": \"04c99b61\", \"method\": \"POST\", \"url\": \"http://localhost:8000/api/v1/chat\", \"user_agent\": \"python-requests/2.32.5\", \"event\": \"HTTP request started\"}\r\nDEBUG: [04c99b61] REQUEST START: POST http://localhost:8000/api/v1/chat\r\nDEBUG: [04c99b61] Headers: {'host': 'localhost:8000', 'user-agent': 'python-requests/2.32.5', 'accept-encoding': 'gzip, deflate', 'accept': '*/*', 'connection': 'keep-alive', 'content-length': '175', 'content-type': 'application/json'}\r\nDEBUG: [04c99b61] Tasks before request: 4\r\nDEBUG: [04c99b61] Event loop running: True, closed: False\r\nDEBUG: [04c99b61] About to call next middleware/handler\r\n{\"url\": \"http://localhost:8000/api/v1/chat\", \"event\": \"Authenticating user request\"}\r\n{\"event\": \"Using fallback RBAC context\"}\r\n{\"event\": \"Fallback RBAC context created successfully\"}\r\n{\"session_id\": \"s_no_tool\", \"turn_id\": \"b2e26565-4fde-4032-8b49-96dca0e4f3d6\", \"user_id\": \"tester_no_tool\", \"message_length\": 45, \"event\": \"Processing chat message\"}\r\n{\"event\": \"Created Cosmos DB client with managed identity\"}\r\n{\"container\": \"chat_history\", \"error\": \"(Forbidden) Request blocked by Auth salesforcebot-cosmos-sql : The given request [POST /dbs/appdb/colls/] cannot be authorized by AAD token in data plane. Learn more: https://aka.ms/cosmos-native-rbac.\\r\\nActivityId: a34ca067-8432-4ce4-897a-0e0680f4337d, Microsoft.Azure.Documents.Common/2.14.0\\nCode: Forbidden\\nMessage: Request blocked by Auth salesforcebot-cosmos-sql : The given request [POST /dbs/appdb/colls/] cannot be authorized by AAD token in data plane. Learn more: https://aka.ms/cosmos-native-rbac.\\r\\nActivityId: a34ca067-8432-4ce4-897a-0e0680f4337d, Microsoft.Azure.Documents.Common/2.14.0\", \"event\": \"Failed to create container due to AAD data-plane authorization. Cosmos may require key auth for management operations or pre-created containers. See https://aka.ms/cosmos-native-rbac for details.\"}\r\n{\"container\": \"chat_history\", \"error\": \"(Forbidden) Request blocked by Auth salesforcebot-cosmos-sql : The given request [POST /dbs/appdb/colls/] cannot be authorized by AAD token in data plane. Learn more: https://aka.ms/cosmos-native-rbac.\\r\\nActivityId: 82464029-357b-4790-a2f1-5181c68af40d, Microsoft.Azure.Documents.Common/2.14.0\\nCode: Forbidden\\nMessage: Request blocked by Auth salesforcebot-cosmos-sql : The given request [POST /dbs/appdb/colls/] cannot be authorized by AAD token in data plane. Learn more: https://aka.ms/cosmos-native-rbac.\\r\\nActivityId: 82464029-357b-4790-a2f1-5181c68af40d, Microsoft.Azure.Documents.Common/2.14.0\", \"event\": \"Failed to create container due to AAD data-plane authorization. Cosmos may require key auth for management operations or pre-created containers. See https://aka.ms/cosmos-native-rbac for details.\"}\r\n{\"container\": \"chat_history\", \"error\": \"(Forbidden) Request blocked by Auth salesforcebot-cosmos-sql : The given request [POST /dbs/appdb/colls/] cannot be authorized by AAD token in data plane. Learn more: https://aka.ms/cosmos-native-rbac.\\r\\nActivityId: 5cb04d1b-7156-403c-9150-38a2d45d476f, Microsoft.Azure.Documents.Common/2.14.0\\nCode: Forbidden\\nMessage: Request blocked by Auth salesforcebot-cosmos-sql : The given request [POST /dbs/appdb/colls/] cannot be authorized by AAD token in data plane. Learn more: https://aka.ms/cosmos-native-rbac.\\r\\nActivityId: 5cb04d1b-7156-403c-9150-38a2d45d476f, Microsoft.Azure.Documents.Common/2.14.0\", \"event\": \"Failed to create container due to AAD data-plane authorization. Cosmos may require key auth for management operations or pre-created containers. See https://aka.ms/cosmos-native-rbac for details.\"}\r\n{\"chat_id\": \"s_no_tool\", \"user_id\": \"user@example.com\", \"error\": \"RetryError[<Future at 0x22263e6f9d0 state=finished raised CosmosHttpResponseError>]\", \"event\": \"Failed to get chat history\"}\r\n{\"chat_id\": \"s_no_tool\", \"user_id\": \"user@example.com\", \"event\": \"Chat history not found\"}\r\n{\"error\": \"'name'\", \"event\": \"Failed to list function definitions\"}\r\n{\"user_id\": \"user@example.com\", \"error\": \"'name'\", \"event\": \"Failed to get filtered functions\"}\r\n{\"agent_name\": \"planner_system\", \"tenant_id\": \"tenant123\", \"scenario\": \"general\", \"prompt_id\": \"prompt_planner_system\", \"event\": \"Retrieved system prompt\"}\r\n{\"plan_id\": \"13adebb3-b968-4f8f-a784-87c5fe1e797a\", \"plan_type\": \"no_tool\", \"agent_type\": \"direct_response\", \"user_id\": \"user@example.com\", \"event\": \"Basic plan created\"}\r\n{\"plan_id\": \"13adebb3-b968-4f8f-a784-87c5fe1e797a\", \"user_id\": \"user@example.com\", \"steps_count\": 1, \"planner_type\": \"sequential\", \"event\": \"Plan created successfully\"}\r\n{\"plan_id\": \"13adebb3-b968-4f8f-a784-87c5fe1e797a\", \"execution_id\": \"74504c94-427d-420e-9fce-f37dcaaeb330\", \"user_id\": \"user@example.com\", \"event\": \"Starting plan execution\"}\r\n{\"step_id\": \"7eaea05b-f56e-49de-a569-bcd50f3376b1\", \"tool_name\": \"direct_response\", \"user_id\": \"user@example.com\", \"event\": \"Executing plan step\"}\r\n{\"step_id\": \"7eaea05b-f56e-49de-a569-bcd50f3376b1\", \"event\": \"Direct response step executed successfully\"}\r\n{\"plan_id\": \"13adebb3-b968-4f8f-a784-87c5fe1e797a\", \"execution_id\": \"74504c94-427d-420e-9fce-f37dcaaeb330\", \"status\": \"completed\", \"duration_seconds\": 0.001089, \"event\": \"Plan execution completed\"}\r\n{\"container\": \"chat_history\", \"error\": \"(Forbidden) Request blocked by Auth salesforcebot-cosmos-sql : The given request [POST /dbs/appdb/colls/] cannot be authorized by AAD token in data plane. Learn more: https://aka.ms/cosmos-native-rbac.\\r\\nActivityId: 12a45390-6f98-4d5d-a50e-258232d232e4, Microsoft.Azure.Documents.Common/2.14.0\\nCode: Forbidden\\nMessage: Request blocked by Auth salesforcebot-cosmos-sql : The given request [POST /dbs/appdb/colls/] cannot be authorized by AAD token in data plane. Learn more: https://aka.ms/cosmos-native-rbac.\\r\\nActivityId: 12a45390-6f98-4d5d-a50e-258232d232e4, Microsoft.Azure.Documents.Common/2.14.0\", \"event\": \"Failed to create container due to AAD data-plane authorization. Cosmos may require key auth for management operations or pre-created containers. See https://aka.ms/cosmos-native-rbac for details.\"}\r\n{\"container\": \"chat_history\", \"error\": \"(Forbidden) Request blocked by Auth salesforcebot-cosmos-sql : The given request [POST /dbs/appdb/colls/] cannot be authorized by AAD token in data plane. Learn more: https://aka.ms/cosmos-native-rbac.\\r\\nActivityId: 33a51ee7-e505-43f7-af5a-f68fc6eb8b7d, Microsoft.Azure.Documents.Common/2.14.0\\nCode: Forbidden\\nMessage: Request blocked by Auth salesforcebot-cosmos-sql : The given request [POST /dbs/appdb/colls/] cannot be authorized by AAD token in data plane. Learn more: https://aka.ms/cosmos-native-rbac.\\r\\nActivityId: 33a51ee7-e505-43f7-af5a-f68fc6eb8b7d, Microsoft.Azure.Documents.Common/2.14.0\", \"event\": \"Failed to create container due to AAD data-plane authorization. Cosmos may require key auth for management operations or pre-created containers. See https://aka.ms/cosmos-native-rbac for details.\"}\r\n{\"container\": \"chat_history\", \"error\": \"(Forbidden) Request blocked by Auth salesforcebot-cosmos-sql : The given request [POST /dbs/appdb/colls/] cannot be authorized by AAD token in data plane. Learn more: https://aka.ms/cosmos-native-rbac.\\r\\nActivityId: 9614ca92-c321-4b83-ba7a-7c163ee7c887, Microsoft.Azure.Documents.Common/2.14.0\\nCode: Forbidden\\nMessage: Request blocked by Auth salesforcebot-cosmos-sql : The given request [POST /dbs/appdb/colls/] cannot be authorized by AAD token in data plane. Learn more: https://aka.ms/cosmos-native-rbac.\\r\\nActivityId: 9614ca92-c321-4b83-ba7a-7c163ee7c887, Microsoft.Azure.Documents.Common/2.14.0\", \"event\": \"Failed to create container due to AAD data-plane authorization. Cosmos may require key auth for management operations or pre-created containers. See https://aka.ms/cosmos-native-rbac for details.\"}\r\n{\"chat_id\": \"s_no_tool\", \"user_id\": \"user@example.com\", \"error\": \"RetryError[<Future at 0x22263e4f9b0 state=finished raised CosmosHttpResponseError>]\", \"event\": \"Failed to get chat history\"}\r\n{\"chat_id\": \"s_no_tool\", \"event\": \"Chat history not found for turn addition\"}\r\n{\"chat_id\": \"s_no_tool\", \"user_id\": \"user@example.com\", \"error\": \"Failed to save conversation turn to repository\", \"event\": \"Failed to add conversation turn\"}\r\n{\"event\": \"Failed to save conversation turn: Failed to save conversation turn to repository\"}\r\n{\"session_id\": \"s_no_tool\", \"turn_id\": \"b2e26565-4fde-4032-8b49-96dca0e4f3d6\", \"response_length\": 340, \"sources_count\": 0, \"event\": \"Chat message processed successfully\"}\r\nDEBUG: [04c99b61] Handler completed successfully\r\nDEBUG: [04c99b61] Response status: 200\r\nDEBUG: [04c99b61] Tasks after request: 5\r\nDEBUG: [04c99b61] Event loop running: True, closed: False\r\n{\"request_id\": \"04c99b61\", \"method\": \"POST\", \"url\": \"http://localhost:8000/api/v1/chat\", \"status_code\": 200, \"duration_ms\": 21555, \"event\": \"HTTP request completed\"}\r\nDEBUG: [04c99b61] REQUEST COMPLETED successfully\r\nINFO:     127.0.0.1:61283 - \"POST /api/v1/chat HTTP/1.1\" 200 OK\r\n{\"request_id\": \"794bbb6a\", \"method\": \"POST\", \"url\": \"http://localhost:8000/api/v1/chat\", \"user_agent\": \"python-requests/2.32.5\", \"event\": \"HTTP request started\"}\r\nDEBUG: [794bbb6a] REQUEST START: POST http://localhost:8000/api/v1/chat\r\nDEBUG: [794bbb6a] Headers: {'host': 'localhost:8000', 'user-agent': 'python-requests/2.32.5', 'accept-encoding': 'gzip, deflate', 'accept': '*/*', 'connection': 'keep-alive', 'content-length': '165', 'content-type': 'application/json'}\r\nDEBUG: [794bbb6a] Tasks before request: 4\r\nDEBUG: [794bbb6a] Event loop running: True, closed: False\r\nDEBUG: [794bbb6a] About to call next middleware/handler\r\n{\"url\": \"http://localhost:8000/api/v1/chat\", \"event\": \"Authenticating user request\"}\r\n{\"event\": \"Using fallback RBAC context\"}\r\n{\"event\": \"Fallback RBAC context created successfully\"}\r\n{\"session_id\": \"s_sql\", \"turn_id\": \"f280e860-9351-49ea-a4df-ee793b8f55a5\", \"user_id\": \"tester_sql\", \"message_length\": 42, \"event\": \"Processing chat message\"}\r\n{\"container\": \"chat_history\", \"error\": \"(Forbidden) Request blocked by Auth salesforcebot-cosmos-sql : The given request [POST /dbs/appdb/colls/] cannot be authorized by AAD token in data plane. Learn more: https://aka.ms/cosmos-native-rbac.\\r\\nActivityId: 734fe648-306c-4a28-9cab-5bcb674f820b, Microsoft.Azure.Documents.Common/2.14.0\\nCode: Forbidden\\nMessage: Request blocked by Auth salesforcebot-cosmos-sql : The given request [POST /dbs/appdb/colls/] cannot be authorized by AAD token in data plane. Learn more: https://aka.ms/cosmos-native-rbac.\\r\\nActivityId: 734fe648-306c-4a28-9cab-5bcb674f820b, Microsoft.Azure.Documents.Common/2.14.0\", \"event\": \"Failed to create container due to AAD data-plane authorization. Cosmos may require key auth for management operations or pre-created containers. See https://aka.ms/cosmos-native-rbac for details.\"}\r\n{\"container\": \"chat_history\", \"error\": \"(Forbidden) Request blocked by Auth salesforcebot-cosmos-sql : The given request [POST /dbs/appdb/colls/] cannot be authorized by AAD token in data plane. Learn more: https://aka.ms/cosmos-native-rbac.\\r\\nActivityId: 0950d424-4bd4-4e1a-a0b5-e5679ab220ce, Microsoft.Azure.Documents.Common/2.14.0\\nCode: Forbidden\\nMessage: Request blocked by Auth salesforcebot-cosmos-sql : The given request [POST /dbs/appdb/colls/] cannot be authorized by AAD token in data plane. Learn more: https://aka.ms/cosmos-native-rbac.\\r\\nActivityId: 0950d424-4bd4-4e1a-a0b5-e5679ab220ce, Microsoft.Azure.Documents.Common/2.14.0\", \"event\": \"Failed to create container due to AAD data-plane authorization. Cosmos may require key auth for management operations or pre-created containers. See https://aka.ms/cosmos-native-rbac for details.\"}\r\n{\"container\": \"chat_history\", \"error\": \"(Forbidden) Request blocked by Auth salesforcebot-cosmos-sql : The given request [POST /dbs/appdb/colls/] cannot be authorized by AAD token in data plane. Learn more: https://aka.ms/cosmos-native-rbac.\\r\\nActivityId: b60f8435-f620-46f4-9aa5-400219144524, Microsoft.Azure.Documents.Common/2.14.0\\nCode: Forbidden\\nMessage: Request blocked by Auth salesforcebot-cosmos-sql : The given request [POST /dbs/appdb/colls/] cannot be authorized by AAD token in data plane. Learn more: https://aka.ms/cosmos-native-rbac.\\r\\nActivityId: b60f8435-f620-46f4-9aa5-400219144524, Microsoft.Azure.Documents.Common/2.14.0\", \"event\": \"Failed to create container due to AAD data-plane authorization. Cosmos may require key auth for management operations or pre-created containers. See https://aka.ms/cosmos-native-rbac for details.\"}\r\n{\"chat_id\": \"s_sql\", \"user_id\": \"user@example.com\", \"error\": \"RetryError[<Future at 0x22262648a50 state=finished raised CosmosHttpResponseError>]\", \"event\": \"Failed to get chat history\"}\r\n{\"chat_id\": \"s_sql\", \"user_id\": \"user@example.com\", \"event\": \"Chat history not found\"}\r\n{\"error\": \"'name'\", \"event\": \"Failed to list function definitions\"}\r\n{\"user_id\": \"user@example.com\", \"error\": \"'name'\", \"event\": \"Failed to get filtered functions\"}\r\n{\"agent_name\": \"planner_system\", \"tenant_id\": \"tenant123\", \"scenario\": \"general\", \"prompt_id\": \"prompt_planner_system\", \"event\": \"Retrieved system prompt\"}\r\n{\"plan_id\": \"45769fe9-99ad-4da4-b07b-dc72d36901a5\", \"plan_type\": \"sql_only\", \"agent_type\": \"sql_agent\", \"user_id\": \"user@example.com\", \"event\": \"Basic plan created\"}\r\n{\"plan_id\": \"45769fe9-99ad-4da4-b07b-dc72d36901a5\", \"user_id\": \"user@example.com\", \"steps_count\": 1, \"planner_type\": \"sequential\", \"event\": \"Plan created successfully\"}\r\n{\"plan_id\": \"45769fe9-99ad-4da4-b07b-dc72d36901a5\", \"execution_id\": \"3d0b983a-e584-405b-bf89-644c461674d1\", \"user_id\": \"user@example.com\", \"event\": \"Starting plan execution\"}\r\n{\"step_id\": \"eb028f60-fc7f-4b8e-8fd8-956bc95c02b3\", \"tool_name\": \"sql_agent\", \"user_id\": \"user@example.com\", \"event\": \"Executing plan step\"}\r\n{\"user_query\": \"Run a SQL-only plan to fetch account info.\", \"data_types\": \"opportunities,contacts,cases,revenue\", \"limit\": \"20\", \"user_id\": \"user@example.com\", \"event\": \"Querying account data from user query\"}\r\n{\"user_id\": \"user@example.com\", \"query_length\": 42, \"use_tfidf\": true, \"event\": \"Starting account resolution\"}\r\n{\"key\": \"allowed_accounts:user@example.com\", \"error\": \"Object of type datetime is not JSON serializable\", \"event\": \"Failed to set cache item\"}\r\n{\"account_count\": 3, \"event\": \"Fitting TF-IDF filter\"}\r\n{\"account_count\": 3, \"event\": \"Fitting TF-IDF vectorizer on account corpus\"}\r\n{\"error\": \"\\n**********************************************************************\\n  Resource \\u001b[93mpunkt_tab\\u001b[0m not found.\\n  Please use the NLTK Downloader to obtain the resource:\\n\\n  \\u001b[31m>>> import nltk\\n  >>> nltk.download('punkt_tab')\\n  \\u001b[0m\\n  For more information see: https://www.nltk.org/data.html\\n\\n  Attempted to load \\u001b[93mtokenizers/punkt_tab/english/\\u001b[0m\\n\\n  Searched in:\\n    - 'C:\\\\\\\\Users\\\\\\\\mcarz/nltk_data'\\n    - 'C:\\\\\\\\Users\\\\\\\\mcarz\\\\\\\\AppData\\\\\\\\Local\\\\\\\\Programs\\\\\\\\Python\\\\\\\\Python313\\\\\\\\nltk_data'\\n    - 'C:\\\\\\\\Users\\\\\\\\mcarz\\\\\\\\AppData\\\\\\\\Local\\\\\\\\Programs\\\\\\\\Python\\\\\\\\Python313\\\\\\\\share\\\\\\\\nltk_data'\\n    - 'C:\\\\\\\\Users\\\\\\\\mcarz\\\\\\\\AppData\\\\\\\\Local\\\\\\\\Programs\\\\\\\\Python\\\\\\\\Python313\\\\\\\\lib\\\\\\\\nltk_data'\\n    - 'C:\\\\\\\\Users\\\\\\\\mcarz\\\\\\\\AppData\\\\\\\\Roaming\\\\\\\\nltk_data'\\n    - 'C:\\\\\\\\nltk_data'\\n    - 'D:\\\\\\\\nltk_data'\\n    - 'E:\\\\\\\\nltk_data'\\n**********************************************************************\\n\", \"event\": \"Failed to fit TF-IDF vectorizer\"}\r\n{\"error\": \"\\n**********************************************************************\\n  Resource \\u001b[93mpunkt_tab\\u001b[0m not found.\\n  Please use the NLTK Downloader to obtain the resource:\\n\\n  \\u001b[31m>>> import nltk\\n  >>> nltk.download('punkt_tab')\\n  \\u001b[0m\\n  For more information see: https://www.nltk.org/data.html\\n\\n  Attempted to load \\u001b[93mtokenizers/punkt_tab/english/\\u001b[0m\\n\\n  Searched in:\\n    - 'C:\\\\\\\\Users\\\\\\\\mcarz/nltk_data'\\n    - 'C:\\\\\\\\Users\\\\\\\\mcarz\\\\\\\\AppData\\\\\\\\Local\\\\\\\\Programs\\\\\\\\Python\\\\\\\\Python313\\\\\\\\nltk_data'\\n    - 'C:\\\\\\\\Users\\\\\\\\mcarz\\\\\\\\AppData\\\\\\\\Local\\\\\\\\Programs\\\\\\\\Python\\\\\\\\Python313\\\\\\\\share\\\\\\\\nltk_data'\\n    - 'C:\\\\\\\\Users\\\\\\\\mcarz\\\\\\\\AppData\\\\\\\\Local\\\\\\\\Programs\\\\\\\\Python\\\\\\\\Python313\\\\\\\\lib\\\\\\\\nltk_data'\\n    - 'C:\\\\\\\\Users\\\\\\\\mcarz\\\\\\\\AppData\\\\\\\\Roaming\\\\\\\\nltk_data'\\n    - 'C:\\\\\\\\nltk_data'\\n    - 'D:\\\\\\\\nltk_data'\\n    - 'E:\\\\\\\\nltk_data'\\n**********************************************************************\\n\", \"event\": \"Failed to fit TF-IDF filter\"}\r\n{\"event\": \"TF-IDF vectorizer not fitted, returning empty results\"}\r\n{\"event\": \"Created Azure OpenAI client with managed identity token\"}\r\n{\"error\": \"Connection error.\", \"deployment\": \"gpt-4o\", \"message_count\": 2, \"event\": \"Failed to create chat completion\"}\r\n{\"event\": \"Created Azure OpenAI client with managed identity token\"}\r\n{\"error\": \"Connection error.\", \"deployment\": \"gpt-4o\", \"message_count\": 2, \"event\": \"Failed to create chat completion\"}\r\n{\"event\": \"Created Azure OpenAI client with managed identity token\"}\r\n{\"error\": \"Connection error.\", \"deployment\": \"gpt-4o\", \"message_count\": 2, \"event\": \"Failed to create chat completion\"}\r\n{\"error\": \"RetryError[<Future at 0x22263f11040 state=finished raised APIConnectionError>]\", \"event\": \"Failed to extract account candidates\"}\r\n{\"user_id\": \"user@example.com\", \"candidates_count\": 2, \"resolved_count\": 0, \"requires_disambiguation\": true, \"confidence\": 0.0, \"event\": \"LLM + embeddings resolution completed\"}\r\n{\"method\": \"llm_primary\", \"combined_confidence\": 0.0, \"resolved_count\": 0, \"suggestions_count\": 3, \"event\": \"Combined resolution results\"}\r\n{\"event_id\": \"9e87b43f-e7ef-4dbd-918d-6c708920a799\", \"event_type\": \"performance_metric\", \"severity\": \"info\", \"user_id\": \"user@example.com\", \"session_id\": null, \"event\": \"Telemetry event tracked\"}\r\n{\"user_query\": \"Run a SQL-only plan to fetch account info.\", \"error\": \"string indices must be integers, not 'str'\", \"event\": \"Failed to query account data\"}\r\n{\"step_id\": \"eb028f60-fc7f-4b8e-8fd8-956bc95c02b3\", \"event\": \"Step executed successfully\"}\r\n{\"plan_id\": \"45769fe9-99ad-4da4-b07b-dc72d36901a5\", \"execution_id\": \"3d0b983a-e584-405b-bf89-644c461674d1\", \"status\": \"completed\", \"duration_seconds\": 21.463812, \"event\": \"Plan execution completed\"}\r\n{\"database\": \"telemetry\", \"event\": \"Database not found, creating new database\"}\r\n{\"database\": \"telemetry\", \"container\": \"events\", \"error\": \"(Forbidden) Request blocked by Auth salesforcebot-cosmos-sql : The given request [POST /dbs] cannot be authorized by AAD token in data plane. Learn more: https://aka.ms/cosmos-native-rbac.\\r\\nActivityId: 598cad34-ee7e-44de-8089-54f0f3826428, Microsoft.Azure.Documents.Common/2.14.0\\nCode: Forbidden\\nMessage: Request blocked by Auth salesforcebot-cosmos-sql : The given request [POST /dbs] cannot be authorized by AAD token in data plane. Learn more: https://aka.ms/cosmos-native-rbac.\\r\\nActivityId: 598cad34-ee7e-44de-8089-54f0f3826428, Microsoft.Azure.Documents.Common/2.14.0\", \"event\": \"Failed to get or create container for database\"}\r\n{\"error\": \"(Forbidden) Request blocked by Auth salesforcebot-cosmos-sql : The given request [POST /dbs] cannot be authorized by AAD token in data plane. Learn more: https://aka.ms/cosmos-native-rbac.\\r\\nActivityId: 598cad34-ee7e-44de-8089-54f0f3826428, Microsoft.Azure.Documents.Common/2.14.0\\nCode: Forbidden\\nMessage: Request blocked by Auth salesforcebot-cosmos-sql : The given request [POST /dbs] cannot be authorized by AAD token in data plane. Learn more: https://aka.ms/cosmos-native-rbac.\\r\\nActivityId: 598cad34-ee7e-44de-8089-54f0f3826428, Microsoft.Azure.Documents.Common/2.14.0\", \"event\": \"Failed to store telemetry event\"}\r\n{\"container\": \"chat_history\", \"error\": \"(Forbidden) Request blocked by Auth salesforcebot-cosmos-sql : The given request [POST /dbs/appdb/colls/] cannot be authorized by AAD token in data plane. Learn more: https://aka.ms/cosmos-native-rbac.\\r\\nActivityId: 2c05bbee-6962-4625-9afc-5d4e395fa9dd, Microsoft.Azure.Documents.Common/2.14.0\\nCode: Forbidden\\nMessage: Request blocked by Auth salesforcebot-cosmos-sql : The given request [POST /dbs/appdb/colls/] cannot be authorized by AAD token in data plane. Learn more: https://aka.ms/cosmos-native-rbac.\\r\\nActivityId: 2c05bbee-6962-4625-9afc-5d4e395fa9dd, Microsoft.Azure.Documents.Common/2.14.0\", \"event\": \"Failed to create container due to AAD data-plane authorization. Cosmos may require key auth for management operations or pre-created containers. See https://aka.ms/cosmos-native-rbac for details.\"}\r\n{\"container\": \"chat_history\", \"error\": \"(Forbidden) Request blocked by Auth salesforcebot-cosmos-sql : The given request [POST /dbs/appdb/colls/] cannot be authorized by AAD token in data plane. Learn more: https://aka.ms/cosmos-native-rbac.\\r\\nActivityId: dcf6fa72-7dfd-4ee8-af68-1f11271cf614, Microsoft.Azure.Documents.Common/2.14.0\\nCode: Forbidden\\nMessage: Request blocked by Auth salesforcebot-cosmos-sql : The given request [POST /dbs/appdb/colls/] cannot be authorized by AAD token in data plane. Learn more: https://aka.ms/cosmos-native-rbac.\\r\\nActivityId: dcf6fa72-7dfd-4ee8-af68-1f11271cf614, Microsoft.Azure.Documents.Common/2.14.0\", \"event\": \"Failed to create container due to AAD data-plane authorization. Cosmos may require key auth for management operations or pre-created containers. See https://aka.ms/cosmos-native-rbac for details.\"}\r\n{\"container\": \"chat_history\", \"error\": \"(Forbidden) Request blocked by Auth salesforcebot-cosmos-sql : The given request [POST /dbs/appdb/colls/] cannot be authorized by AAD token in data plane. Learn more: https://aka.ms/cosmos-native-rbac.\\r\\nActivityId: d75612e0-6aba-4fe6-a9dd-e111d5fcd89d, Microsoft.Azure.Documents.Common/2.14.0\\nCode: Forbidden\\nMessage: Request blocked by Auth salesforcebot-cosmos-sql : The given request [POST /dbs/appdb/colls/] cannot be authorized by AAD token in data plane. Learn more: https://aka.ms/cosmos-native-rbac.\\r\\nActivityId: d75612e0-6aba-4fe6-a9dd-e111d5fcd89d, Microsoft.Azure.Documents.Common/2.14.0\", \"event\": \"Failed to create container due to AAD data-plane authorization. Cosmos may require key auth for management operations or pre-created containers. See https://aka.ms/cosmos-native-rbac for details.\"}\r\n{\"chat_id\": \"s_sql\", \"user_id\": \"user@example.com\", \"error\": \"RetryError[<Future at 0x22263ee2410 state=finished raised CosmosHttpResponseError>]\", \"event\": \"Failed to get chat history\"}\r\n{\"chat_id\": \"s_sql\", \"event\": \"Chat history not found for turn addition\"}\r\n{\"chat_id\": \"s_sql\", \"user_id\": \"user@example.com\", \"error\": \"Failed to save conversation turn to repository\", \"event\": \"Failed to add conversation turn\"}\r\n{\"event\": \"Failed to save conversation turn: Failed to save conversation turn to repository\"}\r\n{\"session_id\": \"s_sql\", \"turn_id\": \"f280e860-9351-49ea-a4df-ee793b8f55a5\", \"response_length\": 133, \"sources_count\": 0, \"event\": \"Chat message processed successfully\"}\r\nDEBUG: [794bbb6a] Handler completed successfully\r\nDEBUG: [794bbb6a] Response status: 200\r\nDEBUG: [794bbb6a] Tasks after request: 5\r\nDEBUG: [794bbb6a] Event loop running: True, closed: False\r\n{\"request_id\": \"794bbb6a\", \"method\": \"POST\", \"url\": \"http://localhost:8000/api/v1/chat\", \"status_code\": 200, \"duration_ms\": 39835, \"event\": \"HTTP request completed\"}\r\nDEBUG: [794bbb6a] REQUEST COMPLETED successfully\r\nINFO:     127.0.0.1:61295 - \"POST /api/v1/chat HTTP/1.1\" 200 OK\r\n"
    },
    {
      "scenario": "graph_only",
      "response": {
        "status_code": 200,
        "json": {
          "session_id": "s_graph",
          "turn_id": "0a174ddf-3fdf-4dc7-ab3f-6fcb6a50733a",
          "choices": [
            {
              "index": 0,
              "message": {
                "role": "assistant",
                "content": "{\"success\": false, \"error\": \"No accounts could be resolved from the query\", \"user_query\": \"Run a Graph-only plan to explore relationships.\", \"suggestion\": \"Please mention specific account names in your query\"}"
              },
              "finish_reason": "stop"
            }
          ],
          "usage": {
            "prompt_tokens": 7,
            "completion_tokens": 28,
            "total_tokens": 35
          },
          "sources": [],
          "metadata": {
            "mode": "agent_execution",
            "plan_id": "74c89ff2-3f48-4f0a-aa0a-7eefa23c51d9",
            "plan_type": "graph_only",
            "execution_id": "2af5f0c2-a154-4ce9-9fd1-869ba744efcd",
            "steps_executed": 1,
            "execution_status": "completed",
            "timestamp": "2025-09-20T18:39:20.414142"
          }
        },
        "text": null
      },
      "log_tail": "{\"origins\": [\"*\"], \"event\": \"Configured CORS middleware\"}\r\n{\"api_prefix\": \"/api/v1\", \"event\": \"Configured application routes\"}\r\n{\"app_name\": \"salesforce-chatbot\", \"version\": \"1.0.0\", \"debug\": false, \"event\": \"Created FastAPI application\"}\r\n{\"version\": \"1.0.0\", \"event\": \"Starting Account Q&A Bot application\"}\r\n{\"event\": \"Initializing Azure service clients\"}\r\n{\"endpoint\": \"https://salesforcebot-aoai.cognitiveservices.azure.com\", \"chat_deployment\": \"gpt-4o\", \"embedding_deployment\": \"text-embedding-3-small\", \"event\": \"Initializing Azure OpenAI client\"}\r\n{\"event\": \"Azure OpenAI client initialized successfully\"}\r\n{\"endpoint\": \"https://salesforcebot-cosmos-sql.documents.azure.com:443/\", \"database\": \"appdb\", \"event\": \"Initializing Cosmos DB client\"}\r\n{\"event\": \"Cosmos DB client initialized successfully\"}\r\n{\"endpoint\": \"https://salesforcebot-cosmos-graph.gremlin.cosmos.azure.com:443/\", \"database\": \"graphdb\", \"graph\": \"account_graph\", \"event\": \"Initializing Gremlin client\"}\r\n{\"event\": \"Gremlin client initialized successfully\"}\r\n{\"event\": \"Fabric client initialized successfully\"}\r\n{\"event\": \"Initializing data repositories\"}\r\n{\"container\": \"chat_history\", \"event\": \"Initialized chat history repository\"}\r\n{\"container\": \"chat_history\", \"event\": \"Initialized chat history repository\"}\r\n{\"event\": \"Initializing application services\"}\r\n{\"enforce_rbac\": false, \"admin_users\": 0, \"event\": \"Initialized RBAC service\"}\r\n{\"enforce_rbac\": false, \"admin_users\": 0, \"event\": \"Initialized RBAC service\"}\r\n{\"min_similarity\": 0.3, \"max_candidates\": 20, \"event\": \"Account resolver filter initialized\"}\r\n{\"use_tfidf\": true, \"confidence_threshold\": 0.8, \"tfidf_threshold\": 0.3, \"event\": \"Account resolver service initialized\"}\r\n{\"confidence_threshold\": 0.8, \"event\": \"Account resolver service initialized\"}\r\n{\"event\": \"Initializing Semantic Kernel agents\"}\r\n{\"event\": \"Planner configuration skipped - using basic kernel functionality\"}\r\n{\"event\": \"Planner service initialized\"}\r\n{\"event\": \"SQL agent plugin registered with kernel\"}\r\n{\"event\": \"SQL agent enabled\"}\r\n{\"event\": \"Graph agent enabled\"}\r\n{\"event\": \"Graph agent plugin registered with kernel\"}\r\n{\"event\": \"Agents will load functions dynamically from database\"}\r\n{\"event\": \"Application startup completed successfully\"}\r\n{\"request_id\": \"aa276cf6\", \"method\": \"GET\", \"url\": \"http://127.0.0.1:8000/health\", \"user_agent\": \"Mozilla/5.0 (Windows NT; Windows NT 10.0; en-CA) WindowsPowerShell/5.1.26100.3624\", \"event\": \"HTTP request started\"}\r\nDEBUG: [aa276cf6] REQUEST START: GET http://127.0.0.1:8000/health\r\nDEBUG: [aa276cf6] Headers: {'user-agent': 'Mozilla/5.0 (Windows NT; Windows NT 10.0; en-CA) WindowsPowerShell/5.1.26100.3624', 'host': '127.0.0.1:8000', 'connection': 'Keep-Alive'}\r\nDEBUG: [aa276cf6] Tasks before request: 4\r\nDEBUG: [aa276cf6] Event loop running: True, closed: False\r\nDEBUG: [aa276cf6] About to call next middleware/handler\r\nDEBUG: [aa276cf6] Handler completed successfully\r\nDEBUG: [aa276cf6] Response status: 307\r\nDEBUG: [aa276cf6] Tasks after request: 5\r\nDEBUG: [aa276cf6] Event loop running: True, closed: False\r\n{\"request_id\": \"aa276cf6\", \"method\": \"GET\", \"url\": \"http://127.0.0.1:8000/health\", \"status_code\": 307, \"duration_ms\": 1, \"event\": \"HTTP request completed\"}\r\nDEBUG: [aa276cf6] REQUEST COMPLETED successfully\r\nINFO:     127.0.0.1:61277 - \"GET /health HTTP/1.1\" 307 Temporary Redirect\r\n{\"request_id\": \"15326ea2\", \"method\": \"GET\", \"url\": \"http://127.0.0.1:8000/health/\", \"user_agent\": \"Mozilla/5.0 (Windows NT; Windows NT 10.0; en-CA) WindowsPowerShell/5.1.26100.3624\", \"event\": \"HTTP request started\"}\r\nDEBUG: [15326ea2] REQUEST START: GET http://127.0.0.1:8000/health/\r\nDEBUG: [15326ea2] Headers: {'user-agent': 'Mozilla/5.0 (Windows NT; Windows NT 10.0; en-CA) WindowsPowerShell/5.1.26100.3624', 'host': '127.0.0.1:8000'}\r\nDEBUG: [15326ea2] Tasks before request: 4\r\nDEBUG: [15326ea2] Event loop running: True, closed: False\r\nDEBUG: [15326ea2] About to call next middleware/handler\r\nDEBUG: [15326ea2] Handler completed successfully\r\nDEBUG: [15326ea2] Response status: 200\r\nDEBUG: [15326ea2] Tasks after request: 5\r\nDEBUG: [15326ea2] Event loop running: True, closed: False\r\n{\"request_id\": \"15326ea2\", \"method\": \"GET\", \"url\": \"http://127.0.0.1:8000/health/\", \"status_code\": 200, \"duration_ms\": 1, \"event\": \"HTTP request completed\"}\r\nDEBUG: [15326ea2] REQUEST COMPLETED successfully\r\nINFO:     127.0.0.1:61277 - \"GET /health/ HTTP/1.1\" 200 OK\r\n{\"request_id\": \"e22d56e9\", \"method\": \"GET\", \"url\": \"http://127.0.0.1:8000/health\", \"user_agent\": \"Mozilla/5.0 (Windows NT; Windows NT 10.0; en-CA) WindowsPowerShell/5.1.26100.3624\", \"event\": \"HTTP request started\"}\r\nDEBUG: [e22d56e9] REQUEST START: GET http://127.0.0.1:8000/health\r\nDEBUG: [e22d56e9] Headers: {'user-agent': 'Mozilla/5.0 (Windows NT; Windows NT 10.0; en-CA) WindowsPowerShell/5.1.26100.3624', 'host': '127.0.0.1:8000', 'connection': 'Keep-Alive'}\r\nDEBUG: [e22d56e9] Tasks before request: 4\r\nDEBUG: [e22d56e9] Event loop running: True, closed: False\r\nDEBUG: [e22d56e9] About to call next middleware/handler\r\nDEBUG: [e22d56e9] Handler completed successfully\r\nDEBUG: [e22d56e9] Response status: 307\r\nDEBUG: [e22d56e9] Tasks after request: 5\r\nDEBUG: [e22d56e9] Event loop running: True, closed: False\r\n{\"request_id\": \"e22d56e9\", \"method\": \"GET\", \"url\": \"http://127.0.0.1:8000/health\", \"status_code\": 307, \"duration_ms\": 10, \"event\": \"HTTP request completed\"}\r\nDEBUG: [e22d56e9] REQUEST COMPLETED successfully\r\nINFO:     127.0.0.1:61279 - \"GET /health HTTP/1.1\" 307 Temporary Redirect\r\n{\"request_id\": \"55aca5bf\", \"method\": \"GET\", \"url\": \"http://127.0.0.1:8000/health/\", \"user_agent\": \"Mozilla/5.0 (Windows NT; Windows NT 10.0; en-CA) WindowsPowerShell/5.1.26100.3624\", \"event\": \"HTTP request started\"}\r\nDEBUG: [55aca5bf] REQUEST START: GET http://127.0.0.1:8000/health/\r\nDEBUG: [55aca5bf] Headers: {'user-agent': 'Mozilla/5.0 (Windows NT; Windows NT 10.0; en-CA) WindowsPowerShell/5.1.26100.3624', 'host': '127.0.0.1:8000'}\r\nDEBUG: [55aca5bf] Tasks before request: 4\r\nDEBUG: [55aca5bf] Event loop running: True, closed: False\r\nDEBUG: [55aca5bf] About to call next middleware/handler\r\nDEBUG: [55aca5bf] Handler completed successfully\r\nDEBUG: [55aca5bf] Response status: 200\r\nDEBUG: [55aca5bf] Tasks after request: 5\r\nDEBUG: [55aca5bf] Event loop running: True, closed: False\r\n{\"request_id\": \"55aca5bf\", \"method\": \"GET\", \"url\": \"http://127.0.0.1:8000/health/\", \"status_code\": 200, \"duration_ms\": 0, \"event\": \"HTTP request completed\"}\r\nDEBUG: [55aca5bf] REQUEST COMPLETED successfully\r\nINFO:     127.0.0.1:61279 - \"GET /health/ HTTP/1.1\" 200 OK\r\n{\"request_id\": \"04c99b61\", \"method\": \"POST\", \"url\": \"http://localhost:8000/api/v1/chat\", \"user_agent\": \"python-requests/2.32.5\", \"event\": \"HTTP request started\"}\r\nDEBUG: [04c99b61] REQUEST START: POST http://localhost:8000/api/v1/chat\r\nDEBUG: [04c99b61] Headers: {'host': 'localhost:8000', 'user-agent': 'python-requests/2.32.5', 'accept-encoding': 'gzip, deflate', 'accept': '*/*', 'connection': 'keep-alive', 'content-length': '175', 'content-type': 'application/json'}\r\nDEBUG: [04c99b61] Tasks before request: 4\r\nDEBUG: [04c99b61] Event loop running: True, closed: False\r\nDEBUG: [04c99b61] About to call next middleware/handler\r\n{\"url\": \"http://localhost:8000/api/v1/chat\", \"event\": \"Authenticating user request\"}\r\n{\"event\": \"Using fallback RBAC context\"}\r\n{\"event\": \"Fallback RBAC context created successfully\"}\r\n{\"session_id\": \"s_no_tool\", \"turn_id\": \"b2e26565-4fde-4032-8b49-96dca0e4f3d6\", \"user_id\": \"tester_no_tool\", \"message_length\": 45, \"event\": \"Processing chat message\"}\r\n{\"event\": \"Created Cosmos DB client with managed identity\"}\r\n{\"container\": \"chat_history\", \"error\": \"(Forbidden) Request blocked by Auth salesforcebot-cosmos-sql : The given request [POST /dbs/appdb/colls/] cannot be authorized by AAD token in data plane. Learn more: https://aka.ms/cosmos-native-rbac.\\r\\nActivityId: a34ca067-8432-4ce4-897a-0e0680f4337d, Microsoft.Azure.Documents.Common/2.14.0\\nCode: Forbidden\\nMessage: Request blocked by Auth salesforcebot-cosmos-sql : The given request [POST /dbs/appdb/colls/] cannot be authorized by AAD token in data plane. Learn more: https://aka.ms/cosmos-native-rbac.\\r\\nActivityId: a34ca067-8432-4ce4-897a-0e0680f4337d, Microsoft.Azure.Documents.Common/2.14.0\", \"event\": \"Failed to create container due to AAD data-plane authorization. Cosmos may require key auth for management operations or pre-created containers. See https://aka.ms/cosmos-native-rbac for details.\"}\r\n{\"container\": \"chat_history\", \"error\": \"(Forbidden) Request blocked by Auth salesforcebot-cosmos-sql : The given request [POST /dbs/appdb/colls/] cannot be authorized by AAD token in data plane. Learn more: https://aka.ms/cosmos-native-rbac.\\r\\nActivityId: 82464029-357b-4790-a2f1-5181c68af40d, Microsoft.Azure.Documents.Common/2.14.0\\nCode: Forbidden\\nMessage: Request blocked by Auth salesforcebot-cosmos-sql : The given request [POST /dbs/appdb/colls/] cannot be authorized by AAD token in data plane. Learn more: https://aka.ms/cosmos-native-rbac.\\r\\nActivityId: 82464029-357b-4790-a2f1-5181c68af40d, Microsoft.Azure.Documents.Common/2.14.0\", \"event\": \"Failed to create container due to AAD data-plane authorization. Cosmos may require key auth for management operations or pre-created containers. See https://aka.ms/cosmos-native-rbac for details.\"}\r\n{\"container\": \"chat_history\", \"error\": \"(Forbidden) Request blocked by Auth salesforcebot-cosmos-sql : The given request [POST /dbs/appdb/colls/] cannot be authorized by AAD token in data plane. Learn more: https://aka.ms/cosmos-native-rbac.\\r\\nActivityId: 5cb04d1b-7156-403c-9150-38a2d45d476f, Microsoft.Azure.Documents.Common/2.14.0\\nCode: Forbidden\\nMessage: Request blocked by Auth salesforcebot-cosmos-sql : The given request [POST /dbs/appdb/colls/] cannot be authorized by AAD token in data plane. Learn more: https://aka.ms/cosmos-native-rbac.\\r\\nActivityId: 5cb04d1b-7156-403c-9150-38a2d45d476f, Microsoft.Azure.Documents.Common/2.14.0\", \"event\": \"Failed to create container due to AAD data-plane authorization. Cosmos may require key auth for management operations or pre-created containers. See https://aka.ms/cosmos-native-rbac for details.\"}\r\n{\"chat_id\": \"s_no_tool\", \"user_id\": \"user@example.com\", \"error\": \"RetryError[<Future at 0x22263e6f9d0 state=finished raised CosmosHttpResponseError>]\", \"event\": \"Failed to get chat history\"}\r\n{\"chat_id\": \"s_no_tool\", \"user_id\": \"user@example.com\", \"event\": \"Chat history not found\"}\r\n{\"error\": \"'name'\", \"event\": \"Failed to list function definitions\"}\r\n{\"user_id\": \"user@example.com\", \"error\": \"'name'\", \"event\": \"Failed to get filtered functions\"}\r\n{\"agent_name\": \"planner_system\", \"tenant_id\": \"tenant123\", \"scenario\": \"general\", \"prompt_id\": \"prompt_planner_system\", \"event\": \"Retrieved system prompt\"}\r\n{\"plan_id\": \"13adebb3-b968-4f8f-a784-87c5fe1e797a\", \"plan_type\": \"no_tool\", \"agent_type\": \"direct_response\", \"user_id\": \"user@example.com\", \"event\": \"Basic plan created\"}\r\n{\"plan_id\": \"13adebb3-b968-4f8f-a784-87c5fe1e797a\", \"user_id\": \"user@example.com\", \"steps_count\": 1, \"planner_type\": \"sequential\", \"event\": \"Plan created successfully\"}\r\n{\"plan_id\": \"13adebb3-b968-4f8f-a784-87c5fe1e797a\", \"execution_id\": \"74504c94-427d-420e-9fce-f37dcaaeb330\", \"user_id\": \"user@example.com\", \"event\": \"Starting plan execution\"}\r\n{\"step_id\": \"7eaea05b-f56e-49de-a569-bcd50f3376b1\", \"tool_name\": \"direct_response\", \"user_id\": \"user@example.com\", \"event\": \"Executing plan step\"}\r\n{\"step_id\": \"7eaea05b-f56e-49de-a569-bcd50f3376b1\", \"event\": \"Direct response step executed successfully\"}\r\n{\"plan_id\": \"13adebb3-b968-4f8f-a784-87c5fe1e797a\", \"execution_id\": \"74504c94-427d-420e-9fce-f37dcaaeb330\", \"status\": \"completed\", \"duration_seconds\": 0.001089, \"event\": \"Plan execution completed\"}\r\n{\"container\": \"chat_history\", \"error\": \"(Forbidden) Request blocked by Auth salesforcebot-cosmos-sql : The given request [POST /dbs/appdb/colls/] cannot be authorized by AAD token in data plane. Learn more: https://aka.ms/cosmos-native-rbac.\\r\\nActivityId: 12a45390-6f98-4d5d-a50e-258232d232e4, Microsoft.Azure.Documents.Common/2.14.0\\nCode: Forbidden\\nMessage: Request blocked by Auth salesforcebot-cosmos-sql : The given request [POST /dbs/appdb/colls/] cannot be authorized by AAD token in data plane. Learn more: https://aka.ms/cosmos-native-rbac.\\r\\nActivityId: 12a45390-6f98-4d5d-a50e-258232d232e4, Microsoft.Azure.Documents.Common/2.14.0\", \"event\": \"Failed to create container due to AAD data-plane authorization. Cosmos may require key auth for management operations or pre-created containers. See https://aka.ms/cosmos-native-rbac for details.\"}\r\n{\"container\": \"chat_history\", \"error\": \"(Forbidden) Request blocked by Auth salesforcebot-cosmos-sql : The given request [POST /dbs/appdb/colls/] cannot be authorized by AAD token in data plane. Learn more: https://aka.ms/cosmos-native-rbac.\\r\\nActivityId: 33a51ee7-e505-43f7-af5a-f68fc6eb8b7d, Microsoft.Azure.Documents.Common/2.14.0\\nCode: Forbidden\\nMessage: Request blocked by Auth salesforcebot-cosmos-sql : The given request [POST /dbs/appdb/colls/] cannot be authorized by AAD token in data plane. Learn more: https://aka.ms/cosmos-native-rbac.\\r\\nActivityId: 33a51ee7-e505-43f7-af5a-f68fc6eb8b7d, Microsoft.Azure.Documents.Common/2.14.0\", \"event\": \"Failed to create container due to AAD data-plane authorization. Cosmos may require key auth for management operations or pre-created containers. See https://aka.ms/cosmos-native-rbac for details.\"}\r\n{\"container\": \"chat_history\", \"error\": \"(Forbidden) Request blocked by Auth salesforcebot-cosmos-sql : The given request [POST /dbs/appdb/colls/] cannot be authorized by AAD token in data plane. Learn more: https://aka.ms/cosmos-native-rbac.\\r\\nActivityId: 9614ca92-c321-4b83-ba7a-7c163ee7c887, Microsoft.Azure.Documents.Common/2.14.0\\nCode: Forbidden\\nMessage: Request blocked by Auth salesforcebot-cosmos-sql : The given request [POST /dbs/appdb/colls/] cannot be authorized by AAD token in data plane. Learn more: https://aka.ms/cosmos-native-rbac.\\r\\nActivityId: 9614ca92-c321-4b83-ba7a-7c163ee7c887, Microsoft.Azure.Documents.Common/2.14.0\", \"event\": \"Failed to create container due to AAD data-plane authorization. Cosmos may require key auth for management operations or pre-created containers. See https://aka.ms/cosmos-native-rbac for details.\"}\r\n{\"chat_id\": \"s_no_tool\", \"user_id\": \"user@example.com\", \"error\": \"RetryError[<Future at 0x22263e4f9b0 state=finished raised CosmosHttpResponseError>]\", \"event\": \"Failed to get chat history\"}\r\n{\"chat_id\": \"s_no_tool\", \"event\": \"Chat history not found for turn addition\"}\r\n{\"chat_id\": \"s_no_tool\", \"user_id\": \"user@example.com\", \"error\": \"Failed to save conversation turn to repository\", \"event\": \"Failed to add conversation turn\"}\r\n{\"event\": \"Failed to save conversation turn: Failed to save conversation turn to repository\"}\r\n{\"session_id\": \"s_no_tool\", \"turn_id\": \"b2e26565-4fde-4032-8b49-96dca0e4f3d6\", \"response_length\": 340, \"sources_count\": 0, \"event\": \"Chat message processed successfully\"}\r\nDEBUG: [04c99b61] Handler completed successfully\r\nDEBUG: [04c99b61] Response status: 200\r\nDEBUG: [04c99b61] Tasks after request: 5\r\nDEBUG: [04c99b61] Event loop running: True, closed: False\r\n{\"request_id\": \"04c99b61\", \"method\": \"POST\", \"url\": \"http://localhost:8000/api/v1/chat\", \"status_code\": 200, \"duration_ms\": 21555, \"event\": \"HTTP request completed\"}\r\nDEBUG: [04c99b61] REQUEST COMPLETED successfully\r\nINFO:     127.0.0.1:61283 - \"POST /api/v1/chat HTTP/1.1\" 200 OK\r\n{\"request_id\": \"794bbb6a\", \"method\": \"POST\", \"url\": \"http://localhost:8000/api/v1/chat\", \"user_agent\": \"python-requests/2.32.5\", \"event\": \"HTTP request started\"}\r\nDEBUG: [794bbb6a] REQUEST START: POST http://localhost:8000/api/v1/chat\r\nDEBUG: [794bbb6a] Headers: {'host': 'localhost:8000', 'user-agent': 'python-requests/2.32.5', 'accept-encoding': 'gzip, deflate', 'accept': '*/*', 'connection': 'keep-alive', 'content-length': '165', 'content-type': 'application/json'}\r\nDEBUG: [794bbb6a] Tasks before request: 4\r\nDEBUG: [794bbb6a] Event loop running: True, closed: False\r\nDEBUG: [794bbb6a] About to call next middleware/handler\r\n{\"url\": \"http://localhost:8000/api/v1/chat\", \"event\": \"Authenticating user request\"}\r\n{\"event\": \"Using fallback RBAC context\"}\r\n{\"event\": \"Fallback RBAC context created successfully\"}\r\n{\"session_id\": \"s_sql\", \"turn_id\": \"f280e860-9351-49ea-a4df-ee793b8f55a5\", \"user_id\": \"tester_sql\", \"message_length\": 42, \"event\": \"Processing chat message\"}\r\n{\"container\": \"chat_history\", \"error\": \"(Forbidden) Request blocked by Auth salesforcebot-cosmos-sql : The given request [POST /dbs/appdb/colls/] cannot be authorized by AAD token in data plane. Learn more: https://aka.ms/cosmos-native-rbac.\\r\\nActivityId: 734fe648-306c-4a28-9cab-5bcb674f820b, Microsoft.Azure.Documents.Common/2.14.0\\nCode: Forbidden\\nMessage: Request blocked by Auth salesforcebot-cosmos-sql : The given request [POST /dbs/appdb/colls/] cannot be authorized by AAD token in data plane. Learn more: https://aka.ms/cosmos-native-rbac.\\r\\nActivityId: 734fe648-306c-4a28-9cab-5bcb674f820b, Microsoft.Azure.Documents.Common/2.14.0\", \"event\": \"Failed to create container due to AAD data-plane authorization. Cosmos may require key auth for management operations or pre-created containers. See https://aka.ms/cosmos-native-rbac for details.\"}\r\n{\"container\": \"chat_history\", \"error\": \"(Forbidden) Request blocked by Auth salesforcebot-cosmos-sql : The given request [POST /dbs/appdb/colls/] cannot be authorized by AAD token in data plane. Learn more: https://aka.ms/cosmos-native-rbac.\\r\\nActivityId: 0950d424-4bd4-4e1a-a0b5-e5679ab220ce, Microsoft.Azure.Documents.Common/2.14.0\\nCode: Forbidden\\nMessage: Request blocked by Auth salesforcebot-cosmos-sql : The given request [POST /dbs/appdb/colls/] cannot be authorized by AAD token in data plane. Learn more: https://aka.ms/cosmos-native-rbac.\\r\\nActivityId: 0950d424-4bd4-4e1a-a0b5-e5679ab220ce, Microsoft.Azure.Documents.Common/2.14.0\", \"event\": \"Failed to create container due to AAD data-plane authorization. Cosmos may require key auth for management operations or pre-created containers. See https://aka.ms/cosmos-native-rbac for details.\"}\r\n{\"container\": \"chat_history\", \"error\": \"(Forbidden) Request blocked by Auth salesforcebot-cosmos-sql : The given request [POST /dbs/appdb/colls/] cannot be authorized by AAD token in data plane. Learn more: https://aka.ms/cosmos-native-rbac.\\r\\nActivityId: b60f8435-f620-46f4-9aa5-400219144524, Microsoft.Azure.Documents.Common/2.14.0\\nCode: Forbidden\\nMessage: Request blocked by Auth salesforcebot-cosmos-sql : The given request [POST /dbs/appdb/colls/] cannot be authorized by AAD token in data plane. Learn more: https://aka.ms/cosmos-native-rbac.\\r\\nActivityId: b60f8435-f620-46f4-9aa5-400219144524, Microsoft.Azure.Documents.Common/2.14.0\", \"event\": \"Failed to create container due to AAD data-plane authorization. Cosmos may require key auth for management operations or pre-created containers. See https://aka.ms/cosmos-native-rbac for details.\"}\r\n{\"chat_id\": \"s_sql\", \"user_id\": \"user@example.com\", \"error\": \"RetryError[<Future at 0x22262648a50 state=finished raised CosmosHttpResponseError>]\", \"event\": \"Failed to get chat history\"}\r\n{\"chat_id\": \"s_sql\", \"user_id\": \"user@example.com\", \"event\": \"Chat history not found\"}\r\n{\"error\": \"'name'\", \"event\": \"Failed to list function definitions\"}\r\n{\"user_id\": \"user@example.com\", \"error\": \"'name'\", \"event\": \"Failed to get filtered functions\"}\r\n{\"agent_name\": \"planner_system\", \"tenant_id\": \"tenant123\", \"scenario\": \"general\", \"prompt_id\": \"prompt_planner_system\", \"event\": \"Retrieved system prompt\"}\r\n{\"plan_id\": \"45769fe9-99ad-4da4-b07b-dc72d36901a5\", \"plan_type\": \"sql_only\", \"agent_type\": \"sql_agent\", \"user_id\": \"user@example.com\", \"event\": \"Basic plan created\"}\r\n{\"plan_id\": \"45769fe9-99ad-4da4-b07b-dc72d36901a5\", \"user_id\": \"user@example.com\", \"steps_count\": 1, \"planner_type\": \"sequential\", \"event\": \"Plan created successfully\"}\r\n{\"plan_id\": \"45769fe9-99ad-4da4-b07b-dc72d36901a5\", \"execution_id\": \"3d0b983a-e584-405b-bf89-644c461674d1\", \"user_id\": \"user@example.com\", \"event\": \"Starting plan execution\"}\r\n{\"step_id\": \"eb028f60-fc7f-4b8e-8fd8-956bc95c02b3\", \"tool_name\": \"sql_agent\", \"user_id\": \"user@example.com\", \"event\": \"Executing plan step\"}\r\n{\"user_query\": \"Run a SQL-only plan to fetch account info.\", \"data_types\": \"opportunities,contacts,cases,revenue\", \"limit\": \"20\", \"user_id\": \"user@example.com\", \"event\": \"Querying account data from user query\"}\r\n{\"user_id\": \"user@example.com\", \"query_length\": 42, \"use_tfidf\": true, \"event\": \"Starting account resolution\"}\r\n{\"key\": \"allowed_accounts:user@example.com\", \"error\": \"Object of type datetime is not JSON serializable\", \"event\": \"Failed to set cache item\"}\r\n{\"account_count\": 3, \"event\": \"Fitting TF-IDF filter\"}\r\n{\"account_count\": 3, \"event\": \"Fitting TF-IDF vectorizer on account corpus\"}\r\n{\"error\": \"\\n**********************************************************************\\n  Resource \\u001b[93mpunkt_tab\\u001b[0m not found.\\n  Please use the NLTK Downloader to obtain the resource:\\n\\n  \\u001b[31m>>> import nltk\\n  >>> nltk.download('punkt_tab')\\n  \\u001b[0m\\n  For more information see: https://www.nltk.org/data.html\\n\\n  Attempted to load \\u001b[93mtokenizers/punkt_tab/english/\\u001b[0m\\n\\n  Searched in:\\n    - 'C:\\\\\\\\Users\\\\\\\\mcarz/nltk_data'\\n    - 'C:\\\\\\\\Users\\\\\\\\mcarz\\\\\\\\AppData\\\\\\\\Local\\\\\\\\Programs\\\\\\\\Python\\\\\\\\Python313\\\\\\\\nltk_data'\\n    - 'C:\\\\\\\\Users\\\\\\\\mcarz\\\\\\\\AppData\\\\\\\\Local\\\\\\\\Programs\\\\\\\\Python\\\\\\\\Python313\\\\\\\\share\\\\\\\\nltk_data'\\n    - 'C:\\\\\\\\Users\\\\\\\\mcarz\\\\\\\\AppData\\\\\\\\Local\\\\\\\\Programs\\\\\\\\Python\\\\\\\\Python313\\\\\\\\lib\\\\\\\\nltk_data'\\n    - 'C:\\\\\\\\Users\\\\\\\\mcarz\\\\\\\\AppData\\\\\\\\Roaming\\\\\\\\nltk_data'\\n    - 'C:\\\\\\\\nltk_data'\\n    - 'D:\\\\\\\\nltk_data'\\n    - 'E:\\\\\\\\nltk_data'\\n**********************************************************************\\n\", \"event\": \"Failed to fit TF-IDF vectorizer\"}\r\n{\"error\": \"\\n**********************************************************************\\n  Resource \\u001b[93mpunkt_tab\\u001b[0m not found.\\n  Please use the NLTK Downloader to obtain the resource:\\n\\n  \\u001b[31m>>> import nltk\\n  >>> nltk.download('punkt_tab')\\n  \\u001b[0m\\n  For more information see: https://www.nltk.org/data.html\\n\\n  Attempted to load \\u001b[93mtokenizers/punkt_tab/english/\\u001b[0m\\n\\n  Searched in:\\n    - 'C:\\\\\\\\Users\\\\\\\\mcarz/nltk_data'\\n    - 'C:\\\\\\\\Users\\\\\\\\mcarz\\\\\\\\AppData\\\\\\\\Local\\\\\\\\Programs\\\\\\\\Python\\\\\\\\Python313\\\\\\\\nltk_data'\\n    - 'C:\\\\\\\\Users\\\\\\\\mcarz\\\\\\\\AppData\\\\\\\\Local\\\\\\\\Programs\\\\\\\\Python\\\\\\\\Python313\\\\\\\\share\\\\\\\\nltk_data'\\n    - 'C:\\\\\\\\Users\\\\\\\\mcarz\\\\\\\\AppData\\\\\\\\Local\\\\\\\\Programs\\\\\\\\Python\\\\\\\\Python313\\\\\\\\lib\\\\\\\\nltk_data'\\n    - 'C:\\\\\\\\Users\\\\\\\\mcarz\\\\\\\\AppData\\\\\\\\Roaming\\\\\\\\nltk_data'\\n    - 'C:\\\\\\\\nltk_data'\\n    - 'D:\\\\\\\\nltk_data'\\n    - 'E:\\\\\\\\nltk_data'\\n**********************************************************************\\n\", \"event\": \"Failed to fit TF-IDF filter\"}\r\n{\"event\": \"TF-IDF vectorizer not fitted, returning empty results\"}\r\n{\"event\": \"Created Azure OpenAI client with managed identity token\"}\r\n{\"error\": \"Connection error.\", \"deployment\": \"gpt-4o\", \"message_count\": 2, \"event\": \"Failed to create chat completion\"}\r\n{\"event\": \"Created Azure OpenAI client with managed identity token\"}\r\n{\"error\": \"Connection error.\", \"deployment\": \"gpt-4o\", \"message_count\": 2, \"event\": \"Failed to create chat completion\"}\r\n{\"event\": \"Created Azure OpenAI client with managed identity token\"}\r\n{\"error\": \"Connection error.\", \"deployment\": \"gpt-4o\", \"message_count\": 2, \"event\": \"Failed to create chat completion\"}\r\n{\"error\": \"RetryError[<Future at 0x22263f11040 state=finished raised APIConnectionError>]\", \"event\": \"Failed to extract account candidates\"}\r\n{\"user_id\": \"user@example.com\", \"candidates_count\": 2, \"resolved_count\": 0, \"requires_disambiguation\": true, \"confidence\": 0.0, \"event\": \"LLM + embeddings resolution completed\"}\r\n{\"method\": \"llm_primary\", \"combined_confidence\": 0.0, \"resolved_count\": 0, \"suggestions_count\": 3, \"event\": \"Combined resolution results\"}\r\n{\"event_id\": \"9e87b43f-e7ef-4dbd-918d-6c708920a799\", \"event_type\": \"performance_metric\", \"severity\": \"info\", \"user_id\": \"user@example.com\", \"session_id\": null, \"event\": \"Telemetry event tracked\"}\r\n{\"user_query\": \"Run a SQL-only plan to fetch account info.\", \"error\": \"string indices must be integers, not 'str'\", \"event\": \"Failed to query account data\"}\r\n{\"step_id\": \"eb028f60-fc7f-4b8e-8fd8-956bc95c02b3\", \"event\": \"Step executed successfully\"}\r\n{\"plan_id\": \"45769fe9-99ad-4da4-b07b-dc72d36901a5\", \"execution_id\": \"3d0b983a-e584-405b-bf89-644c461674d1\", \"status\": \"completed\", \"duration_seconds\": 21.463812, \"event\": \"Plan execution completed\"}\r\n{\"database\": \"telemetry\", \"event\": \"Database not found, creating new database\"}\r\n{\"database\": \"telemetry\", \"container\": \"events\", \"error\": \"(Forbidden) Request blocked by Auth salesforcebot-cosmos-sql : The given request [POST /dbs] cannot be authorized by AAD token in data plane. Learn more: https://aka.ms/cosmos-native-rbac.\\r\\nActivityId: 598cad34-ee7e-44de-8089-54f0f3826428, Microsoft.Azure.Documents.Common/2.14.0\\nCode: Forbidden\\nMessage: Request blocked by Auth salesforcebot-cosmos-sql : The given request [POST /dbs] cannot be authorized by AAD token in data plane. Learn more: https://aka.ms/cosmos-native-rbac.\\r\\nActivityId: 598cad34-ee7e-44de-8089-54f0f3826428, Microsoft.Azure.Documents.Common/2.14.0\", \"event\": \"Failed to get or create container for database\"}\r\n{\"error\": \"(Forbidden) Request blocked by Auth salesforcebot-cosmos-sql : The given request [POST /dbs] cannot be authorized by AAD token in data plane. Learn more: https://aka.ms/cosmos-native-rbac.\\r\\nActivityId: 598cad34-ee7e-44de-8089-54f0f3826428, Microsoft.Azure.Documents.Common/2.14.0\\nCode: Forbidden\\nMessage: Request blocked by Auth salesforcebot-cosmos-sql : The given request [POST /dbs] cannot be authorized by AAD token in data plane. Learn more: https://aka.ms/cosmos-native-rbac.\\r\\nActivityId: 598cad34-ee7e-44de-8089-54f0f3826428, Microsoft.Azure.Documents.Common/2.14.0\", \"event\": \"Failed to store telemetry event\"}\r\n{\"container\": \"chat_history\", \"error\": \"(Forbidden) Request blocked by Auth salesforcebot-cosmos-sql : The given request [POST /dbs/appdb/colls/] cannot be authorized by AAD token in data plane. Learn more: https://aka.ms/cosmos-native-rbac.\\r\\nActivityId: 2c05bbee-6962-4625-9afc-5d4e395fa9dd, Microsoft.Azure.Documents.Common/2.14.0\\nCode: Forbidden\\nMessage: Request blocked by Auth salesforcebot-cosmos-sql : The given request [POST /dbs/appdb/colls/] cannot be authorized by AAD token in data plane. Learn more: https://aka.ms/cosmos-native-rbac.\\r\\nActivityId: 2c05bbee-6962-4625-9afc-5d4e395fa9dd, Microsoft.Azure.Documents.Common/2.14.0\", \"event\": \"Failed to create container due to AAD data-plane authorization. Cosmos may require key auth for management operations or pre-created containers. See https://aka.ms/cosmos-native-rbac for details.\"}\r\n{\"container\": \"chat_history\", \"error\": \"(Forbidden) Request blocked by Auth salesforcebot-cosmos-sql : The given request [POST /dbs/appdb/colls/] cannot be authorized by AAD token in data plane. Learn more: https://aka.ms/cosmos-native-rbac.\\r\\nActivityId: dcf6fa72-7dfd-4ee8-af68-1f11271cf614, Microsoft.Azure.Documents.Common/2.14.0\\nCode: Forbidden\\nMessage: Request blocked by Auth salesforcebot-cosmos-sql : The given request [POST /dbs/appdb/colls/] cannot be authorized by AAD token in data plane. Learn more: https://aka.ms/cosmos-native-rbac.\\r\\nActivityId: dcf6fa72-7dfd-4ee8-af68-1f11271cf614, Microsoft.Azure.Documents.Common/2.14.0\", \"event\": \"Failed to create container due to AAD data-plane authorization. Cosmos may require key auth for management operations or pre-created containers. See https://aka.ms/cosmos-native-rbac for details.\"}\r\n{\"container\": \"chat_history\", \"error\": \"(Forbidden) Request blocked by Auth salesforcebot-cosmos-sql : The given request [POST /dbs/appdb/colls/] cannot be authorized by AAD token in data plane. Learn more: https://aka.ms/cosmos-native-rbac.\\r\\nActivityId: d75612e0-6aba-4fe6-a9dd-e111d5fcd89d, Microsoft.Azure.Documents.Common/2.14.0\\nCode: Forbidden\\nMessage: Request blocked by Auth salesforcebot-cosmos-sql : The given request [POST /dbs/appdb/colls/] cannot be authorized by AAD token in data plane. Learn more: https://aka.ms/cosmos-native-rbac.\\r\\nActivityId: d75612e0-6aba-4fe6-a9dd-e111d5fcd89d, Microsoft.Azure.Documents.Common/2.14.0\", \"event\": \"Failed to create container due to AAD data-plane authorization. Cosmos may require key auth for management operations or pre-created containers. See https://aka.ms/cosmos-native-rbac for details.\"}\r\n{\"chat_id\": \"s_sql\", \"user_id\": \"user@example.com\", \"error\": \"RetryError[<Future at 0x22263ee2410 state=finished raised CosmosHttpResponseError>]\", \"event\": \"Failed to get chat history\"}\r\n{\"chat_id\": \"s_sql\", \"event\": \"Chat history not found for turn addition\"}\r\n{\"chat_id\": \"s_sql\", \"user_id\": \"user@example.com\", \"error\": \"Failed to save conversation turn to repository\", \"event\": \"Failed to add conversation turn\"}\r\n{\"event\": \"Failed to save conversation turn: Failed to save conversation turn to repository\"}\r\n{\"session_id\": \"s_sql\", \"turn_id\": \"f280e860-9351-49ea-a4df-ee793b8f55a5\", \"response_length\": 133, \"sources_count\": 0, \"event\": \"Chat message processed successfully\"}\r\nDEBUG: [794bbb6a] Handler completed successfully\r\nDEBUG: [794bbb6a] Response status: 200\r\nDEBUG: [794bbb6a] Tasks after request: 5\r\nDEBUG: [794bbb6a] Event loop running: True, closed: False\r\n{\"request_id\": \"794bbb6a\", \"method\": \"POST\", \"url\": \"http://localhost:8000/api/v1/chat\", \"status_code\": 200, \"duration_ms\": 39835, \"event\": \"HTTP request completed\"}\r\nDEBUG: [794bbb6a] REQUEST COMPLETED successfully\r\nINFO:     127.0.0.1:61295 - \"POST /api/v1/chat HTTP/1.1\" 200 OK\r\n{\"request_id\": \"57029c8f\", \"method\": \"POST\", \"url\": \"http://localhost:8000/api/v1/chat\", \"user_agent\": \"python-requests/2.32.5\", \"event\": \"HTTP request started\"}\r\nDEBUG: [57029c8f] REQUEST START: POST http://localhost:8000/api/v1/chat\r\nDEBUG: [57029c8f] Headers: {'host': 'localhost:8000', 'user-agent': 'python-requests/2.32.5', 'accept-encoding': 'gzip, deflate', 'accept': '*/*', 'connection': 'keep-alive', 'content-length': '176', 'content-type': 'application/json'}\r\nDEBUG: [57029c8f] Tasks before request: 4\r\nDEBUG: [57029c8f] Event loop running: True, closed: False\r\nDEBUG: [57029c8f] About to call next middleware/handler\r\n{\"url\": \"http://localhost:8000/api/v1/chat\", \"event\": \"Authenticating user request\"}\r\n{\"event\": \"Using fallback RBAC context\"}\r\n{\"event\": \"Fallback RBAC context created successfully\"}\r\n{\"session_id\": \"s_graph\", \"turn_id\": \"0a174ddf-3fdf-4dc7-ab3f-6fcb6a50733a\", \"user_id\": \"tester_graph\", \"message_length\": 47, \"event\": \"Processing chat message\"}\r\n{\"container\": \"chat_history\", \"error\": \"(Forbidden) Request blocked by Auth salesforcebot-cosmos-sql : The given request [POST /dbs/appdb/colls/] cannot be authorized by AAD token in data plane. Learn more: https://aka.ms/cosmos-native-rbac.\\r\\nActivityId: 0249dfde-7ffa-424c-ab1e-27a8e19493ca, Microsoft.Azure.Documents.Common/2.14.0\\nCode: Forbidden\\nMessage: Request blocked by Auth salesforcebot-cosmos-sql : The given request [POST /dbs/appdb/colls/] cannot be authorized by AAD token in data plane. Learn more: https://aka.ms/cosmos-native-rbac.\\r\\nActivityId: 0249dfde-7ffa-424c-ab1e-27a8e19493ca, Microsoft.Azure.Documents.Common/2.14.0\", \"event\": \"Failed to create container due to AAD data-plane authorization. Cosmos may require key auth for management operations or pre-created containers. See https://aka.ms/cosmos-native-rbac for details.\"}\r\n{\"container\": \"chat_history\", \"error\": \"(Forbidden) Request blocked by Auth salesforcebot-cosmos-sql : The given request [POST /dbs/appdb/colls/] cannot be authorized by AAD token in data plane. Learn more: https://aka.ms/cosmos-native-rbac.\\r\\nActivityId: 04f31b57-0900-41ec-bd17-97c76d43fbef, Microsoft.Azure.Documents.Common/2.14.0\\nCode: Forbidden\\nMessage: Request blocked by Auth salesforcebot-cosmos-sql : The given request [POST /dbs/appdb/colls/] cannot be authorized by AAD token in data plane. Learn more: https://aka.ms/cosmos-native-rbac.\\r\\nActivityId: 04f31b57-0900-41ec-bd17-97c76d43fbef, Microsoft.Azure.Documents.Common/2.14.0\", \"event\": \"Failed to create container due to AAD data-plane authorization. Cosmos may require key auth for management operations or pre-created containers. See https://aka.ms/cosmos-native-rbac for details.\"}\r\n{\"container\": \"chat_history\", \"error\": \"(Forbidden) Request blocked by Auth salesforcebot-cosmos-sql : The given request [POST /dbs/appdb/colls/] cannot be authorized by AAD token in data plane. Learn more: https://aka.ms/cosmos-native-rbac.\\r\\nActivityId: e46f4f16-dcdb-4ea1-9ff1-d274da196570, Microsoft.Azure.Documents.Common/2.14.0\\nCode: Forbidden\\nMessage: Request blocked by Auth salesforcebot-cosmos-sql : The given request [POST /dbs/appdb/colls/] cannot be authorized by AAD token in data plane. Learn more: https://aka.ms/cosmos-native-rbac.\\r\\nActivityId: e46f4f16-dcdb-4ea1-9ff1-d274da196570, Microsoft.Azure.Documents.Common/2.14.0\", \"event\": \"Failed to create container due to AAD data-plane authorization. Cosmos may require key auth for management operations or pre-created containers. See https://aka.ms/cosmos-native-rbac for details.\"}\r\n{\"chat_id\": \"s_graph\", \"user_id\": \"user@example.com\", \"error\": \"RetryError[<Future at 0x22263eed020 state=finished raised CosmosHttpResponseError>]\", \"event\": \"Failed to get chat history\"}\r\n{\"chat_id\": \"s_graph\", \"user_id\": \"user@example.com\", \"event\": \"Chat history not found\"}\r\n{\"error\": \"'name'\", \"event\": \"Failed to list function definitions\"}\r\n{\"user_id\": \"user@example.com\", \"error\": \"'name'\", \"event\": \"Failed to get filtered functions\"}\r\n{\"agent_name\": \"planner_system\", \"tenant_id\": \"tenant123\", \"scenario\": \"general\", \"prompt_id\": \"prompt_planner_system\", \"event\": \"Retrieved system prompt\"}\r\n{\"plan_id\": \"74c89ff2-3f48-4f0a-aa0a-7eefa23c51d9\", \"plan_type\": \"graph_only\", \"agent_type\": \"graph_agent\", \"user_id\": \"user@example.com\", \"event\": \"Basic plan created\"}\r\n{\"plan_id\": \"74c89ff2-3f48-4f0a-aa0a-7eefa23c51d9\", \"user_id\": \"user@example.com\", \"steps_count\": 1, \"planner_type\": \"sequential\", \"event\": \"Plan created successfully\"}\r\n{\"plan_id\": \"74c89ff2-3f48-4f0a-aa0a-7eefa23c51d9\", \"execution_id\": \"2af5f0c2-a154-4ce9-9fd1-869ba744efcd\", \"user_id\": \"user@example.com\", \"event\": \"Starting plan execution\"}\r\n{\"step_id\": \"f72cc0f9-f3a3-4067-b298-a7491d937755\", \"tool_name\": \"graph_agent\", \"user_id\": \"user@example.com\", \"event\": \"Executing plan step\"}\r\n{\"user_query\": \"Run a Graph-only plan to explore relationships.\", \"relationship_types\": \"\", \"max_depth\": \"2\", \"user_id\": \"user@example.com\", \"event\": \"Finding account relationships from query\"}\r\n{\"user_id\": \"user@example.com\", \"query_length\": 47, \"use_tfidf\": true, \"event\": \"Starting account resolution\"}\r\n{\"key\": \"allowed_accounts:user@example.com\", \"error\": \"Object of type datetime is not JSON serializable\", \"event\": \"Failed to set cache item\"}\r\n{\"account_count\": 3, \"event\": \"Fitting TF-IDF filter\"}\r\n{\"account_count\": 3, \"event\": \"Fitting TF-IDF vectorizer on account corpus\"}\r\n{\"error\": \"\\n**********************************************************************\\n  Resource \\u001b[93mpunkt_tab\\u001b[0m not found.\\n  Please use the NLTK Downloader to obtain the resource:\\n\\n  \\u001b[31m>>> import nltk\\n  >>> nltk.download('punkt_tab')\\n  \\u001b[0m\\n  For more information see: https://www.nltk.org/data.html\\n\\n  Attempted to load \\u001b[93mtokenizers/punkt_tab/english/\\u001b[0m\\n\\n  Searched in:\\n    - 'C:\\\\\\\\Users\\\\\\\\mcarz/nltk_data'\\n    - 'C:\\\\\\\\Users\\\\\\\\mcarz\\\\\\\\AppData\\\\\\\\Local\\\\\\\\Programs\\\\\\\\Python\\\\\\\\Python313\\\\\\\\nltk_data'\\n    - 'C:\\\\\\\\Users\\\\\\\\mcarz\\\\\\\\AppData\\\\\\\\Local\\\\\\\\Programs\\\\\\\\Python\\\\\\\\Python313\\\\\\\\share\\\\\\\\nltk_data'\\n    - 'C:\\\\\\\\Users\\\\\\\\mcarz\\\\\\\\AppData\\\\\\\\Local\\\\\\\\Programs\\\\\\\\Python\\\\\\\\Python313\\\\\\\\lib\\\\\\\\nltk_data'\\n    - 'C:\\\\\\\\Users\\\\\\\\mcarz\\\\\\\\AppData\\\\\\\\Roaming\\\\\\\\nltk_data'\\n    - 'C:\\\\\\\\nltk_data'\\n    - 'D:\\\\\\\\nltk_data'\\n    - 'E:\\\\\\\\nltk_data'\\n**********************************************************************\\n\", \"event\": \"Failed to fit TF-IDF vectorizer\"}\r\n{\"error\": \"\\n**********************************************************************\\n  Resource \\u001b[93mpunkt_tab\\u001b[0m not found.\\n  Please use the NLTK Downloader to obtain the resource:\\n\\n  \\u001b[31m>>> import nltk\\n  >>> nltk.download('punkt_tab')\\n  \\u001b[0m\\n  For more information see: https://www.nltk.org/data.html\\n\\n  Attempted to load \\u001b[93mtokenizers/punkt_tab/english/\\u001b[0m\\n\\n  Searched in:\\n    - 'C:\\\\\\\\Users\\\\\\\\mcarz/nltk_data'\\n    - 'C:\\\\\\\\Users\\\\\\\\mcarz\\\\\\\\AppData\\\\\\\\Local\\\\\\\\Programs\\\\\\\\Python\\\\\\\\Python313\\\\\\\\nltk_data'\\n    - 'C:\\\\\\\\Users\\\\\\\\mcarz\\\\\\\\AppData\\\\\\\\Local\\\\\\\\Programs\\\\\\\\Python\\\\\\\\Python313\\\\\\\\share\\\\\\\\nltk_data'\\n    - 'C:\\\\\\\\Users\\\\\\\\mcarz\\\\\\\\AppData\\\\\\\\Local\\\\\\\\Programs\\\\\\\\Python\\\\\\\\Python313\\\\\\\\lib\\\\\\\\nltk_data'\\n    - 'C:\\\\\\\\Users\\\\\\\\mcarz\\\\\\\\AppData\\\\\\\\Roaming\\\\\\\\nltk_data'\\n    - 'C:\\\\\\\\nltk_data'\\n    - 'D:\\\\\\\\nltk_data'\\n    - 'E:\\\\\\\\nltk_data'\\n**********************************************************************\\n\", \"event\": \"Failed to fit TF-IDF filter\"}\r\n{\"event\": \"TF-IDF vectorizer not fitted, returning empty results\"}\r\n{\"event\": \"Created Azure OpenAI client with managed identity token\"}\r\n{\"error\": \"Connection error.\", \"deployment\": \"gpt-4o\", \"message_count\": 2, \"event\": \"Failed to create chat completion\"}\r\n{\"event\": \"Created Azure OpenAI client with managed identity token\"}\r\n{\"error\": \"Connection error.\", \"deployment\": \"gpt-4o\", \"message_count\": 2, \"event\": \"Failed to create chat completion\"}\r\n{\"event\": \"Created Azure OpenAI client with managed identity token\"}\r\n{\"error\": \"Connection error.\", \"deployment\": \"gpt-4o\", \"message_count\": 2, \"event\": \"Failed to create chat completion\"}\r\n{\"error\": \"RetryError[<Future at 0x22263ef7070 state=finished raised APIConnectionError>]\", \"event\": \"Failed to extract account candidates\"}\r\n{\"user_id\": \"user@example.com\", \"candidates_count\": 3, \"resolved_count\": 0, \"requires_disambiguation\": true, \"confidence\": 0.0, \"event\": \"LLM + embeddings resolution completed\"}\r\n{\"method\": \"llm_primary\", \"combined_confidence\": 0.0, \"resolved_count\": 0, \"suggestions_count\": 3, \"event\": \"Combined resolution results\"}\r\n{\"step_id\": \"f72cc0f9-f3a3-4067-b298-a7491d937755\", \"event\": \"Step executed successfully\"}\r\n{\"plan_id\": \"74c89ff2-3f48-4f0a-aa0a-7eefa23c51d9\", \"execution_id\": \"2af5f0c2-a154-4ce9-9fd1-869ba744efcd\", \"status\": \"completed\", \"duration_seconds\": 20.967798, \"event\": \"Plan execution completed\"}\r\n{\"container\": \"chat_history\", \"error\": \"(Forbidden) Request blocked by Auth salesforcebot-cosmos-sql : The given request [POST /dbs/appdb/colls/] cannot be authorized by AAD token in data plane. Learn more: https://aka.ms/cosmos-native-rbac.\\r\\nActivityId: 01720d85-67cd-4913-8d9f-d45592f996d0, Microsoft.Azure.Documents.Common/2.14.0\\nCode: Forbidden\\nMessage: Request blocked by Auth salesforcebot-cosmos-sql : The given request [POST /dbs/appdb/colls/] cannot be authorized by AAD token in data plane. Learn more: https://aka.ms/cosmos-native-rbac.\\r\\nActivityId: 01720d85-67cd-4913-8d9f-d45592f996d0, Microsoft.Azure.Documents.Common/2.14.0\", \"event\": \"Failed to create container due to AAD data-plane authorization. Cosmos may require key auth for management operations or pre-created containers. See https://aka.ms/cosmos-native-rbac for details.\"}\r\n{\"container\": \"chat_history\", \"error\": \"(Forbidden) Request blocked by Auth salesforcebot-cosmos-sql : The given request [POST /dbs/appdb/colls/] cannot be authorized by AAD token in data plane. Learn more: https://aka.ms/cosmos-native-rbac.\\r\\nActivityId: 0635ee2a-5028-4ed4-adf0-648a0df6eca1, Microsoft.Azure.Documents.Common/2.14.0\\nCode: Forbidden\\nMessage: Request blocked by Auth salesforcebot-cosmos-sql : The given request [POST /dbs/appdb/colls/] cannot be authorized by AAD token in data plane. Learn more: https://aka.ms/cosmos-native-rbac.\\r\\nActivityId: 0635ee2a-5028-4ed4-adf0-648a0df6eca1, Microsoft.Azure.Documents.Common/2.14.0\", \"event\": \"Failed to create container due to AAD data-plane authorization. Cosmos may require key auth for management operations or pre-created containers. See https://aka.ms/cosmos-native-rbac for details.\"}\r\n{\"container\": \"chat_history\", \"error\": \"(Forbidden) Request blocked by Auth salesforcebot-cosmos-sql : The given request [POST /dbs/appdb/colls/] cannot be authorized by AAD token in data plane. Learn more: https://aka.ms/cosmos-native-rbac.\\r\\nActivityId: b92e3f81-9fe1-4f9c-b044-507fd3906195, Microsoft.Azure.Documents.Common/2.14.0\\nCode: Forbidden\\nMessage: Request blocked by Auth salesforcebot-cosmos-sql : The given request [POST /dbs/appdb/colls/] cannot be authorized by AAD token in data plane. Learn more: https://aka.ms/cosmos-native-rbac.\\r\\nActivityId: b92e3f81-9fe1-4f9c-b044-507fd3906195, Microsoft.Azure.Documents.Common/2.14.0\", \"event\": \"Failed to create container due to AAD data-plane authorization. Cosmos may require key auth for management operations or pre-created containers. See https://aka.ms/cosmos-native-rbac for details.\"}\r\n{\"chat_id\": \"s_graph\", \"user_id\": \"user@example.com\", \"error\": \"RetryError[<Future at 0x222626b1bd0 state=finished raised CosmosHttpResponseError>]\", \"event\": \"Failed to get chat history\"}\r\n{\"chat_id\": \"s_graph\", \"event\": \"Chat history not found for turn addition\"}\r\n{\"chat_id\": \"s_graph\", \"user_id\": \"user@example.com\", \"error\": \"Failed to save conversation turn to repository\", \"event\": \"Failed to add conversation turn\"}\r\n{\"event\": \"Failed to save conversation turn: Failed to save conversation turn to repository\"}\r\n{\"session_id\": \"s_graph\", \"turn_id\": \"0a174ddf-3fdf-4dc7-ab3f-6fcb6a50733a\", \"response_length\": 209, \"sources_count\": 0, \"event\": \"Chat message processed successfully\"}\r\nDEBUG: [57029c8f] Handler completed successfully\r\nDEBUG: [57029c8f] Response status: 200\r\nDEBUG: [57029c8f] Tasks after request: 5\r\nDEBUG: [57029c8f] Event loop running: True, closed: False\r\n{\"request_id\": \"57029c8f\", \"method\": \"POST\", \"url\": \"http://localhost:8000/api/v1/chat\", \"status_code\": 200, \"duration_ms\": 39213, \"event\": \"HTTP request completed\"}\r\nDEBUG: [57029c8f] REQUEST COMPLETED successfully\r\nINFO:     127.0.0.1:61307 - \"POST /api/v1/chat HTTP/1.1\" 200 OK\r\n"
    },
    {
      "scenario": "hybrid",
      "response": {
        "status_code": 200,
        "json": {
          "session_id": "s_hybrid",
          "turn_id": "48a116bb-6ed6-42e1-970b-86479fc2d06d",
          "choices": [
            {
              "index": 0,
              "message": {
                "role": "assistant",
                "content": "{\"success\": false, \"error\": \"string indices must be integers, not 'str'\", \"user_query\": \"Use any tools necessary to answer and combine SQL and Graph.\"}"
              },
              "finish_reason": "stop"
            }
          ],
          "usage": {
            "prompt_tokens": 11,
            "completion_tokens": 22,
            "total_tokens": 33
          },
          "sources": [],
          "metadata": {
            "mode": "agent_execution",
            "plan_id": "e8a4930e-cfbd-4b72-b805-caa8de94f3ef",
            "plan_type": "sql_only",
            "execution_id": "868f4fc1-6555-44ec-9ea3-d7fd4af62aa5",
            "steps_executed": 1,
            "execution_status": "completed",
            "timestamp": "2025-09-20T18:40:04.792632"
          }
        },
        "text": null
      },
      "log_tail": "{\"origins\": [\"*\"], \"event\": \"Configured CORS middleware\"}\r\n{\"api_prefix\": \"/api/v1\", \"event\": \"Configured application routes\"}\r\n{\"app_name\": \"salesforce-chatbot\", \"version\": \"1.0.0\", \"debug\": false, \"event\": \"Created FastAPI application\"}\r\n{\"version\": \"1.0.0\", \"event\": \"Starting Account Q&A Bot application\"}\r\n{\"event\": \"Initializing Azure service clients\"}\r\n{\"endpoint\": \"https://salesforcebot-aoai.cognitiveservices.azure.com\", \"chat_deployment\": \"gpt-4o\", \"embedding_deployment\": \"text-embedding-3-small\", \"event\": \"Initializing Azure OpenAI client\"}\r\n{\"event\": \"Azure OpenAI client initialized successfully\"}\r\n{\"endpoint\": \"https://salesforcebot-cosmos-sql.documents.azure.com:443/\", \"database\": \"appdb\", \"event\": \"Initializing Cosmos DB client\"}\r\n{\"event\": \"Cosmos DB client initialized successfully\"}\r\n{\"endpoint\": \"https://salesforcebot-cosmos-graph.gremlin.cosmos.azure.com:443/\", \"database\": \"graphdb\", \"graph\": \"account_graph\", \"event\": \"Initializing Gremlin client\"}\r\n{\"event\": \"Gremlin client initialized successfully\"}\r\n{\"event\": \"Fabric client initialized successfully\"}\r\n{\"event\": \"Initializing data repositories\"}\r\n{\"container\": \"chat_history\", \"event\": \"Initialized chat history repository\"}\r\n{\"container\": \"chat_history\", \"event\": \"Initialized chat history repository\"}\r\n{\"event\": \"Initializing application services\"}\r\n{\"enforce_rbac\": false, \"admin_users\": 0, \"event\": \"Initialized RBAC service\"}\r\n{\"enforce_rbac\": false, \"admin_users\": 0, \"event\": \"Initialized RBAC service\"}\r\n{\"min_similarity\": 0.3, \"max_candidates\": 20, \"event\": \"Account resolver filter initialized\"}\r\n{\"use_tfidf\": true, \"confidence_threshold\": 0.8, \"tfidf_threshold\": 0.3, \"event\": \"Account resolver service initialized\"}\r\n{\"confidence_threshold\": 0.8, \"event\": \"Account resolver service initialized\"}\r\n{\"event\": \"Initializing Semantic Kernel agents\"}\r\n{\"event\": \"Planner configuration skipped - using basic kernel functionality\"}\r\n{\"event\": \"Planner service initialized\"}\r\n{\"event\": \"SQL agent plugin registered with kernel\"}\r\n{\"event\": \"SQL agent enabled\"}\r\n{\"event\": \"Graph agent enabled\"}\r\n{\"event\": \"Graph agent plugin registered with kernel\"}\r\n{\"event\": \"Agents will load functions dynamically from database\"}\r\n{\"event\": \"Application startup completed successfully\"}\r\n{\"request_id\": \"aa276cf6\", \"method\": \"GET\", \"url\": \"http://127.0.0.1:8000/health\", \"user_agent\": \"Mozilla/5.0 (Windows NT; Windows NT 10.0; en-CA) WindowsPowerShell/5.1.26100.3624\", \"event\": \"HTTP request started\"}\r\nDEBUG: [aa276cf6] REQUEST START: GET http://127.0.0.1:8000/health\r\nDEBUG: [aa276cf6] Headers: {'user-agent': 'Mozilla/5.0 (Windows NT; Windows NT 10.0; en-CA) WindowsPowerShell/5.1.26100.3624', 'host': '127.0.0.1:8000', 'connection': 'Keep-Alive'}\r\nDEBUG: [aa276cf6] Tasks before request: 4\r\nDEBUG: [aa276cf6] Event loop running: True, closed: False\r\nDEBUG: [aa276cf6] About to call next middleware/handler\r\nDEBUG: [aa276cf6] Handler completed successfully\r\nDEBUG: [aa276cf6] Response status: 307\r\nDEBUG: [aa276cf6] Tasks after request: 5\r\nDEBUG: [aa276cf6] Event loop running: True, closed: False\r\n{\"request_id\": \"aa276cf6\", \"method\": \"GET\", \"url\": \"http://127.0.0.1:8000/health\", \"status_code\": 307, \"duration_ms\": 1, \"event\": \"HTTP request completed\"}\r\nDEBUG: [aa276cf6] REQUEST COMPLETED successfully\r\nINFO:     127.0.0.1:61277 - \"GET /health HTTP/1.1\" 307 Temporary Redirect\r\n{\"request_id\": \"15326ea2\", \"method\": \"GET\", \"url\": \"http://127.0.0.1:8000/health/\", \"user_agent\": \"Mozilla/5.0 (Windows NT; Windows NT 10.0; en-CA) WindowsPowerShell/5.1.26100.3624\", \"event\": \"HTTP request started\"}\r\nDEBUG: [15326ea2] REQUEST START: GET http://127.0.0.1:8000/health/\r\nDEBUG: [15326ea2] Headers: {'user-agent': 'Mozilla/5.0 (Windows NT; Windows NT 10.0; en-CA) WindowsPowerShell/5.1.26100.3624', 'host': '127.0.0.1:8000'}\r\nDEBUG: [15326ea2] Tasks before request: 4\r\nDEBUG: [15326ea2] Event loop running: True, closed: False\r\nDEBUG: [15326ea2] About to call next middleware/handler\r\nDEBUG: [15326ea2] Handler completed successfully\r\nDEBUG: [15326ea2] Response status: 200\r\nDEBUG: [15326ea2] Tasks after request: 5\r\nDEBUG: [15326ea2] Event loop running: True, closed: False\r\n{\"request_id\": \"15326ea2\", \"method\": \"GET\", \"url\": \"http://127.0.0.1:8000/health/\", \"status_code\": 200, \"duration_ms\": 1, \"event\": \"HTTP request completed\"}\r\nDEBUG: [15326ea2] REQUEST COMPLETED successfully\r\nINFO:     127.0.0.1:61277 - \"GET /health/ HTTP/1.1\" 200 OK\r\n{\"request_id\": \"e22d56e9\", \"method\": \"GET\", \"url\": \"http://127.0.0.1:8000/health\", \"user_agent\": \"Mozilla/5.0 (Windows NT; Windows NT 10.0; en-CA) WindowsPowerShell/5.1.26100.3624\", \"event\": \"HTTP request started\"}\r\nDEBUG: [e22d56e9] REQUEST START: GET http://127.0.0.1:8000/health\r\nDEBUG: [e22d56e9] Headers: {'user-agent': 'Mozilla/5.0 (Windows NT; Windows NT 10.0; en-CA) WindowsPowerShell/5.1.26100.3624', 'host': '127.0.0.1:8000', 'connection': 'Keep-Alive'}\r\nDEBUG: [e22d56e9] Tasks before request: 4\r\nDEBUG: [e22d56e9] Event loop running: True, closed: False\r\nDEBUG: [e22d56e9] About to call next middleware/handler\r\nDEBUG: [e22d56e9] Handler completed successfully\r\nDEBUG: [e22d56e9] Response status: 307\r\nDEBUG: [e22d56e9] Tasks after request: 5\r\nDEBUG: [e22d56e9] Event loop running: True, closed: False\r\n{\"request_id\": \"e22d56e9\", \"method\": \"GET\", \"url\": \"http://127.0.0.1:8000/health\", \"status_code\": 307, \"duration_ms\": 10, \"event\": \"HTTP request completed\"}\r\nDEBUG: [e22d56e9] REQUEST COMPLETED successfully\r\nINFO:     127.0.0.1:61279 - \"GET /health HTTP/1.1\" 307 Temporary Redirect\r\n{\"request_id\": \"55aca5bf\", \"method\": \"GET\", \"url\": \"http://127.0.0.1:8000/health/\", \"user_agent\": \"Mozilla/5.0 (Windows NT; Windows NT 10.0; en-CA) WindowsPowerShell/5.1.26100.3624\", \"event\": \"HTTP request started\"}\r\nDEBUG: [55aca5bf] REQUEST START: GET http://127.0.0.1:8000/health/\r\nDEBUG: [55aca5bf] Headers: {'user-agent': 'Mozilla/5.0 (Windows NT; Windows NT 10.0; en-CA) WindowsPowerShell/5.1.26100.3624', 'host': '127.0.0.1:8000'}\r\nDEBUG: [55aca5bf] Tasks before request: 4\r\nDEBUG: [55aca5bf] Event loop running: True, closed: False\r\nDEBUG: [55aca5bf] About to call next middleware/handler\r\nDEBUG: [55aca5bf] Handler completed successfully\r\nDEBUG: [55aca5bf] Response status: 200\r\nDEBUG: [55aca5bf] Tasks after request: 5\r\nDEBUG: [55aca5bf] Event loop running: True, closed: False\r\n{\"request_id\": \"55aca5bf\", \"method\": \"GET\", \"url\": \"http://127.0.0.1:8000/health/\", \"status_code\": 200, \"duration_ms\": 0, \"event\": \"HTTP request completed\"}\r\nDEBUG: [55aca5bf] REQUEST COMPLETED successfully\r\nINFO:     127.0.0.1:61279 - \"GET /health/ HTTP/1.1\" 200 OK\r\n{\"request_id\": \"04c99b61\", \"method\": \"POST\", \"url\": \"http://localhost:8000/api/v1/chat\", \"user_agent\": \"python-requests/2.32.5\", \"event\": \"HTTP request started\"}\r\nDEBUG: [04c99b61] REQUEST START: POST http://localhost:8000/api/v1/chat\r\nDEBUG: [04c99b61] Headers: {'host': 'localhost:8000', 'user-agent': 'python-requests/2.32.5', 'accept-encoding': 'gzip, deflate', 'accept': '*/*', 'connection': 'keep-alive', 'content-length': '175', 'content-type': 'application/json'}\r\nDEBUG: [04c99b61] Tasks before request: 4\r\nDEBUG: [04c99b61] Event loop running: True, closed: False\r\nDEBUG: [04c99b61] About to call next middleware/handler\r\n{\"url\": \"http://localhost:8000/api/v1/chat\", \"event\": \"Authenticating user request\"}\r\n{\"event\": \"Using fallback RBAC context\"}\r\n{\"event\": \"Fallback RBAC context created successfully\"}\r\n{\"session_id\": \"s_no_tool\", \"turn_id\": \"b2e26565-4fde-4032-8b49-96dca0e4f3d6\", \"user_id\": \"tester_no_tool\", \"message_length\": 45, \"event\": \"Processing chat message\"}\r\n{\"event\": \"Created Cosmos DB client with managed identity\"}\r\n{\"container\": \"chat_history\", \"error\": \"(Forbidden) Request blocked by Auth salesforcebot-cosmos-sql : The given request [POST /dbs/appdb/colls/] cannot be authorized by AAD token in data plane. Learn more: https://aka.ms/cosmos-native-rbac.\\r\\nActivityId: a34ca067-8432-4ce4-897a-0e0680f4337d, Microsoft.Azure.Documents.Common/2.14.0\\nCode: Forbidden\\nMessage: Request blocked by Auth salesforcebot-cosmos-sql : The given request [POST /dbs/appdb/colls/] cannot be authorized by AAD token in data plane. Learn more: https://aka.ms/cosmos-native-rbac.\\r\\nActivityId: a34ca067-8432-4ce4-897a-0e0680f4337d, Microsoft.Azure.Documents.Common/2.14.0\", \"event\": \"Failed to create container due to AAD data-plane authorization. Cosmos may require key auth for management operations or pre-created containers. See https://aka.ms/cosmos-native-rbac for details.\"}\r\n{\"container\": \"chat_history\", \"error\": \"(Forbidden) Request blocked by Auth salesforcebot-cosmos-sql : The given request [POST /dbs/appdb/colls/] cannot be authorized by AAD token in data plane. Learn more: https://aka.ms/cosmos-native-rbac.\\r\\nActivityId: 82464029-357b-4790-a2f1-5181c68af40d, Microsoft.Azure.Documents.Common/2.14.0\\nCode: Forbidden\\nMessage: Request blocked by Auth salesforcebot-cosmos-sql : The given request [POST /dbs/appdb/colls/] cannot be authorized by AAD token in data plane. Learn more: https://aka.ms/cosmos-native-rbac.\\r\\nActivityId: 82464029-357b-4790-a2f1-5181c68af40d, Microsoft.Azure.Documents.Common/2.14.0\", \"event\": \"Failed to create container due to AAD data-plane authorization. Cosmos may require key auth for management operations or pre-created containers. See https://aka.ms/cosmos-native-rbac for details.\"}\r\n{\"container\": \"chat_history\", \"error\": \"(Forbidden) Request blocked by Auth salesforcebot-cosmos-sql : The given request [POST /dbs/appdb/colls/] cannot be authorized by AAD token in data plane. Learn more: https://aka.ms/cosmos-native-rbac.\\r\\nActivityId: 5cb04d1b-7156-403c-9150-38a2d45d476f, Microsoft.Azure.Documents.Common/2.14.0\\nCode: Forbidden\\nMessage: Request blocked by Auth salesforcebot-cosmos-sql : The given request [POST /dbs/appdb/colls/] cannot be authorized by AAD token in data plane. Learn more: https://aka.ms/cosmos-native-rbac.\\r\\nActivityId: 5cb04d1b-7156-403c-9150-38a2d45d476f, Microsoft.Azure.Documents.Common/2.14.0\", \"event\": \"Failed to create container due to AAD data-plane authorization. Cosmos may require key auth for management operations or pre-created containers. See https://aka.ms/cosmos-native-rbac for details.\"}\r\n{\"chat_id\": \"s_no_tool\", \"user_id\": \"user@example.com\", \"error\": \"RetryError[<Future at 0x22263e6f9d0 state=finished raised CosmosHttpResponseError>]\", \"event\": \"Failed to get chat history\"}\r\n{\"chat_id\": \"s_no_tool\", \"user_id\": \"user@example.com\", \"event\": \"Chat history not found\"}\r\n{\"error\": \"'name'\", \"event\": \"Failed to list function definitions\"}\r\n{\"user_id\": \"user@example.com\", \"error\": \"'name'\", \"event\": \"Failed to get filtered functions\"}\r\n{\"agent_name\": \"planner_system\", \"tenant_id\": \"tenant123\", \"scenario\": \"general\", \"prompt_id\": \"prompt_planner_system\", \"event\": \"Retrieved system prompt\"}\r\n{\"plan_id\": \"13adebb3-b968-4f8f-a784-87c5fe1e797a\", \"plan_type\": \"no_tool\", \"agent_type\": \"direct_response\", \"user_id\": \"user@example.com\", \"event\": \"Basic plan created\"}\r\n{\"plan_id\": \"13adebb3-b968-4f8f-a784-87c5fe1e797a\", \"user_id\": \"user@example.com\", \"steps_count\": 1, \"planner_type\": \"sequential\", \"event\": \"Plan created successfully\"}\r\n{\"plan_id\": \"13adebb3-b968-4f8f-a784-87c5fe1e797a\", \"execution_id\": \"74504c94-427d-420e-9fce-f37dcaaeb330\", \"user_id\": \"user@example.com\", \"event\": \"Starting plan execution\"}\r\n{\"step_id\": \"7eaea05b-f56e-49de-a569-bcd50f3376b1\", \"tool_name\": \"direct_response\", \"user_id\": \"user@example.com\", \"event\": \"Executing plan step\"}\r\n{\"step_id\": \"7eaea05b-f56e-49de-a569-bcd50f3376b1\", \"event\": \"Direct response step executed successfully\"}\r\n{\"plan_id\": \"13adebb3-b968-4f8f-a784-87c5fe1e797a\", \"execution_id\": \"74504c94-427d-420e-9fce-f37dcaaeb330\", \"status\": \"completed\", \"duration_seconds\": 0.001089, \"event\": \"Plan execution completed\"}\r\n{\"container\": \"chat_history\", \"error\": \"(Forbidden) Request blocked by Auth salesforcebot-cosmos-sql : The given request [POST /dbs/appdb/colls/] cannot be authorized by AAD token in data plane. Learn more: https://aka.ms/cosmos-native-rbac.\\r\\nActivityId: 12a45390-6f98-4d5d-a50e-258232d232e4, Microsoft.Azure.Documents.Common/2.14.0\\nCode: Forbidden\\nMessage: Request blocked by Auth salesforcebot-cosmos-sql : The given request [POST /dbs/appdb/colls/] cannot be authorized by AAD token in data plane. Learn more: https://aka.ms/cosmos-native-rbac.\\r\\nActivityId: 12a45390-6f98-4d5d-a50e-258232d232e4, Microsoft.Azure.Documents.Common/2.14.0\", \"event\": \"Failed to create container due to AAD data-plane authorization. Cosmos may require key auth for management operations or pre-created containers. See https://aka.ms/cosmos-native-rbac for details.\"}\r\n{\"container\": \"chat_history\", \"error\": \"(Forbidden) Request blocked by Auth salesforcebot-cosmos-sql : The given request [POST /dbs/appdb/colls/] cannot be authorized by AAD token in data plane. Learn more: https://aka.ms/cosmos-native-rbac.\\r\\nActivityId: 33a51ee7-e505-43f7-af5a-f68fc6eb8b7d, Microsoft.Azure.Documents.Common/2.14.0\\nCode: Forbidden\\nMessage: Request blocked by Auth salesforcebot-cosmos-sql : The given request [POST /dbs/appdb/colls/] cannot be authorized by AAD token in data plane. Learn more: https://aka.ms/cosmos-native-rbac.\\r\\nActivityId: 33a51ee7-e505-43f7-af5a-f68fc6eb8b7d, Microsoft.Azure.Documents.Common/2.14.0\", \"event\": \"Failed to create container due to AAD data-plane authorization. Cosmos may require key auth for management operations or pre-created containers. See https://aka.ms/cosmos-native-rbac for details.\"}\r\n{\"container\": \"chat_history\", \"error\": \"(Forbidden) Request blocked by Auth salesforcebot-cosmos-sql : The given request [POST /dbs/appdb/colls/] cannot be authorized by AAD token in data plane. Learn more: https://aka.ms/cosmos-native-rbac.\\r\\nActivityId: 9614ca92-c321-4b83-ba7a-7c163ee7c887, Microsoft.Azure.Documents.Common/2.14.0\\nCode: Forbidden\\nMessage: Request blocked by Auth salesforcebot-cosmos-sql : The given request [POST /dbs/appdb/colls/] cannot be authorized by AAD token in data plane. Learn more: https://aka.ms/cosmos-native-rbac.\\r\\nActivityId: 9614ca92-c321-4b83-ba7a-7c163ee7c887, Microsoft.Azure.Documents.Common/2.14.0\", \"event\": \"Failed to create container due to AAD data-plane authorization. Cosmos may require key auth for management operations or pre-created containers. See https://aka.ms/cosmos-native-rbac for details.\"}\r\n{\"chat_id\": \"s_no_tool\", \"user_id\": \"user@example.com\", \"error\": \"RetryError[<Future at 0x22263e4f9b0 state=finished raised CosmosHttpResponseError>]\", \"event\": \"Failed to get chat history\"}\r\n{\"chat_id\": \"s_no_tool\", \"event\": \"Chat history not found for turn addition\"}\r\n{\"chat_id\": \"s_no_tool\", \"user_id\": \"user@example.com\", \"error\": \"Failed to save conversation turn to repository\", \"event\": \"Failed to add conversation turn\"}\r\n{\"event\": \"Failed to save conversation turn: Failed to save conversation turn to repository\"}\r\n{\"session_id\": \"s_no_tool\", \"turn_id\": \"b2e26565-4fde-4032-8b49-96dca0e4f3d6\", \"response_length\": 340, \"sources_count\": 0, \"event\": \"Chat message processed successfully\"}\r\nDEBUG: [04c99b61] Handler completed successfully\r\nDEBUG: [04c99b61] Response status: 200\r\nDEBUG: [04c99b61] Tasks after request: 5\r\nDEBUG: [04c99b61] Event loop running: True, closed: False\r\n{\"request_id\": \"04c99b61\", \"method\": \"POST\", \"url\": \"http://localhost:8000/api/v1/chat\", \"status_code\": 200, \"duration_ms\": 21555, \"event\": \"HTTP request completed\"}\r\nDEBUG: [04c99b61] REQUEST COMPLETED successfully\r\nINFO:     127.0.0.1:61283 - \"POST /api/v1/chat HTTP/1.1\" 200 OK\r\n{\"request_id\": \"794bbb6a\", \"method\": \"POST\", \"url\": \"http://localhost:8000/api/v1/chat\", \"user_agent\": \"python-requests/2.32.5\", \"event\": \"HTTP request started\"}\r\nDEBUG: [794bbb6a] REQUEST START: POST http://localhost:8000/api/v1/chat\r\nDEBUG: [794bbb6a] Headers: {'host': 'localhost:8000', 'user-agent': 'python-requests/2.32.5', 'accept-encoding': 'gzip, deflate', 'accept': '*/*', 'connection': 'keep-alive', 'content-length': '165', 'content-type': 'application/json'}\r\nDEBUG: [794bbb6a] Tasks before request: 4\r\nDEBUG: [794bbb6a] Event loop running: True, closed: False\r\nDEBUG: [794bbb6a] About to call next middleware/handler\r\n{\"url\": \"http://localhost:8000/api/v1/chat\", \"event\": \"Authenticating user request\"}\r\n{\"event\": \"Using fallback RBAC context\"}\r\n{\"event\": \"Fallback RBAC context created successfully\"}\r\n{\"session_id\": \"s_sql\", \"turn_id\": \"f280e860-9351-49ea-a4df-ee793b8f55a5\", \"user_id\": \"tester_sql\", \"message_length\": 42, \"event\": \"Processing chat message\"}\r\n{\"container\": \"chat_history\", \"error\": \"(Forbidden) Request blocked by Auth salesforcebot-cosmos-sql : The given request [POST /dbs/appdb/colls/] cannot be authorized by AAD token in data plane. Learn more: https://aka.ms/cosmos-native-rbac.\\r\\nActivityId: 734fe648-306c-4a28-9cab-5bcb674f820b, Microsoft.Azure.Documents.Common/2.14.0\\nCode: Forbidden\\nMessage: Request blocked by Auth salesforcebot-cosmos-sql : The given request [POST /dbs/appdb/colls/] cannot be authorized by AAD token in data plane. Learn more: https://aka.ms/cosmos-native-rbac.\\r\\nActivityId: 734fe648-306c-4a28-9cab-5bcb674f820b, Microsoft.Azure.Documents.Common/2.14.0\", \"event\": \"Failed to create container due to AAD data-plane authorization. Cosmos may require key auth for management operations or pre-created containers. See https://aka.ms/cosmos-native-rbac for details.\"}\r\n{\"container\": \"chat_history\", \"error\": \"(Forbidden) Request blocked by Auth salesforcebot-cosmos-sql : The given request [POST /dbs/appdb/colls/] cannot be authorized by AAD token in data plane. Learn more: https://aka.ms/cosmos-native-rbac.\\r\\nActivityId: 0950d424-4bd4-4e1a-a0b5-e5679ab220ce, Microsoft.Azure.Documents.Common/2.14.0\\nCode: Forbidden\\nMessage: Request blocked by Auth salesforcebot-cosmos-sql : The given request [POST /dbs/appdb/colls/] cannot be authorized by AAD token in data plane. Learn more: https://aka.ms/cosmos-native-rbac.\\r\\nActivityId: 0950d424-4bd4-4e1a-a0b5-e5679ab220ce, Microsoft.Azure.Documents.Common/2.14.0\", \"event\": \"Failed to create container due to AAD data-plane authorization. Cosmos may require key auth for management operations or pre-created containers. See https://aka.ms/cosmos-native-rbac for details.\"}\r\n{\"container\": \"chat_history\", \"error\": \"(Forbidden) Request blocked by Auth salesforcebot-cosmos-sql : The given request [POST /dbs/appdb/colls/] cannot be authorized by AAD token in data plane. Learn more: https://aka.ms/cosmos-native-rbac.\\r\\nActivityId: b60f8435-f620-46f4-9aa5-400219144524, Microsoft.Azure.Documents.Common/2.14.0\\nCode: Forbidden\\nMessage: Request blocked by Auth salesforcebot-cosmos-sql : The given request [POST /dbs/appdb/colls/] cannot be authorized by AAD token in data plane. Learn more: https://aka.ms/cosmos-native-rbac.\\r\\nActivityId: b60f8435-f620-46f4-9aa5-400219144524, Microsoft.Azure.Documents.Common/2.14.0\", \"event\": \"Failed to create container due to AAD data-plane authorization. Cosmos may require key auth for management operations or pre-created containers. See https://aka.ms/cosmos-native-rbac for details.\"}\r\n{\"chat_id\": \"s_sql\", \"user_id\": \"user@example.com\", \"error\": \"RetryError[<Future at 0x22262648a50 state=finished raised CosmosHttpResponseError>]\", \"event\": \"Failed to get chat history\"}\r\n{\"chat_id\": \"s_sql\", \"user_id\": \"user@example.com\", \"event\": \"Chat history not found\"}\r\n{\"error\": \"'name'\", \"event\": \"Failed to list function definitions\"}\r\n{\"user_id\": \"user@example.com\", \"error\": \"'name'\", \"event\": \"Failed to get filtered functions\"}\r\n{\"agent_name\": \"planner_system\", \"tenant_id\": \"tenant123\", \"scenario\": \"general\", \"prompt_id\": \"prompt_planner_system\", \"event\": \"Retrieved system prompt\"}\r\n{\"plan_id\": \"45769fe9-99ad-4da4-b07b-dc72d36901a5\", \"plan_type\": \"sql_only\", \"agent_type\": \"sql_agent\", \"user_id\": \"user@example.com\", \"event\": \"Basic plan created\"}\r\n{\"plan_id\": \"45769fe9-99ad-4da4-b07b-dc72d36901a5\", \"user_id\": \"user@example.com\", \"steps_count\": 1, \"planner_type\": \"sequential\", \"event\": \"Plan created successfully\"}\r\n{\"plan_id\": \"45769fe9-99ad-4da4-b07b-dc72d36901a5\", \"execution_id\": \"3d0b983a-e584-405b-bf89-644c461674d1\", \"user_id\": \"user@example.com\", \"event\": \"Starting plan execution\"}\r\n{\"step_id\": \"eb028f60-fc7f-4b8e-8fd8-956bc95c02b3\", \"tool_name\": \"sql_agent\", \"user_id\": \"user@example.com\", \"event\": \"Executing plan step\"}\r\n{\"user_query\": \"Run a SQL-only plan to fetch account info.\", \"data_types\": \"opportunities,contacts,cases,revenue\", \"limit\": \"20\", \"user_id\": \"user@example.com\", \"event\": \"Querying account data from user query\"}\r\n{\"user_id\": \"user@example.com\", \"query_length\": 42, \"use_tfidf\": true, \"event\": \"Starting account resolution\"}\r\n{\"key\": \"allowed_accounts:user@example.com\", \"error\": \"Object of type datetime is not JSON serializable\", \"event\": \"Failed to set cache item\"}\r\n{\"account_count\": 3, \"event\": \"Fitting TF-IDF filter\"}\r\n{\"account_count\": 3, \"event\": \"Fitting TF-IDF vectorizer on account corpus\"}\r\n{\"error\": \"\\n**********************************************************************\\n  Resource \\u001b[93mpunkt_tab\\u001b[0m not found.\\n  Please use the NLTK Downloader to obtain the resource:\\n\\n  \\u001b[31m>>> import nltk\\n  >>> nltk.download('punkt_tab')\\n  \\u001b[0m\\n  For more information see: https://www.nltk.org/data.html\\n\\n  Attempted to load \\u001b[93mtokenizers/punkt_tab/english/\\u001b[0m\\n\\n  Searched in:\\n    - 'C:\\\\\\\\Users\\\\\\\\mcarz/nltk_data'\\n    - 'C:\\\\\\\\Users\\\\\\\\mcarz\\\\\\\\AppData\\\\\\\\Local\\\\\\\\Programs\\\\\\\\Python\\\\\\\\Python313\\\\\\\\nltk_data'\\n    - 'C:\\\\\\\\Users\\\\\\\\mcarz\\\\\\\\AppData\\\\\\\\Local\\\\\\\\Programs\\\\\\\\Python\\\\\\\\Python313\\\\\\\\share\\\\\\\\nltk_data'\\n    - 'C:\\\\\\\\Users\\\\\\\\mcarz\\\\\\\\AppData\\\\\\\\Local\\\\\\\\Programs\\\\\\\\Python\\\\\\\\Python313\\\\\\\\lib\\\\\\\\nltk_data'\\n    - 'C:\\\\\\\\Users\\\\\\\\mcarz\\\\\\\\AppData\\\\\\\\Roaming\\\\\\\\nltk_data'\\n    - 'C:\\\\\\\\nltk_data'\\n    - 'D:\\\\\\\\nltk_data'\\n    - 'E:\\\\\\\\nltk_data'\\n**********************************************************************\\n\", \"event\": \"Failed to fit TF-IDF vectorizer\"}\r\n{\"error\": \"\\n**********************************************************************\\n  Resource \\u001b[93mpunkt_tab\\u001b[0m not found.\\n  Please use the NLTK Downloader to obtain the resource:\\n\\n  \\u001b[31m>>> import nltk\\n  >>> nltk.download('punkt_tab')\\n  \\u001b[0m\\n  For more information see: https://www.nltk.org/data.html\\n\\n  Attempted to load \\u001b[93mtokenizers/punkt_tab/english/\\u001b[0m\\n\\n  Searched in:\\n    - 'C:\\\\\\\\Users\\\\\\\\mcarz/nltk_data'\\n    - 'C:\\\\\\\\Users\\\\\\\\mcarz\\\\\\\\AppData\\\\\\\\Local\\\\\\\\Programs\\\\\\\\Python\\\\\\\\Python313\\\\\\\\nltk_data'\\n    - 'C:\\\\\\\\Users\\\\\\\\mcarz\\\\\\\\AppData\\\\\\\\Local\\\\\\\\Programs\\\\\\\\Python\\\\\\\\Python313\\\\\\\\share\\\\\\\\nltk_data'\\n    - 'C:\\\\\\\\Users\\\\\\\\mcarz\\\\\\\\AppData\\\\\\\\Local\\\\\\\\Programs\\\\\\\\Python\\\\\\\\Python313\\\\\\\\lib\\\\\\\\nltk_data'\\n    - 'C:\\\\\\\\Users\\\\\\\\mcarz\\\\\\\\AppData\\\\\\\\Roaming\\\\\\\\nltk_data'\\n    - 'C:\\\\\\\\nltk_data'\\n    - 'D:\\\\\\\\nltk_data'\\n    - 'E:\\\\\\\\nltk_data'\\n**********************************************************************\\n\", \"event\": \"Failed to fit TF-IDF filter\"}\r\n{\"event\": \"TF-IDF vectorizer not fitted, returning empty results\"}\r\n{\"event\": \"Created Azure OpenAI client with managed identity token\"}\r\n{\"error\": \"Connection error.\", \"deployment\": \"gpt-4o\", \"message_count\": 2, \"event\": \"Failed to create chat completion\"}\r\n{\"event\": \"Created Azure OpenAI client with managed identity token\"}\r\n{\"error\": \"Connection error.\", \"deployment\": \"gpt-4o\", \"message_count\": 2, \"event\": \"Failed to create chat completion\"}\r\n{\"event\": \"Created Azure OpenAI client with managed identity token\"}\r\n{\"error\": \"Connection error.\", \"deployment\": \"gpt-4o\", \"message_count\": 2, \"event\": \"Failed to create chat completion\"}\r\n{\"error\": \"RetryError[<Future at 0x22263f11040 state=finished raised APIConnectionError>]\", \"event\": \"Failed to extract account candidates\"}\r\n{\"user_id\": \"user@example.com\", \"candidates_count\": 2, \"resolved_count\": 0, \"requires_disambiguation\": true, \"confidence\": 0.0, \"event\": \"LLM + embeddings resolution completed\"}\r\n{\"method\": \"llm_primary\", \"combined_confidence\": 0.0, \"resolved_count\": 0, \"suggestions_count\": 3, \"event\": \"Combined resolution results\"}\r\n{\"event_id\": \"9e87b43f-e7ef-4dbd-918d-6c708920a799\", \"event_type\": \"performance_metric\", \"severity\": \"info\", \"user_id\": \"user@example.com\", \"session_id\": null, \"event\": \"Telemetry event tracked\"}\r\n{\"user_query\": \"Run a SQL-only plan to fetch account info.\", \"error\": \"string indices must be integers, not 'str'\", \"event\": \"Failed to query account data\"}\r\n{\"step_id\": \"eb028f60-fc7f-4b8e-8fd8-956bc95c02b3\", \"event\": \"Step executed successfully\"}\r\n{\"plan_id\": \"45769fe9-99ad-4da4-b07b-dc72d36901a5\", \"execution_id\": \"3d0b983a-e584-405b-bf89-644c461674d1\", \"status\": \"completed\", \"duration_seconds\": 21.463812, \"event\": \"Plan execution completed\"}\r\n{\"database\": \"telemetry\", \"event\": \"Database not found, creating new database\"}\r\n{\"database\": \"telemetry\", \"container\": \"events\", \"error\": \"(Forbidden) Request blocked by Auth salesforcebot-cosmos-sql : The given request [POST /dbs] cannot be authorized by AAD token in data plane. Learn more: https://aka.ms/cosmos-native-rbac.\\r\\nActivityId: 598cad34-ee7e-44de-8089-54f0f3826428, Microsoft.Azure.Documents.Common/2.14.0\\nCode: Forbidden\\nMessage: Request blocked by Auth salesforcebot-cosmos-sql : The given request [POST /dbs] cannot be authorized by AAD token in data plane. Learn more: https://aka.ms/cosmos-native-rbac.\\r\\nActivityId: 598cad34-ee7e-44de-8089-54f0f3826428, Microsoft.Azure.Documents.Common/2.14.0\", \"event\": \"Failed to get or create container for database\"}\r\n{\"error\": \"(Forbidden) Request blocked by Auth salesforcebot-cosmos-sql : The given request [POST /dbs] cannot be authorized by AAD token in data plane. Learn more: https://aka.ms/cosmos-native-rbac.\\r\\nActivityId: 598cad34-ee7e-44de-8089-54f0f3826428, Microsoft.Azure.Documents.Common/2.14.0\\nCode: Forbidden\\nMessage: Request blocked by Auth salesforcebot-cosmos-sql : The given request [POST /dbs] cannot be authorized by AAD token in data plane. Learn more: https://aka.ms/cosmos-native-rbac.\\r\\nActivityId: 598cad34-ee7e-44de-8089-54f0f3826428, Microsoft.Azure.Documents.Common/2.14.0\", \"event\": \"Failed to store telemetry event\"}\r\n{\"container\": \"chat_history\", \"error\": \"(Forbidden) Request blocked by Auth salesforcebot-cosmos-sql : The given request [POST /dbs/appdb/colls/] cannot be authorized by AAD token in data plane. Learn more: https://aka.ms/cosmos-native-rbac.\\r\\nActivityId: 2c05bbee-6962-4625-9afc-5d4e395fa9dd, Microsoft.Azure.Documents.Common/2.14.0\\nCode: Forbidden\\nMessage: Request blocked by Auth salesforcebot-cosmos-sql : The given request [POST /dbs/appdb/colls/] cannot be authorized by AAD token in data plane. Learn more: https://aka.ms/cosmos-native-rbac.\\r\\nActivityId: 2c05bbee-6962-4625-9afc-5d4e395fa9dd, Microsoft.Azure.Documents.Common/2.14.0\", \"event\": \"Failed to create container due to AAD data-plane authorization. Cosmos may require key auth for management operations or pre-created containers. See https://aka.ms/cosmos-native-rbac for details.\"}\r\n{\"container\": \"chat_history\", \"error\": \"(Forbidden) Request blocked by Auth salesforcebot-cosmos-sql : The given request [POST /dbs/appdb/colls/] cannot be authorized by AAD token in data plane. Learn more: https://aka.ms/cosmos-native-rbac.\\r\\nActivityId: dcf6fa72-7dfd-4ee8-af68-1f11271cf614, Microsoft.Azure.Documents.Common/2.14.0\\nCode: Forbidden\\nMessage: Request blocked by Auth salesforcebot-cosmos-sql : The given request [POST /dbs/appdb/colls/] cannot be authorized by AAD token in data plane. Learn more: https://aka.ms/cosmos-native-rbac.\\r\\nActivityId: dcf6fa72-7dfd-4ee8-af68-1f11271cf614, Microsoft.Azure.Documents.Common/2.14.0\", \"event\": \"Failed to create container due to AAD data-plane authorization. Cosmos may require key auth for management operations or pre-created containers. See https://aka.ms/cosmos-native-rbac for details.\"}\r\n{\"container\": \"chat_history\", \"error\": \"(Forbidden) Request blocked by Auth salesforcebot-cosmos-sql : The given request [POST /dbs/appdb/colls/] cannot be authorized by AAD token in data plane. Learn more: https://aka.ms/cosmos-native-rbac.\\r\\nActivityId: d75612e0-6aba-4fe6-a9dd-e111d5fcd89d, Microsoft.Azure.Documents.Common/2.14.0\\nCode: Forbidden\\nMessage: Request blocked by Auth salesforcebot-cosmos-sql : The given request [POST /dbs/appdb/colls/] cannot be authorized by AAD token in data plane. Learn more: https://aka.ms/cosmos-native-rbac.\\r\\nActivityId: d75612e0-6aba-4fe6-a9dd-e111d5fcd89d, Microsoft.Azure.Documents.Common/2.14.0\", \"event\": \"Failed to create container due to AAD data-plane authorization. Cosmos may require key auth for management operations or pre-created containers. See https://aka.ms/cosmos-native-rbac for details.\"}\r\n{\"chat_id\": \"s_sql\", \"user_id\": \"user@example.com\", \"error\": \"RetryError[<Future at 0x22263ee2410 state=finished raised CosmosHttpResponseError>]\", \"event\": \"Failed to get chat history\"}\r\n{\"chat_id\": \"s_sql\", \"event\": \"Chat history not found for turn addition\"}\r\n{\"chat_id\": \"s_sql\", \"user_id\": \"user@example.com\", \"error\": \"Failed to save conversation turn to repository\", \"event\": \"Failed to add conversation turn\"}\r\n{\"event\": \"Failed to save conversation turn: Failed to save conversation turn to repository\"}\r\n{\"session_id\": \"s_sql\", \"turn_id\": \"f280e860-9351-49ea-a4df-ee793b8f55a5\", \"response_length\": 133, \"sources_count\": 0, \"event\": \"Chat message processed successfully\"}\r\nDEBUG: [794bbb6a] Handler completed successfully\r\nDEBUG: [794bbb6a] Response status: 200\r\nDEBUG: [794bbb6a] Tasks after request: 5\r\nDEBUG: [794bbb6a] Event loop running: True, closed: False\r\n{\"request_id\": \"794bbb6a\", \"method\": \"POST\", \"url\": \"http://localhost:8000/api/v1/chat\", \"status_code\": 200, \"duration_ms\": 39835, \"event\": \"HTTP request completed\"}\r\nDEBUG: [794bbb6a] REQUEST COMPLETED successfully\r\nINFO:     127.0.0.1:61295 - \"POST /api/v1/chat HTTP/1.1\" 200 OK\r\n{\"request_id\": \"57029c8f\", \"method\": \"POST\", \"url\": \"http://localhost:8000/api/v1/chat\", \"user_agent\": \"python-requests/2.32.5\", \"event\": \"HTTP request started\"}\r\nDEBUG: [57029c8f] REQUEST START: POST http://localhost:8000/api/v1/chat\r\nDEBUG: [57029c8f] Headers: {'host': 'localhost:8000', 'user-agent': 'python-requests/2.32.5', 'accept-encoding': 'gzip, deflate', 'accept': '*/*', 'connection': 'keep-alive', 'content-length': '176', 'content-type': 'application/json'}\r\nDEBUG: [57029c8f] Tasks before request: 4\r\nDEBUG: [57029c8f] Event loop running: True, closed: False\r\nDEBUG: [57029c8f] About to call next middleware/handler\r\n{\"url\": \"http://localhost:8000/api/v1/chat\", \"event\": \"Authenticating user request\"}\r\n{\"event\": \"Using fallback RBAC context\"}\r\n{\"event\": \"Fallback RBAC context created successfully\"}\r\n{\"session_id\": \"s_graph\", \"turn_id\": \"0a174ddf-3fdf-4dc7-ab3f-6fcb6a50733a\", \"user_id\": \"tester_graph\", \"message_length\": 47, \"event\": \"Processing chat message\"}\r\n{\"container\": \"chat_history\", \"error\": \"(Forbidden) Request blocked by Auth salesforcebot-cosmos-sql : The given request [POST /dbs/appdb/colls/] cannot be authorized by AAD token in data plane. Learn more: https://aka.ms/cosmos-native-rbac.\\r\\nActivityId: 0249dfde-7ffa-424c-ab1e-27a8e19493ca, Microsoft.Azure.Documents.Common/2.14.0\\nCode: Forbidden\\nMessage: Request blocked by Auth salesforcebot-cosmos-sql : The given request [POST /dbs/appdb/colls/] cannot be authorized by AAD token in data plane. Learn more: https://aka.ms/cosmos-native-rbac.\\r\\nActivityId: 0249dfde-7ffa-424c-ab1e-27a8e19493ca, Microsoft.Azure.Documents.Common/2.14.0\", \"event\": \"Failed to create container due to AAD data-plane authorization. Cosmos may require key auth for management operations or pre-created containers. See https://aka.ms/cosmos-native-rbac for details.\"}\r\n{\"container\": \"chat_history\", \"error\": \"(Forbidden) Request blocked by Auth salesforcebot-cosmos-sql : The given request [POST /dbs/appdb/colls/] cannot be authorized by AAD token in data plane. Learn more: https://aka.ms/cosmos-native-rbac.\\r\\nActivityId: 04f31b57-0900-41ec-bd17-97c76d43fbef, Microsoft.Azure.Documents.Common/2.14.0\\nCode: Forbidden\\nMessage: Request blocked by Auth salesforcebot-cosmos-sql : The given request [POST /dbs/appdb/colls/] cannot be authorized by AAD token in data plane. Learn more: https://aka.ms/cosmos-native-rbac.\\r\\nActivityId: 04f31b57-0900-41ec-bd17-97c76d43fbef, Microsoft.Azure.Documents.Common/2.14.0\", \"event\": \"Failed to create container due to AAD data-plane authorization. Cosmos may require key auth for management operations or pre-created containers. See https://aka.ms/cosmos-native-rbac for details.\"}\r\n{\"container\": \"chat_history\", \"error\": \"(Forbidden) Request blocked by Auth salesforcebot-cosmos-sql : The given request [POST /dbs/appdb/colls/] cannot be authorized by AAD token in data plane. Learn more: https://aka.ms/cosmos-native-rbac.\\r\\nActivityId: e46f4f16-dcdb-4ea1-9ff1-d274da196570, Microsoft.Azure.Documents.Common/2.14.0\\nCode: Forbidden\\nMessage: Request blocked by Auth salesforcebot-cosmos-sql : The given request [POST /dbs/appdb/colls/] cannot be authorized by AAD token in data plane. Learn more: https://aka.ms/cosmos-native-rbac.\\r\\nActivityId: e46f4f16-dcdb-4ea1-9ff1-d274da196570, Microsoft.Azure.Documents.Common/2.14.0\", \"event\": \"Failed to create container due to AAD data-plane authorization. Cosmos may require key auth for management operations or pre-created containers. See https://aka.ms/cosmos-native-rbac for details.\"}\r\n{\"chat_id\": \"s_graph\", \"user_id\": \"user@example.com\", \"error\": \"RetryError[<Future at 0x22263eed020 state=finished raised CosmosHttpResponseError>]\", \"event\": \"Failed to get chat history\"}\r\n{\"chat_id\": \"s_graph\", \"user_id\": \"user@example.com\", \"event\": \"Chat history not found\"}\r\n{\"error\": \"'name'\", \"event\": \"Failed to list function definitions\"}\r\n{\"user_id\": \"user@example.com\", \"error\": \"'name'\", \"event\": \"Failed to get filtered functions\"}\r\n{\"agent_name\": \"planner_system\", \"tenant_id\": \"tenant123\", \"scenario\": \"general\", \"prompt_id\": \"prompt_planner_system\", \"event\": \"Retrieved system prompt\"}\r\n{\"plan_id\": \"74c89ff2-3f48-4f0a-aa0a-7eefa23c51d9\", \"plan_type\": \"graph_only\", \"agent_type\": \"graph_agent\", \"user_id\": \"user@example.com\", \"event\": \"Basic plan created\"}\r\n{\"plan_id\": \"74c89ff2-3f48-4f0a-aa0a-7eefa23c51d9\", \"user_id\": \"user@example.com\", \"steps_count\": 1, \"planner_type\": \"sequential\", \"event\": \"Plan created successfully\"}\r\n{\"plan_id\": \"74c89ff2-3f48-4f0a-aa0a-7eefa23c51d9\", \"execution_id\": \"2af5f0c2-a154-4ce9-9fd1-869ba744efcd\", \"user_id\": \"user@example.com\", \"event\": \"Starting plan execution\"}\r\n{\"step_id\": \"f72cc0f9-f3a3-4067-b298-a7491d937755\", \"tool_name\": \"graph_agent\", \"user_id\": \"user@example.com\", \"event\": \"Executing plan step\"}\r\n{\"user_query\": \"Run a Graph-only plan to explore relationships.\", \"relationship_types\": \"\", \"max_depth\": \"2\", \"user_id\": \"user@example.com\", \"event\": \"Finding account relationships from query\"}\r\n{\"user_id\": \"user@example.com\", \"query_length\": 47, \"use_tfidf\": true, \"event\": \"Starting account resolution\"}\r\n{\"key\": \"allowed_accounts:user@example.com\", \"error\": \"Object of type datetime is not JSON serializable\", \"event\": \"Failed to set cache item\"}\r\n{\"account_count\": 3, \"event\": \"Fitting TF-IDF filter\"}\r\n{\"account_count\": 3, \"event\": \"Fitting TF-IDF vectorizer on account corpus\"}\r\n{\"error\": \"\\n**********************************************************************\\n  Resource \\u001b[93mpunkt_tab\\u001b[0m not found.\\n  Please use the NLTK Downloader to obtain the resource:\\n\\n  \\u001b[31m>>> import nltk\\n  >>> nltk.download('punkt_tab')\\n  \\u001b[0m\\n  For more information see: https://www.nltk.org/data.html\\n\\n  Attempted to load \\u001b[93mtokenizers/punkt_tab/english/\\u001b[0m\\n\\n  Searched in:\\n    - 'C:\\\\\\\\Users\\\\\\\\mcarz/nltk_data'\\n    - 'C:\\\\\\\\Users\\\\\\\\mcarz\\\\\\\\AppData\\\\\\\\Local\\\\\\\\Programs\\\\\\\\Python\\\\\\\\Python313\\\\\\\\nltk_data'\\n    - 'C:\\\\\\\\Users\\\\\\\\mcarz\\\\\\\\AppData\\\\\\\\Local\\\\\\\\Programs\\\\\\\\Python\\\\\\\\Python313\\\\\\\\share\\\\\\\\nltk_data'\\n    - 'C:\\\\\\\\Users\\\\\\\\mcarz\\\\\\\\AppData\\\\\\\\Local\\\\\\\\Programs\\\\\\\\Python\\\\\\\\Python313\\\\\\\\lib\\\\\\\\nltk_data'\\n    - 'C:\\\\\\\\Users\\\\\\\\mcarz\\\\\\\\AppData\\\\\\\\Roaming\\\\\\\\nltk_data'\\n    - 'C:\\\\\\\\nltk_data'\\n    - 'D:\\\\\\\\nltk_data'\\n    - 'E:\\\\\\\\nltk_data'\\n**********************************************************************\\n\", \"event\": \"Failed to fit TF-IDF vectorizer\"}\r\n{\"error\": \"\\n**********************************************************************\\n  Resource \\u001b[93mpunkt_tab\\u001b[0m not found.\\n  Please use the NLTK Downloader to obtain the resource:\\n\\n  \\u001b[31m>>> import nltk\\n  >>> nltk.download('punkt_tab')\\n  \\u001b[0m\\n  For more information see: https://www.nltk.org/data.html\\n\\n  Attempted to load \\u001b[93mtokenizers/punkt_tab/english/\\u001b[0m\\n\\n  Searched in:\\n    - 'C:\\\\\\\\Users\\\\\\\\mcarz/nltk_data'\\n    - 'C:\\\\\\\\Users\\\\\\\\mcarz\\\\\\\\AppData\\\\\\\\Local\\\\\\\\Programs\\\\\\\\Python\\\\\\\\Python313\\\\\\\\nltk_data'\\n    - 'C:\\\\\\\\Users\\\\\\\\mcarz\\\\\\\\AppData\\\\\\\\Local\\\\\\\\Programs\\\\\\\\Python\\\\\\\\Python313\\\\\\\\share\\\\\\\\nltk_data'\\n    - 'C:\\\\\\\\Users\\\\\\\\mcarz\\\\\\\\AppData\\\\\\\\Local\\\\\\\\Programs\\\\\\\\Python\\\\\\\\Python313\\\\\\\\lib\\\\\\\\nltk_data'\\n    - 'C:\\\\\\\\Users\\\\\\\\mcarz\\\\\\\\AppData\\\\\\\\Roaming\\\\\\\\nltk_data'\\n    - 'C:\\\\\\\\nltk_data'\\n    - 'D:\\\\\\\\nltk_data'\\n    - 'E:\\\\\\\\nltk_data'\\n**********************************************************************\\n\", \"event\": \"Failed to fit TF-IDF filter\"}\r\n{\"event\": \"TF-IDF vectorizer not fitted, returning empty results\"}\r\n{\"event\": \"Created Azure OpenAI client with managed identity token\"}\r\n{\"error\": \"Connection error.\", \"deployment\": \"gpt-4o\", \"message_count\": 2, \"event\": \"Failed to create chat completion\"}\r\n{\"event\": \"Created Azure OpenAI client with managed identity token\"}\r\n{\"error\": \"Connection error.\", \"deployment\": \"gpt-4o\", \"message_count\": 2, \"event\": \"Failed to create chat completion\"}\r\n{\"event\": \"Created Azure OpenAI client with managed identity token\"}\r\n{\"error\": \"Connection error.\", \"deployment\": \"gpt-4o\", \"message_count\": 2, \"event\": \"Failed to create chat completion\"}\r\n{\"error\": \"RetryError[<Future at 0x22263ef7070 state=finished raised APIConnectionError>]\", \"event\": \"Failed to extract account candidates\"}\r\n{\"user_id\": \"user@example.com\", \"candidates_count\": 3, \"resolved_count\": 0, \"requires_disambiguation\": true, \"confidence\": 0.0, \"event\": \"LLM + embeddings resolution completed\"}\r\n{\"method\": \"llm_primary\", \"combined_confidence\": 0.0, \"resolved_count\": 0, \"suggestions_count\": 3, \"event\": \"Combined resolution results\"}\r\n{\"step_id\": \"f72cc0f9-f3a3-4067-b298-a7491d937755\", \"event\": \"Step executed successfully\"}\r\n{\"plan_id\": \"74c89ff2-3f48-4f0a-aa0a-7eefa23c51d9\", \"execution_id\": \"2af5f0c2-a154-4ce9-9fd1-869ba744efcd\", \"status\": \"completed\", \"duration_seconds\": 20.967798, \"event\": \"Plan execution completed\"}\r\n{\"container\": \"chat_history\", \"error\": \"(Forbidden) Request blocked by Auth salesforcebot-cosmos-sql : The given request [POST /dbs/appdb/colls/] cannot be authorized by AAD token in data plane. Learn more: https://aka.ms/cosmos-native-rbac.\\r\\nActivityId: 01720d85-67cd-4913-8d9f-d45592f996d0, Microsoft.Azure.Documents.Common/2.14.0\\nCode: Forbidden\\nMessage: Request blocked by Auth salesforcebot-cosmos-sql : The given request [POST /dbs/appdb/colls/] cannot be authorized by AAD token in data plane. Learn more: https://aka.ms/cosmos-native-rbac.\\r\\nActivityId: 01720d85-67cd-4913-8d9f-d45592f996d0, Microsoft.Azure.Documents.Common/2.14.0\", \"event\": \"Failed to create container due to AAD data-plane authorization. Cosmos may require key auth for management operations or pre-created containers. See https://aka.ms/cosmos-native-rbac for details.\"}\r\n{\"container\": \"chat_history\", \"error\": \"(Forbidden) Request blocked by Auth salesforcebot-cosmos-sql : The given request [POST /dbs/appdb/colls/] cannot be authorized by AAD token in data plane. Learn more: https://aka.ms/cosmos-native-rbac.\\r\\nActivityId: 0635ee2a-5028-4ed4-adf0-648a0df6eca1, Microsoft.Azure.Documents.Common/2.14.0\\nCode: Forbidden\\nMessage: Request blocked by Auth salesforcebot-cosmos-sql : The given request [POST /dbs/appdb/colls/] cannot be authorized by AAD token in data plane. Learn more: https://aka.ms/cosmos-native-rbac.\\r\\nActivityId: 0635ee2a-5028-4ed4-adf0-648a0df6eca1, Microsoft.Azure.Documents.Common/2.14.0\", \"event\": \"Failed to create container due to AAD data-plane authorization. Cosmos may require key auth for management operations or pre-created containers. See https://aka.ms/cosmos-native-rbac for details.\"}\r\n{\"container\": \"chat_history\", \"error\": \"(Forbidden) Request blocked by Auth salesforcebot-cosmos-sql : The given request [POST /dbs/appdb/colls/] cannot be authorized by AAD token in data plane. Learn more: https://aka.ms/cosmos-native-rbac.\\r\\nActivityId: b92e3f81-9fe1-4f9c-b044-507fd3906195, Microsoft.Azure.Documents.Common/2.14.0\\nCode: Forbidden\\nMessage: Request blocked by Auth salesforcebot-cosmos-sql : The given request [POST /dbs/appdb/colls/] cannot be authorized by AAD token in data plane. Learn more: https://aka.ms/cosmos-native-rbac.\\r\\nActivityId: b92e3f81-9fe1-4f9c-b044-507fd3906195, Microsoft.Azure.Documents.Common/2.14.0\", \"event\": \"Failed to create container due to AAD data-plane authorization. Cosmos may require key auth for management operations or pre-created containers. See https://aka.ms/cosmos-native-rbac for details.\"}\r\n{\"chat_id\": \"s_graph\", \"user_id\": \"user@example.com\", \"error\": \"RetryError[<Future at 0x222626b1bd0 state=finished raised CosmosHttpResponseError>]\", \"event\": \"Failed to get chat history\"}\r\n{\"chat_id\": \"s_graph\", \"event\": \"Chat history not found for turn addition\"}\r\n{\"chat_id\": \"s_graph\", \"user_id\": \"user@example.com\", \"error\": \"Failed to save conversation turn to repository\", \"event\": \"Failed to add conversation turn\"}\r\n{\"event\": \"Failed to save conversation turn: Failed to save conversation turn to repository\"}\r\n{\"session_id\": \"s_graph\", \"turn_id\": \"0a174ddf-3fdf-4dc7-ab3f-6fcb6a50733a\", \"response_length\": 209, \"sources_count\": 0, \"event\": \"Chat message processed successfully\"}\r\nDEBUG: [57029c8f] Handler completed successfully\r\nDEBUG: [57029c8f] Response status: 200\r\nDEBUG: [57029c8f] Tasks after request: 5\r\nDEBUG: [57029c8f] Event loop running: True, closed: False\r\n{\"request_id\": \"57029c8f\", \"method\": \"POST\", \"url\": \"http://localhost:8000/api/v1/chat\", \"status_code\": 200, \"duration_ms\": 39213, \"event\": \"HTTP request completed\"}\r\nDEBUG: [57029c8f] REQUEST COMPLETED successfully\r\nINFO:     127.0.0.1:61307 - \"POST /api/v1/chat HTTP/1.1\" 200 OK\r\n{\"request_id\": \"4661b63b\", \"method\": \"POST\", \"url\": \"http://localhost:8000/api/v1/chat\", \"user_agent\": \"python-requests/2.32.5\", \"event\": \"HTTP request started\"}\r\nDEBUG: [4661b63b] REQUEST START: POST http://localhost:8000/api/v1/chat\r\nDEBUG: [4661b63b] Headers: {'host': 'localhost:8000', 'user-agent': 'python-requests/2.32.5', 'accept-encoding': 'gzip, deflate', 'accept': '*/*', 'connection': 'keep-alive', 'content-length': '187', 'content-type': 'application/json'}\r\nDEBUG: [4661b63b] Tasks before request: 4\r\nDEBUG: [4661b63b] Event loop running: True, closed: False\r\nDEBUG: [4661b63b] About to call next middleware/handler\r\n{\"url\": \"http://localhost:8000/api/v1/chat\", \"event\": \"Authenticating user request\"}\r\n{\"event\": \"Using fallback RBAC context\"}\r\n{\"event\": \"Fallback RBAC context created successfully\"}\r\n{\"session_id\": \"s_hybrid\", \"turn_id\": \"48a116bb-6ed6-42e1-970b-86479fc2d06d\", \"user_id\": \"tester_hybrid\", \"message_length\": 60, \"event\": \"Processing chat message\"}\r\n{\"container\": \"chat_history\", \"error\": \"(Forbidden) Request blocked by Auth salesforcebot-cosmos-sql : The given request [POST /dbs/appdb/colls/] cannot be authorized by AAD token in data plane. Learn more: https://aka.ms/cosmos-native-rbac.\\r\\nActivityId: 0ec2b588-7bf0-4a04-8cf8-3c7569f23410, Microsoft.Azure.Documents.Common/2.14.0\\nCode: Forbidden\\nMessage: Request blocked by Auth salesforcebot-cosmos-sql : The given request [POST /dbs/appdb/colls/] cannot be authorized by AAD token in data plane. Learn more: https://aka.ms/cosmos-native-rbac.\\r\\nActivityId: 0ec2b588-7bf0-4a04-8cf8-3c7569f23410, Microsoft.Azure.Documents.Common/2.14.0\", \"event\": \"Failed to create container due to AAD data-plane authorization. Cosmos may require key auth for management operations or pre-created containers. See https://aka.ms/cosmos-native-rbac for details.\"}\r\n{\"container\": \"chat_history\", \"error\": \"(Forbidden) Request blocked by Auth salesforcebot-cosmos-sql : The given request [POST /dbs/appdb/colls/] cannot be authorized by AAD token in data plane. Learn more: https://aka.ms/cosmos-native-rbac.\\r\\nActivityId: d1624d11-e4a4-4863-9f63-458085fae0b4, Microsoft.Azure.Documents.Common/2.14.0\\nCode: Forbidden\\nMessage: Request blocked by Auth salesforcebot-cosmos-sql : The given request [POST /dbs/appdb/colls/] cannot be authorized by AAD token in data plane. Learn more: https://aka.ms/cosmos-native-rbac.\\r\\nActivityId: d1624d11-e4a4-4863-9f63-458085fae0b4, Microsoft.Azure.Documents.Common/2.14.0\", \"event\": \"Failed to create container due to AAD data-plane authorization. Cosmos may require key auth for management operations or pre-created containers. See https://aka.ms/cosmos-native-rbac for details.\"}\r\n{\"container\": \"chat_history\", \"error\": \"(Forbidden) Request blocked by Auth salesforcebot-cosmos-sql : The given request [POST /dbs/appdb/colls/] cannot be authorized by AAD token in data plane. Learn more: https://aka.ms/cosmos-native-rbac.\\r\\nActivityId: 020db729-57c1-4447-8819-fb2559026516, Microsoft.Azure.Documents.Common/2.14.0\\nCode: Forbidden\\nMessage: Request blocked by Auth salesforcebot-cosmos-sql : The given request [POST /dbs/appdb/colls/] cannot be authorized by AAD token in data plane. Learn more: https://aka.ms/cosmos-native-rbac.\\r\\nActivityId: 020db729-57c1-4447-8819-fb2559026516, Microsoft.Azure.Documents.Common/2.14.0\", \"event\": \"Failed to create container due to AAD data-plane authorization. Cosmos may require key auth for management operations or pre-created containers. See https://aka.ms/cosmos-native-rbac for details.\"}\r\n{\"chat_id\": \"s_hybrid\", \"user_id\": \"user@example.com\", \"error\": \"RetryError[<Future at 0x22263f236d0 state=finished raised CosmosHttpResponseError>]\", \"event\": \"Failed to get chat history\"}\r\n{\"chat_id\": \"s_hybrid\", \"user_id\": \"user@example.com\", \"event\": \"Chat history not found\"}\r\n{\"error\": \"'name'\", \"event\": \"Failed to list function definitions\"}\r\n{\"user_id\": \"user@example.com\", \"error\": \"'name'\", \"event\": \"Failed to get filtered functions\"}\r\n{\"agent_name\": \"planner_system\", \"tenant_id\": \"tenant123\", \"scenario\": \"general\", \"prompt_id\": \"prompt_planner_system\", \"event\": \"Retrieved system prompt\"}\r\n{\"plan_id\": \"e8a4930e-cfbd-4b72-b805-caa8de94f3ef\", \"plan_type\": \"sql_only\", \"agent_type\": \"sql_agent\", \"user_id\": \"user@example.com\", \"event\": \"Basic plan created\"}\r\n{\"plan_id\": \"e8a4930e-cfbd-4b72-b805-caa8de94f3ef\", \"user_id\": \"user@example.com\", \"steps_count\": 1, \"planner_type\": \"sequential\", \"event\": \"Plan created successfully\"}\r\n{\"plan_id\": \"e8a4930e-cfbd-4b72-b805-caa8de94f3ef\", \"execution_id\": \"868f4fc1-6555-44ec-9ea3-d7fd4af62aa5\", \"user_id\": \"user@example.com\", \"event\": \"Starting plan execution\"}\r\n{\"step_id\": \"b0c5f9aa-d7dd-45e3-940c-7faa84803cc5\", \"tool_name\": \"sql_agent\", \"user_id\": \"user@example.com\", \"event\": \"Executing plan step\"}\r\n{\"user_query\": \"Use any tools necessary to answer and combine SQL and Graph.\", \"data_types\": \"opportunities,contacts,cases,revenue\", \"limit\": \"20\", \"user_id\": \"user@example.com\", \"event\": \"Querying account data from user query\"}\r\n{\"user_id\": \"user@example.com\", \"query_length\": 60, \"use_tfidf\": true, \"event\": \"Starting account resolution\"}\r\n{\"key\": \"allowed_accounts:user@example.com\", \"error\": \"Object of type datetime is not JSON serializable\", \"event\": \"Failed to set cache item\"}\r\n{\"account_count\": 3, \"event\": \"Fitting TF-IDF filter\"}\r\n{\"account_count\": 3, \"event\": \"Fitting TF-IDF vectorizer on account corpus\"}\r\n{\"error\": \"\\n**********************************************************************\\n  Resource \\u001b[93mpunkt_tab\\u001b[0m not found.\\n  Please use the NLTK Downloader to obtain the resource:\\n\\n  \\u001b[31m>>> import nltk\\n  >>> nltk.download('punkt_tab')\\n  \\u001b[0m\\n  For more information see: https://www.nltk.org/data.html\\n\\n  Attempted to load \\u001b[93mtokenizers/punkt_tab/english/\\u001b[0m\\n\\n  Searched in:\\n    - 'C:\\\\\\\\Users\\\\\\\\mcarz/nltk_data'\\n    - 'C:\\\\\\\\Users\\\\\\\\mcarz\\\\\\\\AppData\\\\\\\\Local\\\\\\\\Programs\\\\\\\\Python\\\\\\\\Python313\\\\\\\\nltk_data'\\n    - 'C:\\\\\\\\Users\\\\\\\\mcarz\\\\\\\\AppData\\\\\\\\Local\\\\\\\\Programs\\\\\\\\Python\\\\\\\\Python313\\\\\\\\share\\\\\\\\nltk_data'\\n    - 'C:\\\\\\\\Users\\\\\\\\mcarz\\\\\\\\AppData\\\\\\\\Local\\\\\\\\Programs\\\\\\\\Python\\\\\\\\Python313\\\\\\\\lib\\\\\\\\nltk_data'\\n    - 'C:\\\\\\\\Users\\\\\\\\mcarz\\\\\\\\AppData\\\\\\\\Roaming\\\\\\\\nltk_data'\\n    - 'C:\\\\\\\\nltk_data'\\n    - 'D:\\\\\\\\nltk_data'\\n    - 'E:\\\\\\\\nltk_data'\\n**********************************************************************\\n\", \"event\": \"Failed to fit TF-IDF vectorizer\"}\r\n{\"error\": \"\\n**********************************************************************\\n  Resource \\u001b[93mpunkt_tab\\u001b[0m not found.\\n  Please use the NLTK Downloader to obtain the resource:\\n\\n  \\u001b[31m>>> import nltk\\n  >>> nltk.download('punkt_tab')\\n  \\u001b[0m\\n  For more information see: https://www.nltk.org/data.html\\n\\n  Attempted to load \\u001b[93mtokenizers/punkt_tab/english/\\u001b[0m\\n\\n  Searched in:\\n    - 'C:\\\\\\\\Users\\\\\\\\mcarz/nltk_data'\\n    - 'C:\\\\\\\\Users\\\\\\\\mcarz\\\\\\\\AppData\\\\\\\\Local\\\\\\\\Programs\\\\\\\\Python\\\\\\\\Python313\\\\\\\\nltk_data'\\n    - 'C:\\\\\\\\Users\\\\\\\\mcarz\\\\\\\\AppData\\\\\\\\Local\\\\\\\\Programs\\\\\\\\Python\\\\\\\\Python313\\\\\\\\share\\\\\\\\nltk_data'\\n    - 'C:\\\\\\\\Users\\\\\\\\mcarz\\\\\\\\AppData\\\\\\\\Local\\\\\\\\Programs\\\\\\\\Python\\\\\\\\Python313\\\\\\\\lib\\\\\\\\nltk_data'\\n    - 'C:\\\\\\\\Users\\\\\\\\mcarz\\\\\\\\AppData\\\\\\\\Roaming\\\\\\\\nltk_data'\\n    - 'C:\\\\\\\\nltk_data'\\n    - 'D:\\\\\\\\nltk_data'\\n    - 'E:\\\\\\\\nltk_data'\\n**********************************************************************\\n\", \"event\": \"Failed to fit TF-IDF filter\"}\r\n{\"event\": \"TF-IDF vectorizer not fitted, returning empty results\"}\r\n{\"event\": \"Created Azure OpenAI client with managed identity token\"}\r\n{\"error\": \"Connection error.\", \"deployment\": \"gpt-4o\", \"message_count\": 2, \"event\": \"Failed to create chat completion\"}\r\n{\"event\": \"Created Azure OpenAI client with managed identity token\"}\r\n{\"error\": \"Connection error.\", \"deployment\": \"gpt-4o\", \"message_count\": 2, \"event\": \"Failed to create chat completion\"}\r\n{\"event\": \"Created Azure OpenAI client with managed identity token\"}\r\n{\"error\": \"Connection error.\", \"deployment\": \"gpt-4o\", \"message_count\": 2, \"event\": \"Failed to create chat completion\"}\r\n{\"error\": \"RetryError[<Future at 0x22263e35bd0 state=finished raised APIConnectionError>]\", \"event\": \"Failed to extract account candidates\"}\r\n{\"user_id\": \"user@example.com\", \"candidates_count\": 4, \"resolved_count\": 0, \"requires_disambiguation\": true, \"confidence\": 0.0, \"event\": \"LLM + embeddings resolution completed\"}\r\n{\"method\": \"llm_primary\", \"combined_confidence\": 0.0, \"resolved_count\": 0, \"suggestions_count\": 3, \"event\": \"Combined resolution results\"}\r\n{\"event_id\": \"92351d2b-1e84-482d-bca5-2ffe9e033dfd\", \"event_type\": \"performance_metric\", \"severity\": \"info\", \"user_id\": \"user@example.com\", \"session_id\": null, \"event\": \"Telemetry event tracked\"}\r\n{\"user_query\": \"Use any tools necessary to answer and combine SQL and Graph.\", \"error\": \"string indices must be integers, not 'str'\", \"event\": \"Failed to query account data\"}\r\n{\"step_id\": \"b0c5f9aa-d7dd-45e3-940c-7faa84803cc5\", \"event\": \"Step executed successfully\"}\r\n{\"plan_id\": \"e8a4930e-cfbd-4b72-b805-caa8de94f3ef\", \"execution_id\": \"868f4fc1-6555-44ec-9ea3-d7fd4af62aa5\", \"status\": \"completed\", \"duration_seconds\": 22.15821, \"event\": \"Plan execution completed\"}\r\n{\"database\": \"telemetry\", \"event\": \"Database not found, creating new database\"}\r\n{\"database\": \"telemetry\", \"container\": \"events\", \"error\": \"(Forbidden) Request blocked by Auth salesforcebot-cosmos-sql : The given request [POST /dbs] cannot be authorized by AAD token in data plane. Learn more: https://aka.ms/cosmos-native-rbac.\\r\\nActivityId: 88cc1d03-d931-44e4-b49d-9f81ef696e1a, Microsoft.Azure.Documents.Common/2.14.0\\nCode: Forbidden\\nMessage: Request blocked by Auth salesforcebot-cosmos-sql : The given request [POST /dbs] cannot be authorized by AAD token in data plane. Learn more: https://aka.ms/cosmos-native-rbac.\\r\\nActivityId: 88cc1d03-d931-44e4-b49d-9f81ef696e1a, Microsoft.Azure.Documents.Common/2.14.0\", \"event\": \"Failed to get or create container for database\"}\r\n{\"error\": \"(Forbidden) Request blocked by Auth salesforcebot-cosmos-sql : The given request [POST /dbs] cannot be authorized by AAD token in data plane. Learn more: https://aka.ms/cosmos-native-rbac.\\r\\nActivityId: 88cc1d03-d931-44e4-b49d-9f81ef696e1a, Microsoft.Azure.Documents.Common/2.14.0\\nCode: Forbidden\\nMessage: Request blocked by Auth salesforcebot-cosmos-sql : The given request [POST /dbs] cannot be authorized by AAD token in data plane. Learn more: https://aka.ms/cosmos-native-rbac.\\r\\nActivityId: 88cc1d03-d931-44e4-b49d-9f81ef696e1a, Microsoft.Azure.Documents.Common/2.14.0\", \"event\": \"Failed to store telemetry event\"}\r\n{\"container\": \"chat_history\", \"error\": \"(Forbidden) Request blocked by Auth salesforcebot-cosmos-sql : The given request [POST /dbs/appdb/colls/] cannot be authorized by AAD token in data plane. Learn more: https://aka.ms/cosmos-native-rbac.\\r\\nActivityId: d777843a-8349-406a-950e-9454ce6bce42, Microsoft.Azure.Documents.Common/2.14.0\\nCode: Forbidden\\nMessage: Request blocked by Auth salesforcebot-cosmos-sql : The given request [POST /dbs/appdb/colls/] cannot be authorized by AAD token in data plane. Learn more: https://aka.ms/cosmos-native-rbac.\\r\\nActivityId: d777843a-8349-406a-950e-9454ce6bce42, Microsoft.Azure.Documents.Common/2.14.0\", \"event\": \"Failed to create container due to AAD data-plane authorization. Cosmos may require key auth for management operations or pre-created containers. See https://aka.ms/cosmos-native-rbac for details.\"}\r\n{\"container\": \"chat_history\", \"error\": \"(Forbidden) Request blocked by Auth salesforcebot-cosmos-sql : The given request [POST /dbs/appdb/colls/] cannot be authorized by AAD token in data plane. Learn more: https://aka.ms/cosmos-native-rbac.\\r\\nActivityId: 2e079b3f-a0f5-4540-8f90-fe3abf61db18, Microsoft.Azure.Documents.Common/2.14.0\\nCode: Forbidden\\nMessage: Request blocked by Auth salesforcebot-cosmos-sql : The given request [POST /dbs/appdb/colls/] cannot be authorized by AAD token in data plane. Learn more: https://aka.ms/cosmos-native-rbac.\\r\\nActivityId: 2e079b3f-a0f5-4540-8f90-fe3abf61db18, Microsoft.Azure.Documents.Common/2.14.0\", \"event\": \"Failed to create container due to AAD data-plane authorization. Cosmos may require key auth for management operations or pre-created containers. See https://aka.ms/cosmos-native-rbac for details.\"}\r\n{\"container\": \"chat_history\", \"error\": \"(Forbidden) Request blocked by Auth salesforcebot-cosmos-sql : The given request [POST /dbs/appdb/colls/] cannot be authorized by AAD token in data plane. Learn more: https://aka.ms/cosmos-native-rbac.\\r\\nActivityId: e4002305-b7e9-4b2a-a553-44b7b3e25ebb, Microsoft.Azure.Documents.Common/2.14.0\\nCode: Forbidden\\nMessage: Request blocked by Auth salesforcebot-cosmos-sql : The given request [POST /dbs/appdb/colls/] cannot be authorized by AAD token in data plane. Learn more: https://aka.ms/cosmos-native-rbac.\\r\\nActivityId: e4002305-b7e9-4b2a-a553-44b7b3e25ebb, Microsoft.Azure.Documents.Common/2.14.0\", \"event\": \"Failed to create container due to AAD data-plane authorization. Cosmos may require key auth for management operations or pre-created containers. See https://aka.ms/cosmos-native-rbac for details.\"}\r\n{\"chat_id\": \"s_hybrid\", \"user_id\": \"user@example.com\", \"error\": \"RetryError[<Future at 0x22263f234d0 state=finished raised CosmosHttpResponseError>]\", \"event\": \"Failed to get chat history\"}\r\n{\"chat_id\": \"s_hybrid\", \"event\": \"Chat history not found for turn addition\"}\r\n{\"chat_id\": \"s_hybrid\", \"user_id\": \"user@example.com\", \"error\": \"Failed to save conversation turn to repository\", \"event\": \"Failed to add conversation turn\"}\r\n{\"event\": \"Failed to save conversation turn: Failed to save conversation turn to repository\"}\r\n{\"session_id\": \"s_hybrid\", \"turn_id\": \"48a116bb-6ed6-42e1-970b-86479fc2d06d\", \"response_length\": 151, \"sources_count\": 0, \"event\": \"Chat message processed successfully\"}\r\nDEBUG: [4661b63b] Handler completed successfully\r\nDEBUG: [4661b63b] Response status: 200\r\nDEBUG: [4661b63b] Tasks after request: 5\r\nDEBUG: [4661b63b] Event loop running: True, closed: False\r\n{\"request_id\": \"4661b63b\", \"method\": \"POST\", \"url\": \"http://localhost:8000/api/v1/chat\", \"status_code\": 200, \"duration_ms\": 40426, \"event\": \"HTTP request completed\"}\r\nDEBUG: [4661b63b] REQUEST COMPLETED successfully\r\nINFO:     127.0.0.1:61319 - \"POST /api/v1/chat HTTP/1.1\" 200 OK\r\n"
    }
  ],
  "timestamp": 1758393458.372952
}