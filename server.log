{"origins": ["*"], "event": "Configured CORS middleware"}
{"api_prefix": "/api/v1", "event": "Configured application routes"}
{"app_name": "salesforce-chatbot", "version": "1.0.0", "debug": false, "event": "Created FastAPI application"}
{"version": "1.0.0", "event": "Starting Account Q&A Bot application"}
{"event": "Initializing Azure service clients"}
{"endpoint": "https://salesforcebot-aoai.cognitiveservices.azure.com", "chat_deployment": "gpt-4o", "embedding_deployment": "text-embedding-3-small", "event": "Initializing Azure OpenAI client"}
{"event": "Azure OpenAI client initialized successfully"}
{"endpoint": "https://salesforcebot-cosmos-sql.documents.azure.com:443/", "database": "appdb", "event": "Initializing Cosmos DB client"}
{"event": "Cosmos DB client initialized successfully"}
{"endpoint": "https://salesforcebot-cosmos-graph.gremlin.cosmos.azure.com:443/", "database": "graphdb", "graph": "account_graph", "event": "Initializing Gremlin client"}
{"event": "Gremlin client initialized successfully"}
{"event": "Fabric client running in dev mode - using dummy data"}
{"event": "Fabric client initialized successfully"}
{"event": "Initializing data repositories"}
{"container": "chat_history", "event": "Initialized chat history repository"}
{"container": "chat_history", "event": "Initialized chat history repository"}
{"event": "Initializing application services"}
{"enforce_rbac": false, "admin_users": 0, "event": "Initialized RBAC service"}
{"enforce_rbac": false, "admin_users": 0, "event": "Initialized RBAC service"}
{"min_similarity": 0.3, "max_candidates": 20, "event": "Account resolver filter initialized"}
{"use_tfidf": true, "confidence_threshold": 0.7, "tfidf_threshold": 0.3, "event": "Account resolver service initialized"}
{"confidence_threshold": 0.7, "event": "Account resolver service initialized"}
{"event": "Initializing Semantic Kernel agents"}
{"event": "Planner configuration skipped - using basic kernel functionality"}
{"event": "Planner service initialized"}
{"event": "SQL agent plugin registered with kernel"}
{"event": "SQL agent enabled"}
{"event": "Graph agent enabled"}
{"event": "Graph agent plugin registered with kernel"}
{"event": "Agents will load functions dynamically from database"}
{"event": "Application startup completed successfully"}
{"request_id": "e35f41f9", "method": "POST", "url": "http://localhost:8000/api/v1/chat", "user_agent": "python-requests/2.32.5", "event": "HTTP request started"}
DEBUG: [e35f41f9] REQUEST START: POST http://localhost:8000/api/v1/chat
DEBUG: [e35f41f9] Headers: {'host': 'localhost:8000', 'user-agent': 'python-requests/2.32.5', 'accept-encoding': 'gzip, deflate', 'accept': '*/*', 'connection': 'keep-alive', 'content-type': 'application/json', 'content-length': '155'}
DEBUG: [e35f41f9] Tasks before request: 4
DEBUG: [e35f41f9] Event loop running: True, closed: False
DEBUG: [e35f41f9] About to call next middleware/handler
{"url": "http://localhost:8000/api/v1/chat", "event": "Authenticating user request"}
{"user_id": "f96e8a42-f62e-4064-8897-1e12ca6e250a", "email": "", "roles": [], "is_admin": false, "permissions_count": 4, "event": "Created RBAC context"}
{"session_id": "test-session", "turn_id": "62414f3f-c7cd-43ec-a36a-7db66720bf0a", "user_id": "test-user", "message_length": 54, "event": "Processing chat message"}
{"event": "Created Cosmos DB client with managed identity"}
{"event": "Container 'chat_history' not found in database 'appdb'. Auto-creation of containers is disabled. Pre-create the container or enable provisioning explicitly. See https://aka.ms/cosmos-native-rbac for details."}
{"container": "chat_history", "error": "Container 'chat_history' not found in database 'appdb'. Auto-creation of containers is disabled. Pre-create the container or enable provisioning explicitly. See https://aka.ms/cosmos-native-rbac for details.", "event": "Failed to create container"}
{"chat_id": "test-session", "user_id": "f96e8a42-f62e-4064-8897-1e12ca6e250a", "error": "Container 'chat_history' not found in database 'appdb'. Auto-creation of containers is disabled. Pre-create the container or enable provisioning explicitly. See https://aka.ms/cosmos-native-rbac for details.", "event": "Failed to get chat history"}
{"chat_id": "test-session", "user_id": "f96e8a42-f62e-4064-8897-1e12ca6e250a", "event": "Chat history not found"}
{"error": "'name'", "event": "Failed to list function definitions"}
{"user_id": "f96e8a42-f62e-4064-8897-1e12ca6e250a", "error": "'name'", "event": "Failed to get filtered functions"}
{"agent_name": "planner_system", "tenant_id": "74c77be6-1ad3-4957-a4f2-94028372d7d6", "scenario": "general", "prompt_id": "prompt_planner_system", "event": "Retrieved system prompt"}
{"plan_id": "8c161198-6f9d-4f46-baa6-858cdb44f508", "plan_type": "sql_only", "agent_type": "sql_agent", "user_id": "f96e8a42-f62e-4064-8897-1e12ca6e250a", "event": "Basic plan created"}
{"plan_id": "8c161198-6f9d-4f46-baa6-858cdb44f508", "user_id": "f96e8a42-f62e-4064-8897-1e12ca6e250a", "steps_count": 1, "planner_type": "sequential", "event": "Plan created successfully"}
{"plan_id": "8c161198-6f9d-4f46-baa6-858cdb44f508", "execution_id": "01239696-c0f1-45a3-899c-24255d7357ce", "user_id": "f96e8a42-f62e-4064-8897-1e12ca6e250a", "event": "Starting plan execution"}
{"step_id": "b703198d-ff0e-47bb-a596-837f0f183c16", "tool_name": "sql_agent", "user_id": "f96e8a42-f62e-4064-8897-1e12ca6e250a", "event": "Executing plan step"}
{"user_query": "What are Salesforce's relationships and opportunities?", "data_types": "opportunities,contacts,cases,revenue", "limit": "20", "user_id": "f96e8a42-f62e-4064-8897-1e12ca6e250a", "event": "Querying account data from user query"}
{"user_id": "f96e8a42-f62e-4064-8897-1e12ca6e250a", "query_length": 54, "use_tfidf": true, "event": "Starting account resolution"}
{"key": "allowed_accounts:f96e8a42-f62e-4064-8897-1e12ca6e250a", "error": "Object of type datetime is not JSON serializable", "event": "Failed to set cache item"}
{"account_count": 3, "event": "Fitting TF-IDF filter"}
{"account_count": 3, "event": "Fitting TF-IDF vectorizer on account corpus"}
{"error": "\n**********************************************************************\n  Resource \u001b[93mpunkt_tab\u001b[0m not found.\n  Please use the NLTK Downloader to obtain the resource:\n\n  \u001b[31m>>> import nltk\n  >>> nltk.download('punkt_tab')\n  \u001b[0m\n  For more information see: https://www.nltk.org/data.html\n\n  Attempted to load \u001b[93mtokenizers/punkt_tab/english/\u001b[0m\n\n  Searched in:\n    - 'C:\\\\Users\\\\mcarz/nltk_data'\n    - 'C:\\\\Users\\\\mcarz\\\\AppData\\\\Local\\\\Programs\\\\Python\\\\Python313\\\\nltk_data'\n    - 'C:\\\\Users\\\\mcarz\\\\AppData\\\\Local\\\\Programs\\\\Python\\\\Python313\\\\share\\\\nltk_data'\n    - 'C:\\\\Users\\\\mcarz\\\\AppData\\\\Local\\\\Programs\\\\Python\\\\Python313\\\\lib\\\\nltk_data'\n    - 'C:\\\\Users\\\\mcarz\\\\AppData\\\\Roaming\\\\nltk_data'\n    - 'C:\\\\nltk_data'\n    - 'D:\\\\nltk_data'\n    - 'E:\\\\nltk_data'\n**********************************************************************\n", "event": "Failed to fit TF-IDF vectorizer"}
{"error": "\n**********************************************************************\n  Resource \u001b[93mpunkt_tab\u001b[0m not found.\n  Please use the NLTK Downloader to obtain the resource:\n\n  \u001b[31m>>> import nltk\n  >>> nltk.download('punkt_tab')\n  \u001b[0m\n  For more information see: https://www.nltk.org/data.html\n\n  Attempted to load \u001b[93mtokenizers/punkt_tab/english/\u001b[0m\n\n  Searched in:\n    - 'C:\\\\Users\\\\mcarz/nltk_data'\n    - 'C:\\\\Users\\\\mcarz\\\\AppData\\\\Local\\\\Programs\\\\Python\\\\Python313\\\\nltk_data'\n    - 'C:\\\\Users\\\\mcarz\\\\AppData\\\\Local\\\\Programs\\\\Python\\\\Python313\\\\share\\\\nltk_data'\n    - 'C:\\\\Users\\\\mcarz\\\\AppData\\\\Local\\\\Programs\\\\Python\\\\Python313\\\\lib\\\\nltk_data'\n    - 'C:\\\\Users\\\\mcarz\\\\AppData\\\\Roaming\\\\nltk_data'\n    - 'C:\\\\nltk_data'\n    - 'D:\\\\nltk_data'\n    - 'E:\\\\nltk_data'\n**********************************************************************\n", "event": "Failed to fit TF-IDF filter"}
{"event": "TF-IDF vectorizer not fitted, returning empty results"}
{"event": "Created Azure OpenAI client with managed identity token"}
{"error": "Connection error.", "deployment": "gpt-4o", "message_count": 2, "event": "Failed to create chat completion"}
{"event": "Created Azure OpenAI client with managed identity token"}
{"error": "Connection error.", "deployment": "gpt-4o", "message_count": 2, "event": "Failed to create chat completion"}
{"event": "Created Azure OpenAI client with managed identity token"}
{"error": "Connection error.", "deployment": "gpt-4o", "message_count": 2, "event": "Failed to create chat completion"}
{"error": "RetryError[<Future at 0x1ef1ae562c0 state=finished raised APIConnectionError>]", "event": "Failed to extract account candidates"}
{"user_id": "f96e8a42-f62e-4064-8897-1e12ca6e250a", "candidates_count": 2, "resolved_count": 0, "requires_disambiguation": true, "confidence": 0.0, "event": "LLM + embeddings resolution completed"}
{"method": "llm_primary", "combined_confidence": 0.0, "resolved_count": 0, "suggestions_count": 3, "event": "Combined resolution results"}
{"event_id": "8922fdc2-f524-4771-bc50-d8feb358ab90", "event_type": "performance_metric", "severity": "info", "user_id": "f96e8a42-f62e-4064-8897-1e12ca6e250a", "session_id": null, "event": "Telemetry event tracked"}
{"user_query": "What are Salesforce's relationships and opportunities?", "error": "string indices must be integers, not 'str'", "event": "Failed to query account data"}
{"step_id": "b703198d-ff0e-47bb-a596-837f0f183c16", "event": "Step executed successfully"}
{"plan_id": "8c161198-6f9d-4f46-baa6-858cdb44f508", "execution_id": "01239696-c0f1-45a3-899c-24255d7357ce", "status": "completed", "duration_seconds": 27.424716, "event": "Plan execution completed"}
{"session_id": "test-session", "turn_id": "62414f3f-c7cd-43ec-a36a-7db66720bf0a", "user_message": "What are Salesforce's relationships and opportunities?", "assistant_response": "{\"success\": false, \"error\": \"string indices must be integers, not 'str'\", \"user_query\": \"What are Sa...", "event": "Dev mode: Skipping conversation turn save"}
{"session_id": "test-session", "turn_id": "62414f3f-c7cd-43ec-a36a-7db66720bf0a", "response_length": 145, "sources_count": 0, "event": "Chat message processed successfully"}
DEBUG: [e35f41f9] Handler completed successfully
DEBUG: [e35f41f9] Response status: 200
DEBUG: [e35f41f9] Tasks after request: 6
DEBUG: [e35f41f9] Event loop running: True, closed: False
{"request_id": "e35f41f9", "method": "POST", "url": "http://localhost:8000/api/v1/chat", "status_code": 200, "duration_ms": 37463, "event": "HTTP request completed"}
DEBUG: [e35f41f9] REQUEST COMPLETED successfully
{"database": "telemetry", "event": "Database not found, creating new database"}
{"database": "telemetry", "container": "events", "error": "(Forbidden) Request blocked by Auth salesforcebot-cosmos-sql : The given request [POST /dbs] cannot be authorized by AAD token in data plane. Learn more: https://aka.ms/cosmos-native-rbac.\r\nActivityId: 299b34bb-2e16-45a6-9de5-e933e540240b, Microsoft.Azure.Documents.Common/2.14.0\nCode: Forbidden\nMessage: Request blocked by Auth salesforcebot-cosmos-sql : The given request [POST /dbs] cannot be authorized by AAD token in data plane. Learn more: https://aka.ms/cosmos-native-rbac.\r\nActivityId: 299b34bb-2e16-45a6-9de5-e933e540240b, Microsoft.Azure.Documents.Common/2.14.0", "event": "Failed to get or create container for database"}
{"error": "(Forbidden) Request blocked by Auth salesforcebot-cosmos-sql : The given request [POST /dbs] cannot be authorized by AAD token in data plane. Learn more: https://aka.ms/cosmos-native-rbac.\r\nActivityId: 299b34bb-2e16-45a6-9de5-e933e540240b, Microsoft.Azure.Documents.Common/2.14.0\nCode: Forbidden\nMessage: Request blocked by Auth salesforcebot-cosmos-sql : The given request [POST /dbs] cannot be authorized by AAD token in data plane. Learn more: https://aka.ms/cosmos-native-rbac.\r\nActivityId: 299b34bb-2e16-45a6-9de5-e933e540240b, Microsoft.Azure.Documents.Common/2.14.0", "event": "Failed to store telemetry event"}
{"request_id": "8d75fb7d", "method": "POST", "url": "http://localhost:8000/api/v1/chat", "user_agent": "python-requests/2.32.5", "event": "HTTP request started"}
DEBUG: [8d75fb7d] REQUEST START: POST http://localhost:8000/api/v1/chat
DEBUG: [8d75fb7d] Headers: {'host': 'localhost:8000', 'user-agent': 'python-requests/2.32.5', 'accept-encoding': 'gzip, deflate', 'accept': '*/*', 'connection': 'keep-alive', 'content-type': 'application/json', 'content-length': '137'}
DEBUG: [8d75fb7d] Tasks before request: 4
DEBUG: [8d75fb7d] Event loop running: True, closed: False
DEBUG: [8d75fb7d] About to call next middleware/handler
{"url": "http://localhost:8000/api/v1/chat", "event": "Authenticating user request"}
{"user_id": "f96e8a42-f62e-4064-8897-1e12ca6e250a", "email": "", "roles": [], "is_admin": false, "permissions_count": 4, "event": "Created RBAC context"}
{"session_id": "test-session", "turn_id": "68b86da7-da04-4008-af1e-bb4efdbadcc0", "user_id": "test-user", "message_length": 36, "event": "Processing chat message"}
{"event": "Container 'chat_history' not found in database 'appdb'. Auto-creation of containers is disabled. Pre-create the container or enable provisioning explicitly. See https://aka.ms/cosmos-native-rbac for details."}
{"container": "chat_history", "error": "Container 'chat_history' not found in database 'appdb'. Auto-creation of containers is disabled. Pre-create the container or enable provisioning explicitly. See https://aka.ms/cosmos-native-rbac for details.", "event": "Failed to create container"}
{"chat_id": "test-session", "user_id": "f96e8a42-f62e-4064-8897-1e12ca6e250a", "error": "Container 'chat_history' not found in database 'appdb'. Auto-creation of containers is disabled. Pre-create the container or enable provisioning explicitly. See https://aka.ms/cosmos-native-rbac for details.", "event": "Failed to get chat history"}
{"chat_id": "test-session", "user_id": "f96e8a42-f62e-4064-8897-1e12ca6e250a", "event": "Chat history not found"}
{"error": "'name'", "event": "Failed to list function definitions"}
{"user_id": "f96e8a42-f62e-4064-8897-1e12ca6e250a", "error": "'name'", "event": "Failed to get filtered functions"}
{"agent_name": "planner_system", "tenant_id": "74c77be6-1ad3-4957-a4f2-94028372d7d6", "scenario": "general", "prompt_id": "prompt_planner_system", "event": "Retrieved system prompt"}
{"plan_id": "002d99af-7cf3-4199-bda0-ba26ec287356", "plan_type": "sql_only", "agent_type": "sql_agent", "user_id": "f96e8a42-f62e-4064-8897-1e12ca6e250a", "event": "Basic plan created"}
{"plan_id": "002d99af-7cf3-4199-bda0-ba26ec287356", "user_id": "f96e8a42-f62e-4064-8897-1e12ca6e250a", "steps_count": 1, "planner_type": "sequential", "event": "Plan created successfully"}
{"plan_id": "002d99af-7cf3-4199-bda0-ba26ec287356", "execution_id": "c3d04beb-bc10-40a2-a637-ab6c093d6d19", "user_id": "f96e8a42-f62e-4064-8897-1e12ca6e250a", "event": "Starting plan execution"}
{"step_id": "2248f7e3-0bb7-470e-a30e-a9414ea22efd", "tool_name": "sql_agent", "user_id": "f96e8a42-f62e-4064-8897-1e12ca6e250a", "event": "Executing plan step"}
{"user_query": "What are Salesforce's relationships?", "data_types": "opportunities,contacts,cases,revenue", "limit": "20", "user_id": "f96e8a42-f62e-4064-8897-1e12ca6e250a", "event": "Querying account data from user query"}
{"user_id": "f96e8a42-f62e-4064-8897-1e12ca6e250a", "query_length": 36, "use_tfidf": true, "event": "Starting account resolution"}
{"key": "allowed_accounts:f96e8a42-f62e-4064-8897-1e12ca6e250a", "error": "Object of type datetime is not JSON serializable", "event": "Failed to set cache item"}
{"account_count": 3, "event": "Fitting TF-IDF filter"}
{"account_count": 3, "event": "Fitting TF-IDF vectorizer on account corpus"}
{"error": "\n**********************************************************************\n  Resource \u001b[93mpunkt_tab\u001b[0m not found.\n  Please use the NLTK Downloader to obtain the resource:\n\n  \u001b[31m>>> import nltk\n  >>> nltk.download('punkt_tab')\n  \u001b[0m\n  For more information see: https://www.nltk.org/data.html\n\n  Attempted to load \u001b[93mtokenizers/punkt_tab/english/\u001b[0m\n\n  Searched in:\n    - 'C:\\\\Users\\\\mcarz/nltk_data'\n    - 'C:\\\\Users\\\\mcarz\\\\AppData\\\\Local\\\\Programs\\\\Python\\\\Python313\\\\nltk_data'\n    - 'C:\\\\Users\\\\mcarz\\\\AppData\\\\Local\\\\Programs\\\\Python\\\\Python313\\\\share\\\\nltk_data'\n    - 'C:\\\\Users\\\\mcarz\\\\AppData\\\\Local\\\\Programs\\\\Python\\\\Python313\\\\lib\\\\nltk_data'\n    - 'C:\\\\Users\\\\mcarz\\\\AppData\\\\Roaming\\\\nltk_data'\n    - 'C:\\\\nltk_data'\n    - 'D:\\\\nltk_data'\n    - 'E:\\\\nltk_data'\n**********************************************************************\n", "event": "Failed to fit TF-IDF vectorizer"}
{"error": "\n**********************************************************************\n  Resource \u001b[93mpunkt_tab\u001b[0m not found.\n  Please use the NLTK Downloader to obtain the resource:\n\n  \u001b[31m>>> import nltk\n  >>> nltk.download('punkt_tab')\n  \u001b[0m\n  For more information see: https://www.nltk.org/data.html\n\n  Attempted to load \u001b[93mtokenizers/punkt_tab/english/\u001b[0m\n\n  Searched in:\n    - 'C:\\\\Users\\\\mcarz/nltk_data'\n    - 'C:\\\\Users\\\\mcarz\\\\AppData\\\\Local\\\\Programs\\\\Python\\\\Python313\\\\nltk_data'\n    - 'C:\\\\Users\\\\mcarz\\\\AppData\\\\Local\\\\Programs\\\\Python\\\\Python313\\\\share\\\\nltk_data'\n    - 'C:\\\\Users\\\\mcarz\\\\AppData\\\\Local\\\\Programs\\\\Python\\\\Python313\\\\lib\\\\nltk_data'\n    - 'C:\\\\Users\\\\mcarz\\\\AppData\\\\Roaming\\\\nltk_data'\n    - 'C:\\\\nltk_data'\n    - 'D:\\\\nltk_data'\n    - 'E:\\\\nltk_data'\n**********************************************************************\n", "event": "Failed to fit TF-IDF filter"}
{"event": "TF-IDF vectorizer not fitted, returning empty results"}
{"event": "Created Azure OpenAI client with managed identity token"}
{"error": "Connection error.", "deployment": "gpt-4o", "message_count": 2, "event": "Failed to create chat completion"}
{"event": "Created Azure OpenAI client with managed identity token"}
{"error": "Connection error.", "deployment": "gpt-4o", "message_count": 2, "event": "Failed to create chat completion"}
{"event": "Created Azure OpenAI client with managed identity token"}
{"error": "Connection error.", "deployment": "gpt-4o", "message_count": 2, "event": "Failed to create chat completion"}
{"error": "RetryError[<Future at 0x1ef1af77df0 state=finished raised APIConnectionError>]", "event": "Failed to extract account candidates"}
{"user_id": "f96e8a42-f62e-4064-8897-1e12ca6e250a", "candidates_count": 2, "resolved_count": 0, "requires_disambiguation": true, "confidence": 0.0, "event": "LLM + embeddings resolution completed"}
{"method": "llm_primary", "combined_confidence": 0.0, "resolved_count": 0, "suggestions_count": 3, "event": "Combined resolution results"}
{"event_id": "b768c002-29e5-4c46-9cc6-a2ac42319897", "event_type": "performance_metric", "severity": "info", "user_id": "f96e8a42-f62e-4064-8897-1e12ca6e250a", "session_id": null, "event": "Telemetry event tracked"}
{"user_query": "What are Salesforce's relationships?", "error": "string indices must be integers, not 'str'", "event": "Failed to query account data"}
{"step_id": "2248f7e3-0bb7-470e-a30e-a9414ea22efd", "event": "Step executed successfully"}
{"plan_id": "002d99af-7cf3-4199-bda0-ba26ec287356", "execution_id": "c3d04beb-bc10-40a2-a637-ab6c093d6d19", "status": "completed", "duration_seconds": 24.860851, "event": "Plan execution completed"}
{"session_id": "test-session", "turn_id": "68b86da7-da04-4008-af1e-bb4efdbadcc0", "user_message": "What are Salesforce's relationships?", "assistant_response": "{\"success\": false, \"error\": \"string indices must be integers, not 'str'\", \"user_query\": \"What are Sa...", "event": "Dev mode: Skipping conversation turn save"}
{"session_id": "test-session", "turn_id": "68b86da7-da04-4008-af1e-bb4efdbadcc0", "response_length": 127, "sources_count": 0, "event": "Chat message processed successfully"}
DEBUG: [8d75fb7d] Handler completed successfully
DEBUG: [8d75fb7d] Response status: 200
DEBUG: [8d75fb7d] Tasks after request: 6
DEBUG: [8d75fb7d] Event loop running: True, closed: False
{"request_id": "8d75fb7d", "method": "POST", "url": "http://localhost:8000/api/v1/chat", "status_code": 200, "duration_ms": 29642, "event": "HTTP request completed"}
DEBUG: [8d75fb7d] REQUEST COMPLETED successfully
INFO:     127.0.0.1:52006 - "POST /api/v1/chat HTTP/1.1" 200 OK
{"database": "telemetry", "event": "Database not found, creating new database"}
{"database": "telemetry", "container": "events", "error": "(Forbidden) Request blocked by Auth salesforcebot-cosmos-sql : The given request [POST /dbs] cannot be authorized by AAD token in data plane. Learn more: https://aka.ms/cosmos-native-rbac.\r\nActivityId: c2d80e98-6100-4271-ac15-03e03614e9a9, Microsoft.Azure.Documents.Common/2.14.0\nCode: Forbidden\nMessage: Request blocked by Auth salesforcebot-cosmos-sql : The given request [POST /dbs] cannot be authorized by AAD token in data plane. Learn more: https://aka.ms/cosmos-native-rbac.\r\nActivityId: c2d80e98-6100-4271-ac15-03e03614e9a9, Microsoft.Azure.Documents.Common/2.14.0", "event": "Failed to get or create container for database"}
{"error": "(Forbidden) Request blocked by Auth salesforcebot-cosmos-sql : The given request [POST /dbs] cannot be authorized by AAD token in data plane. Learn more: https://aka.ms/cosmos-native-rbac.\r\nActivityId: c2d80e98-6100-4271-ac15-03e03614e9a9, Microsoft.Azure.Documents.Common/2.14.0\nCode: Forbidden\nMessage: Request blocked by Auth salesforcebot-cosmos-sql : The given request [POST /dbs] cannot be authorized by AAD token in data plane. Learn more: https://aka.ms/cosmos-native-rbac.\r\nActivityId: c2d80e98-6100-4271-ac15-03e03614e9a9, Microsoft.Azure.Documents.Common/2.14.0", "event": "Failed to store telemetry event"}
{"request_id": "d96c2684", "method": "POST", "url": "http://localhost:8000/api/v1/chat", "user_agent": "python-requests/2.32.5", "event": "HTTP request started"}
DEBUG: [d96c2684] REQUEST START: POST http://localhost:8000/api/v1/chat
DEBUG: [d96c2684] Headers: {'host': 'localhost:8000', 'user-agent': 'python-requests/2.32.5', 'accept-encoding': 'gzip, deflate', 'accept': '*/*', 'connection': 'keep-alive', 'content-type': 'application/json', 'content-length': '137'}
DEBUG: [d96c2684] Tasks before request: 4
DEBUG: [d96c2684] Event loop running: True, closed: False
DEBUG: [d96c2684] About to call next middleware/handler
{"url": "http://localhost:8000/api/v1/chat", "event": "Authenticating user request"}
{"user_id": "f96e8a42-f62e-4064-8897-1e12ca6e250a", "email": "", "roles": [], "is_admin": false, "permissions_count": 4, "event": "Created RBAC context"}
{"session_id": "test-session", "turn_id": "ef0966d2-3634-46e7-a69d-3f7b8f7235fe", "user_id": "test-user", "message_length": 36, "event": "Processing chat message"}
{"event": "Container 'chat_history' not found in database 'appdb'. Auto-creation of containers is disabled. Pre-create the container or enable provisioning explicitly. See https://aka.ms/cosmos-native-rbac for details."}
{"container": "chat_history", "error": "Container 'chat_history' not found in database 'appdb'. Auto-creation of containers is disabled. Pre-create the container or enable provisioning explicitly. See https://aka.ms/cosmos-native-rbac for details.", "event": "Failed to create container"}
{"chat_id": "test-session", "user_id": "f96e8a42-f62e-4064-8897-1e12ca6e250a", "error": "Container 'chat_history' not found in database 'appdb'. Auto-creation of containers is disabled. Pre-create the container or enable provisioning explicitly. See https://aka.ms/cosmos-native-rbac for details.", "event": "Failed to get chat history"}
{"chat_id": "test-session", "user_id": "f96e8a42-f62e-4064-8897-1e12ca6e250a", "event": "Chat history not found"}
{"error": "'name'", "event": "Failed to list function definitions"}
{"user_id": "f96e8a42-f62e-4064-8897-1e12ca6e250a", "error": "'name'", "event": "Failed to get filtered functions"}
{"agent_name": "planner_system", "tenant_id": "74c77be6-1ad3-4957-a4f2-94028372d7d6", "scenario": "general", "prompt_id": "prompt_planner_system", "event": "Retrieved system prompt"}
{"plan_id": "ecc6aaa2-6433-4152-8e02-00ddd10dc534", "plan_type": "sql_only", "agent_type": "sql_agent", "user_id": "f96e8a42-f62e-4064-8897-1e12ca6e250a", "event": "Basic plan created"}
{"plan_id": "ecc6aaa2-6433-4152-8e02-00ddd10dc534", "user_id": "f96e8a42-f62e-4064-8897-1e12ca6e250a", "steps_count": 1, "planner_type": "sequential", "event": "Plan created successfully"}
{"plan_id": "ecc6aaa2-6433-4152-8e02-00ddd10dc534", "execution_id": "03dbe190-067c-429c-b50c-c40b958f30ff", "user_id": "f96e8a42-f62e-4064-8897-1e12ca6e250a", "event": "Starting plan execution"}
{"step_id": "72e7f08e-1e66-4a2f-bf00-71fa80986265", "tool_name": "sql_agent", "user_id": "f96e8a42-f62e-4064-8897-1e12ca6e250a", "event": "Executing plan step"}
{"user_query": "What are Salesforce's relationships?", "data_types": "opportunities,contacts,cases,revenue", "limit": "20", "user_id": "f96e8a42-f62e-4064-8897-1e12ca6e250a", "event": "Querying account data from user query"}
{"user_id": "f96e8a42-f62e-4064-8897-1e12ca6e250a", "query_length": 36, "use_tfidf": true, "event": "Starting account resolution"}
{"key": "allowed_accounts:f96e8a42-f62e-4064-8897-1e12ca6e250a", "error": "Object of type datetime is not JSON serializable", "event": "Failed to set cache item"}
{"account_count": 3, "event": "Fitting TF-IDF filter"}
{"account_count": 3, "event": "Fitting TF-IDF vectorizer on account corpus"}
{"error": "\n**********************************************************************\n  Resource \u001b[93mpunkt_tab\u001b[0m not found.\n  Please use the NLTK Downloader to obtain the resource:\n\n  \u001b[31m>>> import nltk\n  >>> nltk.download('punkt_tab')\n  \u001b[0m\n  For more information see: https://www.nltk.org/data.html\n\n  Attempted to load \u001b[93mtokenizers/punkt_tab/english/\u001b[0m\n\n  Searched in:\n    - 'C:\\\\Users\\\\mcarz/nltk_data'\n    - 'C:\\\\Users\\\\mcarz\\\\AppData\\\\Local\\\\Programs\\\\Python\\\\Python313\\\\nltk_data'\n    - 'C:\\\\Users\\\\mcarz\\\\AppData\\\\Local\\\\Programs\\\\Python\\\\Python313\\\\share\\\\nltk_data'\n    - 'C:\\\\Users\\\\mcarz\\\\AppData\\\\Local\\\\Programs\\\\Python\\\\Python313\\\\lib\\\\nltk_data'\n    - 'C:\\\\Users\\\\mcarz\\\\AppData\\\\Roaming\\\\nltk_data'\n    - 'C:\\\\nltk_data'\n    - 'D:\\\\nltk_data'\n    - 'E:\\\\nltk_data'\n**********************************************************************\n", "event": "Failed to fit TF-IDF vectorizer"}
{"error": "\n**********************************************************************\n  Resource \u001b[93mpunkt_tab\u001b[0m not found.\n  Please use the NLTK Downloader to obtain the resource:\n\n  \u001b[31m>>> import nltk\n  >>> nltk.download('punkt_tab')\n  \u001b[0m\n  For more information see: https://www.nltk.org/data.html\n\n  Attempted to load \u001b[93mtokenizers/punkt_tab/english/\u001b[0m\n\n  Searched in:\n    - 'C:\\\\Users\\\\mcarz/nltk_data'\n    - 'C:\\\\Users\\\\mcarz\\\\AppData\\\\Local\\\\Programs\\\\Python\\\\Python313\\\\nltk_data'\n    - 'C:\\\\Users\\\\mcarz\\\\AppData\\\\Local\\\\Programs\\\\Python\\\\Python313\\\\share\\\\nltk_data'\n    - 'C:\\\\Users\\\\mcarz\\\\AppData\\\\Local\\\\Programs\\\\Python\\\\Python313\\\\lib\\\\nltk_data'\n    - 'C:\\\\Users\\\\mcarz\\\\AppData\\\\Roaming\\\\nltk_data'\n    - 'C:\\\\nltk_data'\n    - 'D:\\\\nltk_data'\n    - 'E:\\\\nltk_data'\n**********************************************************************\n", "event": "Failed to fit TF-IDF filter"}
{"event": "TF-IDF vectorizer not fitted, returning empty results"}
{"event": "Created Azure OpenAI client with managed identity token"}
{"error": "Connection error.", "deployment": "gpt-4o", "message_count": 2, "event": "Failed to create chat completion"}
{"event": "Created Azure OpenAI client with managed identity token"}
{"error": "Connection error.", "deployment": "gpt-4o", "message_count": 2, "event": "Failed to create chat completion"}
{"event": "Created Azure OpenAI client with managed identity token"}
{"error": "Connection error.", "deployment": "gpt-4o", "message_count": 2, "event": "Failed to create chat completion"}
{"error": "RetryError[<Future at 0x1ef1b620f50 state=finished raised APIConnectionError>]", "event": "Failed to extract account candidates"}
{"user_id": "f96e8a42-f62e-4064-8897-1e12ca6e250a", "candidates_count": 2, "resolved_count": 0, "requires_disambiguation": true, "confidence": 0.0, "event": "LLM + embeddings resolution completed"}
{"method": "llm_primary", "combined_confidence": 0.0, "resolved_count": 0, "suggestions_count": 3, "event": "Combined resolution results"}
{"event_id": "d41d3826-8358-44ba-b86a-e8e59a665737", "event_type": "performance_metric", "severity": "info", "user_id": "f96e8a42-f62e-4064-8897-1e12ca6e250a", "session_id": null, "event": "Telemetry event tracked"}
{"user_query": "What are Salesforce's relationships?", "error": "string indices must be integers, not 'str'", "event": "Failed to query account data"}
{"step_id": "72e7f08e-1e66-4a2f-bf00-71fa80986265", "event": "Step executed successfully"}
{"plan_id": "ecc6aaa2-6433-4152-8e02-00ddd10dc534", "execution_id": "03dbe190-067c-429c-b50c-c40b958f30ff", "status": "completed", "duration_seconds": 23.60109, "event": "Plan execution completed"}
{"session_id": "test-session", "turn_id": "ef0966d2-3634-46e7-a69d-3f7b8f7235fe", "user_message": "What are Salesforce's relationships?", "assistant_response": "{\"success\": false, \"error\": \"string indices must be integers, not 'str'\", \"user_query\": \"What are Sa...", "event": "Dev mode: Skipping conversation turn save"}
{"session_id": "test-session", "turn_id": "ef0966d2-3634-46e7-a69d-3f7b8f7235fe", "response_length": 127, "sources_count": 0, "event": "Chat message processed successfully"}
DEBUG: [d96c2684] Handler completed successfully
DEBUG: [d96c2684] Response status: 200
DEBUG: [d96c2684] Tasks after request: 6
DEBUG: [d96c2684] Event loop running: True, closed: False
{"request_id": "d96c2684", "method": "POST", "url": "http://localhost:8000/api/v1/chat", "status_code": 200, "duration_ms": 28908, "event": "HTTP request completed"}
DEBUG: [d96c2684] REQUEST COMPLETED successfully
INFO:     127.0.0.1:51939 - "POST /api/v1/chat HTTP/1.1" 200 OK
{"database": "telemetry", "event": "Database not found, creating new database"}
{"database": "telemetry", "container": "events", "error": "(Forbidden) Request blocked by Auth salesforcebot-cosmos-sql : The given request [POST /dbs] cannot be authorized by AAD token in data plane. Learn more: https://aka.ms/cosmos-native-rbac.\r\nActivityId: ea37f267-052f-47f4-86e3-3e2473a5e046, Microsoft.Azure.Documents.Common/2.14.0\nCode: Forbidden\nMessage: Request blocked by Auth salesforcebot-cosmos-sql : The given request [POST /dbs] cannot be authorized by AAD token in data plane. Learn more: https://aka.ms/cosmos-native-rbac.\r\nActivityId: ea37f267-052f-47f4-86e3-3e2473a5e046, Microsoft.Azure.Documents.Common/2.14.0", "event": "Failed to get or create container for database"}
{"error": "(Forbidden) Request blocked by Auth salesforcebot-cosmos-sql : The given request [POST /dbs] cannot be authorized by AAD token in data plane. Learn more: https://aka.ms/cosmos-native-rbac.\r\nActivityId: ea37f267-052f-47f4-86e3-3e2473a5e046, Microsoft.Azure.Documents.Common/2.14.0\nCode: Forbidden\nMessage: Request blocked by Auth salesforcebot-cosmos-sql : The given request [POST /dbs] cannot be authorized by AAD token in data plane. Learn more: https://aka.ms/cosmos-native-rbac.\r\nActivityId: ea37f267-052f-47f4-86e3-3e2473a5e046, Microsoft.Azure.Documents.Common/2.14.0", "event": "Failed to store telemetry event"}
{"request_id": "d5aa5a7e", "method": "POST", "url": "http://localhost:8000/api/v1/chat", "user_agent": "python-requests/2.32.5", "event": "HTTP request started"}
DEBUG: [d5aa5a7e] REQUEST START: POST http://localhost:8000/api/v1/chat
DEBUG: [d5aa5a7e] Headers: {'host': 'localhost:8000', 'user-agent': 'python-requests/2.32.5', 'accept-encoding': 'gzip, deflate', 'accept': '*/*', 'connection': 'keep-alive', 'content-type': 'application/json', 'content-length': '113'}
DEBUG: [d5aa5a7e] Tasks before request: 4
DEBUG: [d5aa5a7e] Event loop running: True, closed: False
DEBUG: [d5aa5a7e] About to call next middleware/handler
{"url": "http://localhost:8000/api/v1/chat", "event": "Authenticating user request"}
{"user_id": "f96e8a42-f62e-4064-8897-1e12ca6e250a", "email": "", "roles": [], "is_admin": false, "permissions_count": 4, "event": "Created RBAC context"}
{"session_id": "test-session", "turn_id": "a36dc289-f9f0-4d3b-b172-b16e874d30c1", "user_id": "test-user", "message_length": 12, "event": "Processing chat message"}
{"event": "Container 'chat_history' not found in database 'appdb'. Auto-creation of containers is disabled. Pre-create the container or enable provisioning explicitly. See https://aka.ms/cosmos-native-rbac for details."}
{"container": "chat_history", "error": "Container 'chat_history' not found in database 'appdb'. Auto-creation of containers is disabled. Pre-create the container or enable provisioning explicitly. See https://aka.ms/cosmos-native-rbac for details.", "event": "Failed to create container"}
{"chat_id": "test-session", "user_id": "f96e8a42-f62e-4064-8897-1e12ca6e250a", "error": "Container 'chat_history' not found in database 'appdb'. Auto-creation of containers is disabled. Pre-create the container or enable provisioning explicitly. See https://aka.ms/cosmos-native-rbac for details.", "event": "Failed to get chat history"}
{"chat_id": "test-session", "user_id": "f96e8a42-f62e-4064-8897-1e12ca6e250a", "event": "Chat history not found"}
{"error": "'name'", "event": "Failed to list function definitions"}
{"user_id": "f96e8a42-f62e-4064-8897-1e12ca6e250a", "error": "'name'", "event": "Failed to get filtered functions"}
{"agent_name": "planner_system", "tenant_id": "74c77be6-1ad3-4957-a4f2-94028372d7d6", "scenario": "general", "prompt_id": "prompt_planner_system", "event": "Retrieved system prompt"}
{"plan_id": "821bf378-bb70-404f-929f-3d77ff71aa41", "plan_type": "graph_only", "agent_type": "graph_agent", "user_id": "f96e8a42-f62e-4064-8897-1e12ca6e250a", "event": "Basic plan created"}
{"plan_id": "821bf378-bb70-404f-929f-3d77ff71aa41", "user_id": "f96e8a42-f62e-4064-8897-1e12ca6e250a", "steps_count": 1, "planner_type": "sequential", "event": "Plan created successfully"}
{"plan_id": "821bf378-bb70-404f-929f-3d77ff71aa41", "execution_id": "5b24c8d8-fff6-47b3-a468-7ff45d5629d1", "user_id": "f96e8a42-f62e-4064-8897-1e12ca6e250a", "event": "Starting plan execution"}
{"step_id": "89532d5e-d84c-414e-9308-05c26eb9f25e", "tool_name": "graph_agent", "user_id": "f96e8a42-f62e-4064-8897-1e12ca6e250a", "event": "Executing plan step"}
{"user_query": "Who are you?", "relationship_types": "", "max_depth": "2", "user_id": "f96e8a42-f62e-4064-8897-1e12ca6e250a", "event": "Finding account relationships from query"}
{"user_id": "f96e8a42-f62e-4064-8897-1e12ca6e250a", "query_length": 12, "use_tfidf": true, "event": "Starting account resolution"}
{"key": "allowed_accounts:f96e8a42-f62e-4064-8897-1e12ca6e250a", "error": "Object of type datetime is not JSON serializable", "event": "Failed to set cache item"}
{"account_count": 3, "event": "Fitting TF-IDF filter"}
{"account_count": 3, "event": "Fitting TF-IDF vectorizer on account corpus"}
{"error": "\n**********************************************************************\n  Resource \u001b[93mpunkt_tab\u001b[0m not found.\n  Please use the NLTK Downloader to obtain the resource:\n\n  \u001b[31m>>> import nltk\n  >>> nltk.download('punkt_tab')\n  \u001b[0m\n  For more information see: https://www.nltk.org/data.html\n\n  Attempted to load \u001b[93mtokenizers/punkt_tab/english/\u001b[0m\n\n  Searched in:\n    - 'C:\\\\Users\\\\mcarz/nltk_data'\n    - 'C:\\\\Users\\\\mcarz\\\\AppData\\\\Local\\\\Programs\\\\Python\\\\Python313\\\\nltk_data'\n    - 'C:\\\\Users\\\\mcarz\\\\AppData\\\\Local\\\\Programs\\\\Python\\\\Python313\\\\share\\\\nltk_data'\n    - 'C:\\\\Users\\\\mcarz\\\\AppData\\\\Local\\\\Programs\\\\Python\\\\Python313\\\\lib\\\\nltk_data'\n    - 'C:\\\\Users\\\\mcarz\\\\AppData\\\\Roaming\\\\nltk_data'\n    - 'C:\\\\nltk_data'\n    - 'D:\\\\nltk_data'\n    - 'E:\\\\nltk_data'\n**********************************************************************\n", "event": "Failed to fit TF-IDF vectorizer"}
{"error": "\n**********************************************************************\n  Resource \u001b[93mpunkt_tab\u001b[0m not found.\n  Please use the NLTK Downloader to obtain the resource:\n\n  \u001b[31m>>> import nltk\n  >>> nltk.download('punkt_tab')\n  \u001b[0m\n  For more information see: https://www.nltk.org/data.html\n\n  Attempted to load \u001b[93mtokenizers/punkt_tab/english/\u001b[0m\n\n  Searched in:\n    - 'C:\\\\Users\\\\mcarz/nltk_data'\n    - 'C:\\\\Users\\\\mcarz\\\\AppData\\\\Local\\\\Programs\\\\Python\\\\Python313\\\\nltk_data'\n    - 'C:\\\\Users\\\\mcarz\\\\AppData\\\\Local\\\\Programs\\\\Python\\\\Python313\\\\share\\\\nltk_data'\n    - 'C:\\\\Users\\\\mcarz\\\\AppData\\\\Local\\\\Programs\\\\Python\\\\Python313\\\\lib\\\\nltk_data'\n    - 'C:\\\\Users\\\\mcarz\\\\AppData\\\\Roaming\\\\nltk_data'\n    - 'C:\\\\nltk_data'\n    - 'D:\\\\nltk_data'\n    - 'E:\\\\nltk_data'\n**********************************************************************\n", "event": "Failed to fit TF-IDF filter"}
{"event": "TF-IDF vectorizer not fitted, returning empty results"}
{"event": "Created Azure OpenAI client with managed identity token"}
{"error": "Connection error.", "deployment": "gpt-4o", "message_count": 2, "event": "Failed to create chat completion"}
{"event": "Created Azure OpenAI client with managed identity token"}
{"error": "Connection error.", "deployment": "gpt-4o", "message_count": 2, "event": "Failed to create chat completion"}
{"event": "Created Azure OpenAI client with managed identity token"}
{"error": "Connection error.", "deployment": "gpt-4o", "message_count": 2, "event": "Failed to create chat completion"}
{"error": "RetryError[<Future at 0x1ef1b15d250 state=finished raised APIConnectionError>]", "event": "Failed to extract account candidates"}
{"user_id": "f96e8a42-f62e-4064-8897-1e12ca6e250a", "candidates_count": 1, "resolved_count": 0, "requires_disambiguation": true, "confidence": 0.0, "event": "LLM + embeddings resolution completed"}
{"method": "llm_primary", "combined_confidence": 0.0, "resolved_count": 0, "suggestions_count": 3, "event": "Combined resolution results"}
{"step_id": "89532d5e-d84c-414e-9308-05c26eb9f25e", "event": "Step executed successfully"}
{"plan_id": "821bf378-bb70-404f-929f-3d77ff71aa41", "execution_id": "5b24c8d8-fff6-47b3-a468-7ff45d5629d1", "status": "completed", "duration_seconds": 21.522901, "event": "Plan execution completed"}
{"session_id": "test-session", "turn_id": "a36dc289-f9f0-4d3b-b172-b16e874d30c1", "user_message": "Who are you?", "assistant_response": "{\"success\": false, \"error\": \"No accounts could be resolved from the query\", \"user_query\": \"Who are y...", "event": "Dev mode: Skipping conversation turn save"}
{"session_id": "test-session", "turn_id": "a36dc289-f9f0-4d3b-b172-b16e874d30c1", "response_length": 174, "sources_count": 0, "event": "Chat message processed successfully"}
DEBUG: [d5aa5a7e] Handler completed successfully
DEBUG: [d5aa5a7e] Response status: 200
DEBUG: [d5aa5a7e] Tasks after request: 5
DEBUG: [d5aa5a7e] Event loop running: True, closed: False
{"request_id": "d5aa5a7e", "method": "POST", "url": "http://localhost:8000/api/v1/chat", "status_code": 200, "duration_ms": 26653, "event": "HTTP request completed"}
DEBUG: [d5aa5a7e] REQUEST COMPLETED successfully
INFO:     127.0.0.1:63333 - "POST /api/v1/chat HTTP/1.1" 200 OK
